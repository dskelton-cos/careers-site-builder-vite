function SFNamedAnchor(a,b,c){this._init(a,b,c)}juic.extend(SFNamedAnchor,juic.Component,{_init:function(a,b,c){this._label=a,this._name=Util.createAnchorName(b),this._cssClass=c},renderHtml:function(a){a.push("<a name=\"",this._name,"\" class=\"namedAnchor ",this._cssClass,"\">",juic.escapeHTML(this._label),"</a>")},go:function(){window.location.hash="#"+this._name}});function SFDialog(a,b,c,d,e,f,g,h,i,j){this.register(),juic.assert("undefined"!=typeof b,"[SFDialog] : Content component required"),this.setComponent(b),"undefined"!=typeof a&&this.setDialogTitle(a),juic.assert(c&&"object"==typeof c,"[SFDialog] : You must provide and array of button definitions"),juic.assert(!d||"number"==typeof d,"[SFDialog] : innerWidth parameter must be a number."),juic.assert(!e||"number"==typeof e,"[SFDialog] : innerHeight parameter must be a number."),null!=g&&(juic.assert("number"==typeof g,"[SFDialog] : titleHeaderTagLevel must be a number."),juic.assert(-1<g&&7>g,"[SFDialog] : titleHeaderTagLevel must be a number between 0 and 6.")),this._innerWidth=d||740,this._innerHeight=e||540,this._preventClose=!1,this._showCloseIcon=!Util.isFioriEnabled(),this._closeDialogOnEsc=Util.isFioriEnabled(),this._buttons=[],this._setButtons(c),this._show=!0,this._focusLoop=new SFFocusLoop(this.id),this._focusMarkers=this._focusLoop.getMarkers(),this._useNamedAnchor=f||!1,this._titleHeaderTagLevel=g,this._useIconFonts=!!h&&!Util.isFioriEnabled(),this._useUI5Popups=i||!1,this._announceContent=j}SFDialog.prototype=function(){return juic.set(new juic.Component,{setFocus:function(a){this._focusLoop.setFocus(a),this._useNamedAnchor&&this.namedAnchor&&!a&&this.namedAnchor.go()},setCloseDialogOnEsc:function(a){this._closeDialogOnEsc=a},addEscKeyListener:function(){this._closeDialogOnEsc&&SFOverlayMgr.addEventListener("escKeyPressed",this,"_escKeyPressed")},removeEscKeyListener:function(){this._closeDialogOnEsc&&SFOverlayMgr.removeEventListener("escKeyPressed",this)},showDialog:function(a){SFOverlayMgr.addEventListener("overlayRendered",this,"_dialogRendered"),SFOverlayMgr.showOverlay(this,!0,null,null,this._getOverlayOpts()),this.addEscKeyListener(),this._refocusId=a},_getAnchorName:function(){return Util.createIdentifier("sfDialogBoxHeaderAnchor_"+this.id)},_getOverlayOpts:function(){return{dispatchEscKeyPress:this._closeDialogOnEsc,useUI5Popups:this._useUI5Popups}},_escKeyPressed:function(){this._cancel()},_dialogRendered:function(a){a.componentId==this.id&&this.setFocus(!1)},_renderTitleSection:function(a){this._titleHeaderTagLevel?a.push("<h",this._titleHeaderTagLevel," class=\"hdrText "+this.generateFDClasses("title",["h5"])+"\" id=\"",this.id,"_dialogTitle\">"):a.push("<div class=\"hdrText "+this.generateFDClasses("title",["h5"])+"\" id=\"",this.id,"_dialogTitle\">"),this._useNamedAnchor?(this.namedAnchor=new SFNamedAnchor(this._dialogTitle||"&nbsp;",this._getAnchorName(),"panelHeaderTitle"),a.push(this.namedAnchor)):a.push(juic.escapeHTML(this._dialogTitle)),this._titleHeaderTagLevel?a.push("</h",this._titleHeaderTagLevel,">"):a.push("</div>")},_renderHelpIcon:function(){},renderHtml:function(a){if(a.push("<div class=\"sfDlg globalContentBackgroundVariant\" id=\""+this.id+"\" style=\"position:relative;"+(this._show?"":"display:none;")+"\">"),Util.isFioriEnabled()||a.push("<div id=\""+this.id+"_underlay\" style=\"width:"+this._innerWidth+"px;height:"+(this._innerHeight+70)+"px;\" class=\"underLay\"></div>"),this._focusMarkers[0].renderHtml(a),a.push("<div id=\""+this.id+"_overlay\" class=\"sfDlgCntr "+this.generateFDClasses("dialog__content")+"\" role=\"dialog\" aria-labelledby=\""+this.id+"_dialogTitle\" aria-describedby=\""+(this._announceContent?this.id+"_sysMsgUl":"")+"\" style=\"width:"+this._innerWidth+"px;\">"),a.push("<div class=\"globalPortletBodyBackground\">"),a.push("<div class=\"hdr globalPortletHeader "+this.generateFDClasses("dialog__header")+" "+this.generateFDClasses("bar")+"\">"),this._renderTitleSection(a),a.push("</div><div id=\""+this.id+"_body\" class=\"body globalPortletBody "+this.generateFDClasses("dialog__body")+"\" style=\"height:"+this._innerHeight+"px;\"><div id=\""+this.id+"_innerBody\" class=\"innerBdy\""),this._bodyStyle&&a.push(this._bodyStyle),a.push(">"),this._contentComponent&&this._contentComponent.renderHtml(a),a.push("</div></div>"),a.push("<div class=\"ftr "+this.generateFDClasses("dialog__footer")+" "+this.generateFDClasses("bar",["footer"])+"\"><div class=\"globalFloatRight button_row globalIconFont1Container "+this.generateFDClasses("bar__right")+"\"><div id=\"dialog_btns"+this.id+"\">"),this._buttons)for(var b=0,c=this._buttons.length;b<c;++b)this._buttons[b].renderHtml(a);this._showCloseIcon&&(a.push("<button id=\""+this.id+"dlg_close_x\" title=\""+MSGS.COMMON_Close_Dialog+"\" aria-label=\""+MSGS.COMMON_Close_Dialog+"\""),a.push(" onclick=\"",this.fireCode("_cancel")," return false;\" onkeydown=\"",this.fireCode("_onCloseKeyDown"),"\" class=\"close-x globalIconFont1Support globalPortletCloseIcon",this._useIconFonts?" sapIcon":"","\">",this._useIconFonts?"&#xe03e;":"<span class='legacyFont1Icon'>&#xe03e;</span>","</button>")),this._renderHelpIcon(a),this._focusMarkers[1].renderHtml(a),a.push("</div></div><div class='clear_all'></div></div>"),a.push("</div></div></div>")},cleanup:function(){for(var a=0,b=this._buttons.length;a<b;a++)this._buttons[a].isRegistered()&&this._buttons[a].unregister();this.namedAnchor&&this.namedAnchor.isRegistered()&&this.namedAnchor.cleanup(),this.isRegistered()&&this.unregister()},setNewButtons:function(a){for(;this._buttons&&0<this._buttons.length;)this._buttons.shift().cleanup();if(this._setButtons(a),juic.$("dialog_btns"+this.id)){var b=[];if(this._buttons)for(var c=0,d=this._buttons.length;c<d;++c)this._buttons[c].renderHtml(b);juic.$("dialog_btns"+this.id).innerHTML=b.join("")}},_setButtons:function(a){this._buttonDefs=a;for(var b=this._buttonDefs,c=0,d=b.length;c<d;++c){var e=b[c],f=new SFCommandButton(e.label,e.active,e.enabled,e.isRounded||!1,{ariaFocusable:e.ariaFocusable||!1,baseButtonWrapperClass:"actionBtn",buttonDesign:e.buttonDesign,ariaDescribedByContent:e.ariaDescribedByContent});f.setActionCommand(e.eventName),f.addEventListener("action",this),this._buttons.push(f)}},setDialogTitle:function(a){this._dialogTitle=a;var b=juic.$(this.id+"_dialogTitle");b&&(b.innerHTML=juic.escapeHTML(a))},setInnerHeight:function(a){var b=juic.$(this.id+"_body");if(this._innerHeight=a,b){var c=juic.$(this.id+"_underlay");c&&(c.style.height=a+70+"px"),b.style.height=a+"px"}},getInnerHeight:function(){var a=juic.$(this.id+"_body");return a?a.offsetHeight:-1},setInnerWidth:function(a){if(this._innerWidth=a,juic.$(this.id+"_body")){var b=juic.$(this.id+"_underlay");b&&(b.style.width=a+"px"),juic.$(this.id+"_overlay").style.width=a+"px"}},getInnerWidth:function(){if(juic.$(this.id+"_body")){var a=juic.$(this.id+"_underlay");return a?a.offsetWidth:juic.$(this.id+"_overlay").offsetWidth}return-1},setComponent:function(a){this._contentComponent=a,juic.$(this.id+"_body")&&a.render(this.id+"_innerBody")},_cancel:function(){var a=this._cancelActionData;a?this.dispatch(a.event,{actionCommand:a.actionCommand,data:a.data}):this.close()},_onCloseKeyDown:function(a){"13"==a.keyCode&&(SFDOMEvent.preventDefault(a),this._cancel())},handleEvent:function(a){if("action"==a.type){if("hide"==a.actionCommand){var b=this;setTimeout(function(){b.close()},0)}this.dispatchEvent(a)}},disableButtons:function(){for(var a=0,b=this._buttons.length;a<b;++a)this._buttons[a].isEnabled()&&this._buttons[a].setEnabled(!1)},enableButtons:function(){for(var a=0,b=this._buttons.length;a<b;++a)this._buttons[a].isEnabled()||this._buttons[a].setEnabled(!0)},disableButton:function(a){this._buttons[a].setEnabled(!1),this.dispatch("buttonsDisabled")},enableButton:function(a){this._buttons[a].setEnabled(!0),this.dispatch("buttonsEnabled")},isButtonEnabled:function(a){return!!(0<=a&&a<this._buttons.length)&&this._buttons[a].isEnabled()},setButtonLabel:function(a,b){this._buttons[a].setLabel(b)},setButtonActionCommand:function(a,b){this._buttons[a].setActionCommand(b)},setButtonVisible:function(a,b){this._buttons[a].setVisible(b)},setPreventCloseState:function(a){this._preventClose=a},getPreventCloseState:function(){return this._preventClose},setShowCloseIcon:function(a){this._showCloseIcon=a;var b=juic.$(this.id+"dlg_close_x");b&&(this._showCloseIcon?this._showCloseIcon&&(b.style.display=""):b.style.display="none")},setBodyStyle:function(a){this._bodyStyle=a},close:function(){SFOverlayMgr.removeEventListener("overlayRendered",this),this._preventClose?this.dispatch("action",{actionCommand:"hideRequest"}):(this.removeEscKeyListener(),this.dispatch("action",{actionCommand:"hide"}),this.dispatch("hide"));var a=juic.$(this._refocusId);a&&a.focus()},show:function(a){this._show=a;var b=juic.$(this.id);b&&(b.style.display=a?"":"none")},setCancelAction:function(a,b){juic.assert(a,"[SFDialog] : Trying to set invalid cancel actionCommand."),this._cancelActionData={event:"action",actionCommand:a,data:b}}})}();function SFFileUploadDialog(a,b,c,d,e,f,g,h,i,j,k,l){this._sfMsgs=MSGS,this.register(),this._name=a,this._isTextFile=b,this._maxFiles=c,this._urlParams=d,this._titleText=e,this._width=f?f:550,this._height=g?g:300,h&&(this._instructions=h),this._isRevolutionDialog=i||!1,this._closeDialogOnEsc=j||Util.isFioriEnabled();var m={};m.inputAriaLabel=l,this._instructions?(m.fileSizeLimit=k,this._fileUpload=new SFFileUpload(this._name,this._maxFiles,this._isTextFile,this._urlParams,this._instructions,m)):this._fileUpload=new SFFileUpload(this._name,this._maxFiles,this._isTextFile,this._urlParams,"",m),this._fileUpload.addEventListener("uploadProceed",this),this._fileUpload.addEventListener("uploadSucceeded",this),this._fileUpload.addEventListener("uploadFailed",this),this._fileUpload.addEventListener("wrongFile",this),this._fileUpload.addEventListener("noFileSelected",this),this._init()}(function(){juic.extend(SFFileUploadDialog,juic.Component,{_init:function(){this.dialog||(this._buttonDefinitions=[{label:MSGS.COMMON_Upload,eventName:"uploadBegin",active:!0},{buttonDesign:"transparent",label:MSGS.COMMON_Cancel,eventName:"hide",active:!1}],this.dialog=this._isRevolutionDialog?new SFDialogBox(this._titleText,this._fileUpload,this._buttonDefinitions,this._width,this._height,!0):new SFDialog(this._titleText,this._fileUpload,this._buttonDefinitions,this._width,this._height,!1,0,!0),this.dialog.setCloseDialogOnEsc(this._closeDialogOnEsc),this.dialog.addEventListener("action",this,"_handleDialogEvents"))},renderHtml:function(a){a.push("<div id=\"",this.id,"\">"),a.push(this.dialog),a.push("</div>")},showDialog:function(a,b){this._isRevolutionDialog?this.dialog.showDialog(a,b):this.dialog.showDialog(b)},updateUrlParamsObj:function(a){this._urlParams=a,this._fileUpload.updateUrlParamsObj(a)},cancel:function(){this._uploadInProgress||(this._fileUpload.releaseResources(),this.dispatch("hide"))},_handleDialogEvents:function(a){switch(a.type){case"action":switch(a.actionCommand){case"hide":if(a.data&&a.data.closeIcon&&this._uploadInProgress)break;this._fileUpload.releaseResources(),this.dispatch("hide");break;case"uploadBegin":this._fileUpload.checkFields();}}},handleEvent:function(a){switch(a.type){case"uploadProceed":this._uploadInProgress=!0,this.dialog.setPreventCloseState(!0),this.dialog.disableButtons(),this._fileUpload.doUpload();break;case"uploadSucceeded":this._uploadInProgress=!1,this.dialog.setPreventCloseState(!1),this.dialog.enableButtons(),this._fileUpload.releaseResources(),this.dispatch("uploadSucceeded",{response:a.response});break;case"uploadFailed":this._uploadInProgress=!1,this.dialog.setPreventCloseState(!1),this.dialog.enableButtons(),this._fileUpload.releaseResources(),this.dispatch("uploadFailed",{response:a.response});break;case"wrongFile":this._uploadInProgress=!1,this.dialog.setPreventCloseState(!1),this.dialog.enableButtons(),this._fileUpload.releaseResources();break;case"noFileSelected":this.dispatch("noFileSelected",{response:a.target});}},cleanup:function(){this._fileUpload.cleanup(),this._isRevolutionDialog&&this._super()}})})();function SFFileUpload(a,b,c,d,e,f){this._sfMsgs=MSGS,this.register(),this._name=a,this._fieldCount=b,this._isTextFile=c,this._formLayout=new SFInputFormLayout,this._formFields=[],this._urlParamsObj=d,e&&(this._instructions=e),this.config=f||{},this.init()}(function(){juic.extend(SFFileUpload,juic.Component,{init:function(){this._stableId=this.config.stableId||"",this._fileInputs=[],this.config&&this.config.allowParentFormSubmission&&(this._usingParentForm=!1,this._cacheParentFormProperties={}),this._currentForm=null;for(var a=1;a<=this._fieldCount;++a){var b=1==this._fieldCount?MSGS.COMMON_Choose_File:MSGS.get("COMMON_Choose_File_With_Index",a),c=this.config&&this.config.inputAriaLabel!=null?this.config.inputAriaLabel:null,d=!!(this.config&&this.config.required)&&this.config.required,e=new SFFileInput(a,null,c,d,{stableId:this._stableId+a});this.config&&this.config.size&&e.setSize(this.config.size);var f=this.config&&this.config.required?{required:!0}:null;this._formFields.push(e),this._formLayout.addField(b,this._formFields[a-1],f)}this._isTextFile&&(this._formFields.push(new SFSingleSelect("",this._getEncodingOptions(),"encoding1")),this._formLayout.addField(MSGS.COMMON_File_Encoding,this._formFields[a-1]))},checkFields:function(){var a=this._formLayout.fieldsOk();a?this.dispatch("uploadProceed"):(this.setErrorMessage(MSGS.COMMON_Choose_File_Error),this.dispatch("noFileSelected"))},_checkFileUploadStatus:function(){var a,b;if(a=juic.$("iframe_"+this.id),a){var c=a.contentWindow||a.contentDocument;null!=c&&null!=c.document&&null!=c.document.body&&(b=c.document.body.innerHTML)}if(b){var d=b.indexOf("A file has triggered the anti-virus scanner."),e=b.indexOf("The file was not cleaned and has been removed."),f=b.indexOf("error code 500");if(-1!==d&&-1!==e||f){var g={};g.message=f?MSGS.COMMON_AJAX_DEFAULT_ERROR:MSGS.COMMON_Virus_Error,g.success=!1,g.result=g.message,this.handleResponse(g)}}},_getEncodingOptions:function(){return[{key:MSGS.COMMON_UTF_8,value:"UTF-8"},{key:MSGS.COMMON_ISO_8859_1,value:"ISO-8859-1"},{key:MSGS.COMMON_EUC_KR,value:"EUC-KR"},{key:MSGS.COMMON_GB2312,value:"GB2312"},{key:MSGS.COMMON_HZ,value:"HZ"},{key:MSGS.COMMON_Big5,value:"Big5"},{key:MSGS.COMMON_EUC_TW,value:"EUC-TW"},{key:MSGS.COMMON_EUC_JP,value:"EUC-JP"},{key:MSGS.COMMON_Shift_JIS,value:"Shift-JIS"}]},renderHtml:function(a){a.push("<div id=\"msgDiv_"+this.id+"\" >"),a.push("</div><div id=\""+this.id+"\">"),a.push("<form id=\"form_"+this.id+"\" role=\"form\""),a.push(" class=\"fileUploaderForm\""),this._instructions?(a.push(" aria-labelledby=\""+this.id+"_desc\">"),a.push("<div style=\"margin-bottom:10px;\" id=\""+this.id+"_desc\"><span class=\"instructions\">"+this._instructions+"</span></div>")):a.push(">"),this._formLayout.renderHtml(a),this.config&&this.config.fileSizeLimit&&a.push("<span id=\"",this.id,"_desc_uploadSizeDesc\">",MSGS.get("COMMON_ATTACHMENT_UPLOAD_SIZE_DESC",this.config.fileSizeLimit),"</span>"),a.push("</form></div>")},_createPostingFrame:function(){if(!juic.$("iframe"+this.id)){var a=document.createElement("iframe"),b="iframe_"+this.id;a.id=b,a.name=b,Util.browserInfo.ie&&(a.src=IMAGES["/ui/uicore/img/_.gif"]),juic.set(a.style,{display:"none",top:"0px",left:"0px"});var c=this._getForm();c.appendChild(a),window.frames[b].name=b,Util.browserInfo.ie&&(window.frames[b].src=IMAGES["/ui/juic/img/_.gif"])}},updateUrlParamsObj:function(a){this._urlParamsObj=a},_getQueryString:function(a){var b="";for(var c in a)b+=encodeURIComponent(c)+"="+encodeURIComponent(a[c])+"&";return b.substring(0,b.length-1)},setMessage:function(a){var b=juic.$("msgDiv_"+this.id);b&&("object"==typeof a?(a.render(b.id),SFDom.setFocus(juic.$(a.id+"_sysMsg"))):b.innerHTML=juic.escapeHTML(a))},clearMessage:function(){this.setMessage("")},doUpload:function(){this._createPostingFrame();var a=this;this._setIntervalId=setInterval(function(){return a._checkFileUploadStatus.apply(a)},1e3);var b=this._getQueryString(this._urlParamsObj);this.setFormAttributes({action:"/upload?name="+this._name+"&componentId="+this.id+"&responseHandler=handleResponse&&_s.crb="+ajaxSecKey+"&"+b,target:"iframe_"+this.id,method:"POST",enctype:"multipart/form-data",encoding:"multipart/form-data"}),this._submitForm()},getFileName:function(a){if(0<=a&&a<this._formFields.length){var b=this._formFields[a];if(null!=b)return b.getValue()}return null},_enableformItems:function(a){for(var b=0,c=this._formFields.length;b<c;b++)this._formFields[b].setEnabled(a)},_getForm:function(){if(!this._currentForm){var a=juic.$("form_"+this.id);if(!a&&this.config&&this.config.allowParentFormSubmission){for(var b=document.forms,c=b.length,d=juic.$(this.id);c--&&!a;)a=SFDom.isAncestor(b[c],d)?b[c]:null;this._usingParentForm=this._usingParentForm||!!a}this._currentForm=a}return this._currentForm},setFormAttributes:function(a){var b=this._getForm();for(var c in a)this._usingParentForm&&this.config&&this.config.allowParentFormSubmission&&(this._cacheParentFormProperties[c]=b.getAttribute(c)),b.setAttribute(c,a[c])},_submitForm:function(){try{this._getForm().submit(),this._enableformItems(!1),this.setLoadingMessage()}catch(a){this.dispatch("wrongFile"),this.setErrorMessage(MSGS.COMMON_Choose_File_Error)}},handleResponse:function(a){clearInterval(this._setIntervalId),this.clearMessage();var b,c=a.success,d=a.message;c?(b="uploadSucceeded",this.config&&this.config.multiUploadMode&&!0==this.config.multiUploadMode&&this._enableformItems(!0),this.setInfoMessage(d)):(b="uploadFailed",this._enableformItems(!0),this.setErrorMessage(d)),this.releaseResources(),this._cleanupCachedFormProperties(),this.dispatch(b,{response:a})},setUploadMsg:function(a){this._uploadMsg=a},setLoadingMessage:function(){this._uploadMsg||(this._uploadMsg=new SFLoading(MSGS.COMMON_Uploading_Text,"inherit")),this.setMessage(this._uploadMsg)},setLoadSuccessfullyMessage:function(){this._uploadSuccessfullyMsg||(this._uploadSuccessfullyMsg=new SFLoading(MSGS.COMMON_UPLOADED_SUCCESSFULLY,"inherit")),this.setMessage(this._uploadSuccessfullyMsg)},setErrorMessage:function(a){this.setMessage(new SFSysMsg("error",a))},setInfoMessage:function(a){this.setMessage(new SFSysMsg("info",a))},_cleanupParentForm:function(){var a=this._getForm(),b=this._cacheParentFormProperties;for(var c in b)a.setAttribute(c,b[c]),delete b[c]},_cleanupCachedFormProperties:function(){this._usingParentForm&&this.config&&this.config.allowParentFormSubmission&&this._cleanupParentForm(),this._currentForm=null},releaseResources:function(){var a=juic.$("iframe_"+this.id);a&&(a.src=IMAGES["/ui/juic/img/_.gif"],a.parentNode.removeChild(a))},cleanup:function(){this.releaseResources(),this._formLayout.cleanup(),this._super()}})})();