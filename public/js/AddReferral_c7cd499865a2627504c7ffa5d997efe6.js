function AddReferralDialog(a){assert(a,"AddReferral Dialog needs config object");this._config=a;this.register();this._init()}
AddReferralDialog.prototype=function(){return set(new Component,{_init:function(){this._addReferralContent=new AddReferralContent(this._config);this._addReferralContent.addEventListener("action",this);this.setDialogTitle(this._config.title?this._config.title:MSGS.RECRUITING_ADD_REFERRAL);this.context=this._config.context?this._config.context:"";this._refocusId=this._config.refocusId?this._config.refocusId:""},setDialogTitle:function(a){this._dialogTitle=a},getDialogTitle:function(){return this._dialogTitle},
_createDlg:function(a){var b=[{label:MSGS.COMMON_Send,eventName:"sendButtonClick",active:!0},{label:MSGS.COMMON_Cancel,eventName:"closeAddReferralDlg",active:!1,buttonDesign:"transparent"}],c=a.attachmentEnabled&&!a.hideResumeOption?360:220;Util.isFioriEnabled()&&(c=a.attachmentEnabled&&!a.hideResumeOption?411:303);this._dialog=new SFDialogBox({title:this.getDialogTitle(),content:this._addReferralContent,buttons:b,width:530,innerHeight:c,scrollable:!0,closeDialogOnEsc:!0});this._dialog.addEventListener("action",
this);this._dialog.showDialog(!0,this._refocusId);this._dialog.setShowCloseIcon(!1);SFDom.setFocus("infoDivId",!0);this.focusLoop()},focusLoop:function(){var a=jQuery(".sfoverlaycontainer"),b=a.find(".dialogHelpIcon"),c=a.find("input:first"),e=a.find(".buttonLayout .buttonWrapper:last button");if(b.length)b.on("keydown",function(a){"Tab"===a.key&&(a.preventDefault(),!a.shiftKey&&c.focus(),a.shiftKey&&e.focus())});else e.on("keydown",function(a){a.shiftKey||"Tab"!==a.key||(a.preventDefault(),c.focus())})},
renderHtml:function(a){a.push("\x3cdiv class\x3d'addReferralDialog' id\x3d'",this.id,"'\x3e");this._renderInner(a);a.push("\x3c/div\x3e")},rerender:function(){if(juic.$(this.id)){var a=[];this._renderInner(a);juic.$(this.id).innerHTML=a.join("")}},_renderInner:function(a){},showDialog:function(a,b){this._dialog.showDialog(a,b);this._dialog.setShowCloseIcon(!1)},_closeDlg:function(){this._dialog.close()},_cleanup:function(){this._addReferralContent.removeEventListener("action",this);this._addReferralContent.cleanup();
this._dialog.removeEventListener("action",this);this.unregister()},_addReferral:function(){this._addReferralContent.addReferral()},handleEvent:function(a){var b=this;if("action"==a.type)switch(a.actionCommand){case "GetAddReferralInfoCompleted":this._loadingIcon=new SFLoading("","",{isNewLoadingIndicator:!0});SFOverlayMgr.showOverlay(this._loadingIcon,!0);setTimeout(function(){SFOverlayMgr.removeOverlay(b._loadingIcon.id);b._createDlg(a.actionData);b._addReferralContent.setFocus()},1100);break;case "closeAddReferralDlg":this._closeDlg();
break;case "addReferralCompleted":this._dialog.disableButtons();this._addReferralContent._statusMsgDivId&&SFDom.setFocus(juic.$(this._addReferralContent._statusMsgDivId));var c=this;setTimeout(function(){c._closeDlg();"addReferral"==c.context&&window.location.reload()},4E3);break;case "sendButtonClick":this._addReferral()}}})}();function ReferralContentScrollBox(a,b){this._addReferralContent=a;this._scrollHeight=b}
juic.extend(ReferralContentScrollBox,SFScrollBox,{renderHtml:function(a){this._dialogBox=new SFScrollBox(this._addReferralContent,{height:this._scrollHeight,vertical:!1});this._dialogBox.renderHtml(a)}});function AddReferralContent(a){this.register();this._config=a;this._jobReqId=this._config.jobReqId?this._config.jobReqId:"";this._init()}
AddReferralContent.prototype=function(){return set(new Component,{_init:function(){this._fieldItems={FIRST_NAME:0,LAST_NAME:1,EMAIL:2};this._fieldLabels=[MSGS.RECRUITING_FIRST_NAME,MSGS.RECRUITING_LAST_NAME,MSGS.COMMON_Email];this._fields=[];this._formLayout=new SFInputFormLayout;for(var a=0;a<this._fieldLabels.length;a++)this._fields[a]=new SFTextField("",{size:40,required:!0,ariaLabel:this._fieldLabels[a]}),this._formLayout.addField(this._fieldLabels[a],this._fields[a],{required:!0});this._statusMsgDivId=
this.id+"_statusMsg";this._validationMesgDivId=this.id+"_validationMsg";this._configCompleted=!1;this._addReferralVO=this._fileUpload=this._countryValue=this._countryPicklist=this._phone=null;this._actionDAO=new AddReferralsDAO;this._actionDAO.addEventListener("action",this);this._actionDAO.getAddReferralInfo()},renderHtml:function(a){a.push("\x3cdiv class\x3d'addReferralContent' id\x3d'",this.id,"'\x3e");this._renderInner(a);a.push("\x3c/div\x3e")},rerender:function(){if(juic.$(this.id)){var a=[];
this._renderInner(a);juic.$(this.id).innerHTML=a.join("")}},_renderInner:function(a){this._configCompleted&&(a.push("\x3cdiv tabindex\x3d'0' id\x3d'",this._statusMsgDivId,"' style\x3d'display:none;'\x3e\x3c/div\x3e"),a.push("\x3cdiv id\x3d'",this._validationMesgDivId,"' style\x3d'display:none;'\x3e\x3c/div\x3e"),a.push("\x3cdiv class\x3d'addReferralHeading'\x3e\x3cspan id\x3d'infoDivId'\x3e",MSGS.RECRUITING_PROVIDE_INFO_BELOW,":\x3c/span\x3e\x3c/div\x3e"),this._formLayout.renderHtml(a),a.push("\x3cdiv class\x3d'referralFileUpload'\x3e"),
this._fileUpload&&this._fileUpload.renderHtml(a),a.push("\x3c/div\x3e"))},_isEmpty:function(a){return null==a||""==a},cleanup:function(){this._actionDAO.removeEventListener("action",this);this._countryPicklist&&this._countryPicklist.removeEventListener("picklistChanged",this);this._fileUpload&&(this._fileUpload.removeEventListener("uploadSucceeded",this),this._fileUpload.removeEventListener("uploadFailed",this));this.unregister()},_handleGetAddReferralInfoCompleted:function(a){this._addReferralVO=
a.actionData;this._addReferralVO.hasPhoneField&&(this._phone=new SFTextField("",{size:40,ariaLabel:MSGS.RECRUITING_PHONE,required:this._addReferralVO.phoneFieldRequired}),this._formLayout.addField(MSGS.RECRUITING_PHONE,this._phone,{required:this._addReferralVO.phoneFieldRequired}));this._addReferralVO.hasCountryField?(a=this._addReferralVO.countryPicklist,this._picklistMgr=new SFCascadingPicklistsManager,this._picklistConfig={fieldName:a.fieldId,picklistId:a.picklistFieldId,picklistMgr:this._picklistMgr,
defaultOptionList:a.selectList,validationMsg:a.validationMessage,selectedValue:a.stringValue,unsavedClass:"unsaved",required:!0,toolTipText:MSGS.COMMON_Country},this._countryPicklist=new SFCascadingPicklist(this._picklistConfig),this._countryPicklist.addEventListener("picklistChanged",this),this._countryPicklist.setAriaRequired(!0),this._formLayout.addField(MSGS.COMMON_Country,this._countryPicklist,{required:!0})):SFMessageBox.alert(MSGS.RECRUITING_ERP_MISSING_COUNTRY_PICKLIST,{title:MSGS.COMMON_Err});
this._addReferralVO.attachmentEnabled||1!=this._addReferralVO.requireResumeOption?this._addReferralVO.attachmentEnabled&&!this._addReferralVO.hideResumeOption&&(this._fileUpload=new SFFileUpload("addReferralAttachmentController",1,!1,null,"\x3cdiv role\x3d'note'\x3e"+MSGS.RECRUITING_ADD_RESUME+"\x3cbr\x3e"+MSGS.RCM_FILE_UPLOAD_INSTRUCTION_NO_HTML+"\x3c/div\x3e",{multiUploadMode:!1,size:30,required:1==this._addReferralVO.requireResumeOption}),this._fileUpload.addEventListener("uploadSucceeded",this),
this._fileUpload.addEventListener("uploadFailed",this)):SFMessageBox.alert(MSGS.RECRUITING_ERP_REQUIRE_RESUME_CONFIG_ERR,{title:MSGS.COMMON_Err});this._configCompleted=!0;this.rerender()},setFocus:function(){juic.$(this._fields[0].id+"_txtFld").focus()},_checkFields:function(){for(var a=Util.isFioriFDEnabled()?"is-error":"errorborder",b=!1,c=[],e=[],d=0;d<this._fieldLabels.length;d++){var f=this._fields[d];this._isEmpty(f.getValue())?(this._addMissingField(c,this._fieldLabels[d]),b=!0,e.push(f),this._setAriaInvalid(f.id+
"_txtFld","true")):(SFDom.removeClass(f.id+"_txtFld",a),this._setAriaInvalid(f.id+"_txtFld","false"))}null==this._phone||!this._addReferralVO.phoneFieldRequired||null!=this._phone.getValue()&&""!=this._phone.getValue()?this._phone&&(SFDom.removeClass(this._phone.id+"_txtFld",a),this._setAriaInvalid(this._phone.id+"_txtFld","false")):(this._addMissingField(c,MSGS.RECRUITING_PHONE),b=!0,e.push(this._phone),this._setAriaInvalid(this._phone.id+"_txtFld","true"));null==this._countryPicklist||!this._addReferralVO.countryPicklist.required||
null!=this._countryValue&&""!=this._countryValue?(SFDom.removeClass(this._countryPicklist.id+"_select",a),this._setAriaInvalid(this._countryPicklist.id+"_select","false")):(this._addMissingField(c,MSGS.COMMON_Country),b=!0,e.push(this._countryPicklist),this._setAriaInvalid(this._countryPicklist.id+"_select","true"));if(1==this._addReferralVO.requireResumeOption){if(null==this._fileUpload)return this._setValidationMsg(MSGS.RECRUITING_ERP_REQUIRE_RESUME_CONFIG_ERR),!1;d=this._fileUpload.getFileName(0);
null==d||""==d?(this._addMissingField(c,MSGS.RECRUITING_Resume),b=!0,e.push(this._fileUpload)):this._fileUpload._name&&"addReferralAttachmentController"==this._fileUpload._name&&(d=SFDom.getElementsByClassName("fd-file-uploader"),0<d.length&&(d=d[0].childNodes[0])&&d.classList.remove(a))}if(b){b=c.join("");b=-1==b.indexOf(",")?MSGS.COMMON_Required_Field_Err.replace("{0}",b):MSGS.COMMON_Required_Fields_Err.replace("{0}",b);this._setValidationMsg(b);if(0<e.length)for(SFDom.setFocus(e[0]),b=0;b<e.length;b++)c=
e[b],SFDom.addClass(c.id+"_txtFld",a),SFDom.addClass(c.id+"_select",a),this._setAriaInvalid(c.id+"_txtFld","true"),this._setAriaInvalid(c.id+"_select","true"),c._name&&"addReferralAttachmentController"==c._name&&(d=SFDom.getElementsByClassName("fd-file-uploader"),0<d.length&&(d=d[0].childNodes[0])&&d.classList.add(a));return!1}e=[];b=[];c=this._fields[this._fieldItems.EMAIL];Util.isValidEmail(c.getValue())?(SFDom.removeClass(c.id+"_txtFld",a),this._setAriaInvalid(c.id+"_txtFld","false")):(e.push(MSGS.RECRUITING_INVALID_EMAIL),
b.push(c),SFDom.addClass(c.id+"_txtFld",a),this._setAriaInvalid(c.id+"_txtFld","true"));a=/[\~\`!#\$%\^&*+=\[\]\\;,/{}|\\":<>\?]/;c=this._fields[this._fieldItems.FIRST_NAME];d=this._fields[this._fieldItems.LAST_NAME];a.test(c.getValue())&&(e.push(MSGS.RCM_INVALID_FIRST_NAME),b.push(c));a.test(d.getValue())&&(e.push(MSGS.RCM_INVALID_LAST_NAME),b.push(d));a=0==e.length;a||(this._setValidationMsg(e.join(" ")),0<b.length&&SFDom.setFocus(b[0]));return a},_setAriaInvalid:function(a,b){juic.$(a)&&juic.$(a).setAttribute("aria-invalid",
b)},_setErrMsg:function(a){var b=[];a=new SFSysMsg("error",a);a.renderHtml(b);this._setStatsMsg(b);SFDom.setFocus(a.id+"_sysMsg")},_setValidationMsg:function(a){var b=[];a=new SFSysMsg("error",a);a.renderHtml(b);var c=juic.$(this._validationMesgDivId);c.innerHTML=b.join("");c.style.display="block";SFDom.setFocus(a.id+"_sysMsg")},_clearValidationMsg:function(){var a=juic.$(this._validationMesgDivId);a.innerHTML="";a.style.display="none"},_setStatsMsg:function(a){var b=juic.$(this._statusMsgDivId);
b.innerHTML=a.join("");b.style.display="block"},_clearStatusMsg:function(){this._clearValidationMsg();var a=juic.$(this._statusMsgDivId);a.innerHTML="";a.style.display="none"},_setSuccessMsg:function(a){var b=[];a=new SFSysMsg("confirm",a);a.renderHtml(b);this._setStatsMsg(b);SFDom.setFocus(a.id+"_sysMsg")},_addMissingField:function(a,b){0<a.length&&a.push(", ");a.push(b)},addReferral:function(){this._clearStatusMsg();this._checkFields()&&(this._addReferralVO.attachmentEnabled&!this._addReferralVO.hideResumeOption?
this._addReferralWithResume():this._addReferralNoResume())},_addReferralWithResume:function(){var a={attachmentType:"RESUME",firstName:this._fields[this._fieldItems.FIRST_NAME].getValue(),lastName:this._fields[this._fieldItems.LAST_NAME].getValue(),email:this._fields[this._fieldItems.EMAIL].getValue(),phone:this._getPhoneValue(),country:this._countryValue,jobReqId:this._jobReqId};this._fileUpload.updateUrlParamsObj(a);a=this._fileUpload.getFileName(0);a=null!=a&&""!=a?new SFSimpleLoading(MSGS.COMMON_Uploading_Text,
"#666666"):new SFSimpleLoading(MSGS.RECRUITING_ADDING_REFERRAL,"#666666");this._fileUpload.setUploadMsg(a);this._fileUpload.doUpload()},_addReferralNoResume:function(){this._actionDAO.addReferral(this._fields[this._fieldItems.FIRST_NAME].getValue(),this._fields[this._fieldItems.LAST_NAME].getValue(),this._fields[this._fieldItems.EMAIL].getValue(),this._getPhoneValue(),this._countryValue,this._jobReqId)},_getPhoneValue:function(){return null==this._phone?"":this._phone.getValue()},handleEvent:function(a){switch(a.type){case "picklistChanged":this._countryValue=
a.newValue;break;case "uploadSucceeded":this._setSuccessMsg(a.response.message);this.dispatch("action",{actionCommand:"addReferralCompleted"});break;case "uploadFailed":this._setErrMsg(a.response.message);this.dispatch("action",{actionCommand:"addReferralFailed"});break;case "action":switch(a.actionCommand){case "GetAddReferralInfoCompleted":this.dispatch("action",{actionCommand:"GetAddReferralInfoCompleted",actionData:a.actionData});this._handleGetAddReferralInfoCompleted(a);break;case "GetAddReferralInfoError":a.actionData&&
SFMessageBox.alert(a.actionData,{title:MSGS.COMMON_Err});break;case "AddReferralCompleted":a.actionData&&!a.actionData.success&&a.actionData.message?(SFMessageBox.alert(a.actionData.message,{title:MSGS.COMMON_Err}),this.dispatch("action",{actionCommand:"closeAddReferralDlg"})):(this._setSuccessMsg(a.actionData.message),this.dispatch("action",{actionCommand:"addReferralCompleted"}));break;case "AddReferralError":a.actionData&&SFMessageBox.alert(a.actionData,{title:MSGS.COMMON_Err}),this.dispatch("action",
{actionCommand:"closeAddReferralDlg"})}}}})}();function AddReferralsDAO(){this._init()}
AddReferralsDAO.prototype=function(){return set(new juic.EventTarget,{_init:function(){this._employeeReferralsController=AjaxService.getMBeanInstance("employeeReferralsController")},getAddReferralInfo:function(){try{var a={model:this,callback:function(b){a.model.dispatch("action",{actionCommand:"GetAddReferralInfoCompleted",actionData:b})},errorHandler:function(b,c){a.model.dispatch("action",{actionCommand:"GetAddReferralInfoError",actionData:MSGS.RECRUITING_GET_ADD_REFERRAL_INFO_ERROR+"\nAJAX errorString\x3d"+
b+", exception.javaClassName\x3d"+c.javaClassName+", exception.message\x3d"+c.message})}};this._employeeReferralsController.getAddReferralInfo(a)}catch(b){this.dispatch("action",{actionCommand:"GetAddReferralInfoError",actionData:MSGS.RECRUITING_GET_ADD_REFERRAL_INFO_ERROR+"\x3cbr /\x3eJavaScript Exception\x3d"+b})}},addReferral:function(a,b,c,e,d,f){try{var g={model:this,callback:function(a){g.model.dispatch("action",{actionCommand:"AddReferralCompleted",actionData:a})},errorHandler:function(a,b){g.model.dispatch("action",
{actionCommand:"AddReferralError",actionData:MSGS.RECRUITING_ADD_REFERRAL_FAILED+"\nAJAX errorString\x3d"+a+", exception.javaClassName\x3d"+b.javaClassName+", exception.message\x3d"+b.message})}};this._employeeReferralsController.addReferral(a,b,c,e,d,f,g)}catch(h){this.dispatch("action",{actionCommand:"AddReferralError",actionData:MSGS.RECRUITING_ADD_REFERRAL_FAILED+"\x3cbr /\x3eJavaScript Exception\x3d"+h})}}})}();