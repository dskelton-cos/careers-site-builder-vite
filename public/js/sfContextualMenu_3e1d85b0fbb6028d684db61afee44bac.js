function SFContextualMenu(a,b,c,d,e,f,g,h){juic.assert(a||b,"Anchor Label or menu type should be declared."),this.register(),this._label=a,this._anchorType=b,this._links=[],this._menu=new SFList("popMenu",{ariaRole:"menu"}),this._autoHide=!!c&&c,this._clickShow=!!e&&e,this._style=!!f&&f,this._useIconFonts=!!g,h=h||{},this._ariaLabel=h.ariaLabel,this._ariaLabelledBy=h.ariaLabelledBy,this._title=h.title,d&&(this._focusId=d),this._isShown=!1,this._anchorTitle=null}SFContextualMenu.prototype=function(){return juic.set(new juic.Component,{addMenuItem:function(a){this._autoHide&&(a.addEventListener("mouseout",this),a.addEventListener("mouseover",this),a.addEventListener("action",this)),this._links.push(a),this._menu.add(a,{linkAriaRole:"menuitem",tabIndex:"-1"})},removeMenuItem:function(a){this._removeMenuListAndListeners(a);for(var b=0,c=this._links.length;b<c;b++)this._links[b]==a&&this._links.splice(b,1)},_removeMenuListAndListeners:function(a){this._menu.remove(a),this._autoHide&&(a.removeEventListener("mouseout",this),a.removeEventListener("mouseover",this),a.removeEventListener("action",this))},setEnabled:function(a,b){juic.assert(a.setEnabled,"Function setEnable does not exist for the object "+a.id),a.setEnabled(b)},setLabel:function(a){this._label=a,juic.$("label_"+this.id)&&(juic.$("label_"+this.id).innerHTML=a)},setAnchorTitle:function(a){this._anchorTitle=a},setAnchorType:function(a){this._anchorType=a},setMenuFocusPoint:function(a){juic.assert("label"===a||"anchor"===a,"Only anchor and label are accepted"),this._focusId=a+"_"+this.id},_getAnchorType:function(){switch(this._anchorType){case"arrowDown":return"menu_arrow_blue_border";break;case"gear":return"menu_gear_arrow";}return this._anchorType},hide:function(){this._isShown=!1,this.selectedIndex=-1;var a=this;SFDOMEvent.removeListener(window.document,"touchend",this._hideCallbackFn,this),SFDOMEvent.removeListener(window.document,"click",this._hideCallbackFn,this),SFDOMEvent.removeListener(window.document,"keydown",this._keyDownHandler,this),SFPositionManager.removeEventListener("positionFixed",a),this._positionInfo=null,this._menu.dispatch("hide"),clearTimeout(this.hideTimeout),delete this.hideTimeout},_hideCallbackFn:function(a){try{this._isClickOutsideOfMenu(a)&&(this._clearTimeOuts(),this.hide())}catch(a){}},_clearTimeOuts:function(){this.hideTimeout&&(clearTimeout(this.hideTimeout),delete this.hideTimeout),this._tid&&(clearTimeout(this._tid),delete this._tid)},_hideTimer:function(a){if(a){var b=this;this._clearTimeOuts(),this.hideTimeout=setTimeout(function(){b._hideOptions()},1e3)}else clearTimeout(this.hideTimeout),delete this.hideTimeout},_hideOptions:function(){this.hide();var a=juic.$(this._focusId?this._focusId:this._label?"label_"+this.id:"anchor_"+this.id);a&&SFDom.isDisplayed(a)&&(a.removeAttribute("aria-expanded"),a.removeAttribute("aria-controls"),a.focus())},_keyDownHandler:function(a){var b=SFDOMEvent.getKeyName(a);"ESCAPE"===b?(this._clearTimeOuts(),this._hideOptions()):"ARROWDOWN"===b||"ARROWUP"===b?(this._menu._focusNext("ARROWUP"==b),SFDOMEvent.preventDefault(a)):void 0},_selfKeyDown:function(a){var b=SFDOMEvent.getKeyName(a);"ARROWDOWN"===b?a.altKey&&(this._openSelector(),a.preventDefault()):"SPACEBAR"===b||"RETURN"===b||"ENTER"===b?(this._openSelector(),a.preventDefault()):void 0},_openSelector:function(a){if(!this._isShown){this._isShown=!0,this._clearTimeOuts();var b=this,c=200;a&&(c=0);var d=juic.$("label_"+b.id);return d&&(d.setAttribute("aria-expanded",!0),this._menu&&this._menu.id&&d.setAttribute("aria-controls",this._menu.id)),this._tid=setTimeout(function(){SFPositionManager.addEventListener("positionFixed",b),SFPositionManager.show(b._menu,b._focusId?b._focusId:b._label?"label_"+b.id:"anchor_"+b.id)},c),!1}},_stopShowingSelector:function(){this._hideTimer(!0)},_getIconEntity:function(){var a="&nbsp;";if(this._useIconFonts)switch(this._anchorType){case"gear":a="&#xe00c;";break;case"arrowDown":a="&#xe1ef;";}return a},renderHtml:function(a){var b=this.isFioriFDEnabled();if(a.push("<span id=\"",this.id,"\" class=\"sfContextualMenu globalPortletLinkTextColor\" style=\"white-space: nowrap;\">"),this._label)a.push("<a class=\"SFContextualMenuLabel link ",this.generateFDClasses("button",["menu"]),"\" id=\"label_",this.id,"\" tabindex=\"0\" role=\"button\" aria-haspopup=\"menu\" "),this._ariaLabelledBy&&a.push("aria-labelledby=\""+this._ariaLabelledBy+"\" "),this._ariaLabel&&a.push("aria-label=\""+this._ariaLabel+"\" "),this._title&&a.push("title=\"",this._title,"\" "),this._clickShow||a.push("onmouseover=\""+this.fireCode("_openSelector")+"\" "),a.push("onkeydown=\""+this.fireCode("_selfKeyDown")+"\" "),this._autoHide&&a.push("onmouseout=\""+this.fireCode("_stopShowingSelector")+"\" "),a.push("onclick=\""+this.fireCode("_openSelector",!0)+"return false;\">"),b?a.push("<span class=\"",this.generateFDClasses("button__text"),"\">",Util.escapeHTML(this._label),"</span>"):a.push(Util.escapeHTML(this._label)),a.push("<span class=\"",this._getAnchorType(),this._useIconFonts?" sfContextualMenuIcon sapIcon sap-icon":""),a.push("\">",this._getIconEntity(),"</span> "),a.push("</a>");else{a.push("<a id=\"anchor_"+this.id+"\" class=\""+this._getAnchorType()+(this._useIconFonts?" sapIcon sap-icon ":" ")+this.generateFDClasses("button",["menu"])+"\" tabindex=\"0\" role=\"button\" aria-haspopup=\"true\" "),this._ariaLabelledBy&&a.push("aria-labelledby=\""+this._ariaLabelledBy+"\" "),this._ariaLabel&&a.push("aria-label=\""+this._ariaLabel+"\" ");var c=this._anchorTitle||this._title;c&&a.push("title=\"",c,"\" "),this._style&&a.push("style=\"",this._style,"\" "),this._clickShow||a.push("onmouseover=\""+this.fireCode("_openSelector")+"\" "),a.push("onkeydown=\""+this.fireCode("_selfKeyDown")+"\" "),this._autoHide&&a.push("onmouseout=\""+this.fireCode("_stopShowingSelector")+"\" "),a.push("onclick=\""+this.fireCode("_openSelector",!0)+"; return false;\">&nbsp;</a>")}a.push("</span>")},handleEvent:function(a){switch(a.type){case"mouseout":this._hideTimer(!0);break;case"mouseover":this._hideTimer(!1);break;case"action":"mouseout"==a.actionCommand?this._hideTimer(!0):"mouseover"==a.actionCommand?this._hideTimer(!1):"focus"==a.actionCommand&&this._menu.onItemFocus(a.actionData);break;case"positionFixed":if(this._isMatchingOverlay(a)){this._positionInfo=a.positionInfo,this._menu.setFocus(!1),this._menu.addMenuitemRoles();var b=this;window.setTimeout(function(){SFDOMEvent.addListener(window.document,"click",b._hideCallbackFn,b),SFDOMEvent.addListener(window.document,"keydown",b._keyDownHandler,b),SFDOMEvent.addListener(window.document,"touchend",b._hideCallbackFn,b)},500),this.dispatchEvent(a)}break;default:}},cleanup:function(){for(var a=0,b=this._links.length;a<b;a++)this._links[a].cleanup();this.unregister()},_isMatchingOverlay:function(a){var b=juic.$(a.positionInfo.overlay.overlayId);if(b)for(var c=b.childNodes,d=0;d<c.length;d++)if(c[d].id===this._menu.id)return!0;return!1},_isClickOutsideOfMenu:function(a){var b=SFDOMEvent.getTarget(a||window.event);return!SFDom.isAncestor(this._menu.id,b)}})}();