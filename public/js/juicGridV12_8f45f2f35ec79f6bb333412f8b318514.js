function SFAbstractFocusManager(){assert(!1,"SFAbstractFocusManager: Do not directly call constructor")}juic.extend(SFAbstractFocusManager,juic.EventTarget,{getNextFocusableColumn:function(){assert(!1,"SFAbstractFocusManager: Must implement getNextFocusable")},getNextFocusableRow:function(){assert(!1,"SFAbstractFocusManager: Must implement getNextFocusableRow")}});function SFAbstractGridProvider(){assert(!1,"SFAbstractGridProvider: Please do not instantiate")}extend(SFAbstractGridProvider,juic.EventTarget,{getCells:function(){assert(!1,"SFAbstractGridProvider: Please override getCells")},handleStaleCell:function(){},handleVisibleCell:function(){},handleRemovedCell:function(){}});function SFAbstractAxisMetaData(){assert(!1,"SFAbstractAxisMetaData: Do not directly call constructor")}juic.extend(SFAbstractAxisMetaData,juic.EventTarget,{getMetaData:function(){assert(!1,"SFAbstractAxisMetaData: must implement getMetaData")},getAllocationValue:function(){assert(!1,"SFAbstractAxisMetaData: must implement getAllocationValue")},getIndexAtOffset:function(){assert(!1,"SFAbstractAxisMetaData: must implement getAllocationValue")},getMinimumSize:function(){assert(!1,"SFAbstractAxisMetaData: must implement getMinimumSize")},getIndicesWithValue:function(){assert(!1,"SFAbstractAxisMetaData: must implement getIndicesWithValue")},size:function(){assert(!1,"SFAbstractAxisMetaData: must implement size")},setMetaData:function(){},move:function(){},remove:function(){},insert:function(){}});function SFArrayGridProvider(e){this._gridArray=e}(function(){extend(SFArrayGridProvider,SFAbstractGridProvider,{getCells:function(e,t,a,o){for(var n=[],i=a;i<=o;i++){n[i-a]=[];for(var r=e;r<=t;r++)n[i-a][r-e]=this._gridArray[i]&&this._gridArray[i][r]}this.dispatch("gridAvailable",{grid:n,region:{columnFrom:e,columnTo:t,rowFrom:a,rowTo:o}})},setCellsOnAxis:function(t,a,o){for(var n=e[t],i=0;i<o.length;i++)n.setGridValue(this._gridArray,a,i,o[i]);for(var r=[],i=0;i<o.length;i++)n.setGridValue(r,a,i,o[i]);var s="y"==t;this.dispatch("refreshRegion",{rowFrom:s?0:a,rowTo:s?o.length:a,columnFrom:s?a:0,columnTo:s?a:o.length,grid:r})},setCell:function(t,a,o){e.y.setGridValue(this._gridArray,t,a,o),this.dispatch("refreshRegion",{rowFrom:t,rowTo:t,columnFrom:a,columnTo:a})}});var e={x:{type:"x",opposite:"y",setGridValue:function(e,t,a,o){e[a]=e[a]||[],e[a][t]=o}},y:{type:"x",opposite:"y",name:"row",setGridValue:function(e,t,a,o){e[t]=e[t]||[],e[t][a]=o}}}})();function SFGridMetaData(e,t){this._init(e,t)}(function(){extend(SFGridMetaData,juic.EventTarget,{_init:function(e,t){assert(null==e||e instanceof Array||e instanceof SFAbstractAxisMetaData,"SFGridMetaData: Please use an array to specify the column meta."),assert(null==t||t instanceof Array||t instanceof SFAbstractAxisMetaData,"SFGridMetaData: Please use an array to specify the row meta."),this._columnMeta=e||[],this._rowMeta=t||[]},getRowMetaData:function(e,t){return this.getMetaData("y",e,t)},getColumnMetaData:function(e,t){return this.getMetaData("x",e,t)},getMetaData:function(e,t,a){return this._forAxis(e,function(o){var n=this[o.meta];if(null==t)return n;if(n instanceof SFAbstractAxisMetaData)return n.getMetaData(t,a);if(this.isValidIndex(e,t,!0)){var i=n[t];return a?i[a]:i}})},getIndicesWithValue:function(e,t,a){return this._forAxis(e,function(e){var o=this[e.meta];if(o instanceof SFAbstractAxisMetaData)return o.getIndicesWithValue(t,a);for(var n,i=[],r=0,s=o.length;r<s;r++)n=o[r],"function"==typeof t?t.call(this,n)&&i.push(r):n[t]==a&&i.push(r);return i})},setRowMetaData:function(e,t,a){this.setMetaData("y",e,t,a)},setColumnMetaData:function(e,t,a){this.setMetaData("x",e,t,a)},setMetaData:function(e,t,a,o){this.isValidIndex(e,t,!0)&&this._forAxis(e,function(n){var i,r=this[n.meta];if(r instanceof SFAbstractAxisMetaData){var s=r.getMetaData(t);i=s&&s[a],r.setMetaData(t,a,o)}else i=r[t][a],r[t][a]=o;this.dispatch("metaDataUpdated",{axisType:e,index:t,key:a,value:o,oldValue:i})})},appendRow:function(e){this.append("y",e)},appendColumn:function(e){this.append("x",e)},append:function(e,t){this.insert(e,t,this.size(e))},insertRow:function(e,t){this.insert("y",e,t)},insertColumn:function(e,t){this.insert("x",e,t)},insert:function(e,t,a){a===void 0&&(a=this.size(e)),this.isValidIndex(e,a,!0,!0)&&this._forAxis(e,function(o){var n=this[o.meta],i=1;if(n instanceof SFAbstractAxisMetaData)i=t,n.insert(t,a);else if(t instanceof Array){for(var r=0;r<t.length;r++)n.splice(a+r,0,t[r]);i=t.length}else n.splice(a,0,t);this.dispatch("intervalAdded",{axisType:e,index:a,count:i})})},removeRow:function(e,t){this.remove("y",e,t)},removeColumn:function(e,t){this.remove("x",e,t)},remove:function(e,t,a){a=null==a?1:a,this.isValidIndex(e,t,!0)&&this.isValidIndex(e,t+a-1,!0)&&this._forAxis(e,function(o){var n,i=this[o.meta];i instanceof SFAbstractAxisMetaData?i.remove(t,a):n=i.splice(t,a),this.dispatch("intervalRemoved",{axisType:e,index:t,count:a,removed:n})})},moveRows:function(e,t,a){this.move("y",e,t,a)},moveColumns:function(e,t,a){this.move("x",e,t,a)},move:function(e,t,a,o){this._forAxis(e,function(n){var i=this[n.meta];if(i instanceof SFAbstractAxisMetaData)i.move(t,a,o);else{var r=i.splice(t,o);r.splice(0,0,a,0),i.splice.apply(this[n.meta],r)}this.dispatch("intervalMoved",{axisType:e,fromIndex:t,toIndex:a,count:o})})},getColumnSize:function(){return this.size("x")},getRowSize:function(){return this.size("y")},size:function(e){if(e)return this._forAxis(e,function(e){var t=this[e.meta];return t instanceof SFAbstractAxisMetaData?t.size():t.length});var t={};return this._forEachAxis(function(e){t[e.name+"Size"]=this.size(e.type)}),t},isValid:function(e,t,a,o){return this.isValidIndex("x",t,a,o)&&this.isValidIndex("y",e,a,o)},isValidIndex:function(e,t,a,o){return this._forAxis(e,function(n){var i=this.size(e)-(o?0:1);if(t instanceof Array){for(var r=0;r<t.length;r++)if(!this.isValidIndex(e,t[r],o,a))return!1;return!0}var s=0<=t&&t<=i;return a&&assert(s,"SFGridMetaData: Invalid "+n.name+" index: "+t+" not in [0, "+i+"]"),s})},_forAxis:function(t,a){var o="x"==t||"y"==t;if(assert(o,"SFGridMetaData: Invalid axisType "+t),o){var n=e[t];return a.call(this,n,e[n.opposite])}},_forEachAxis:function(t){for(var a in e)this._forAxis(a,t)}});var e={x:{type:"x",opposite:"y",name:"column",index:"columnIndex",from:"columnFrom",to:"columnTo",meta:"_columnMeta"},y:{type:"x",opposite:"y",name:"row",index:"rowIndex",from:"rowFrom",to:"rowTo",meta:"_rowMeta"}}})();function SFGridSpans(){this._axisSpans={},this._allSpans=[],this._spans={}}(function(){var e=Math.max,t=Math.min;juic.extend(SFGridSpans,juic.EventTarget,{setMetaData:function(e){this._metaData&&(this._metaData.removeEventListener("intervalAdded",this),this._metaData.removeEventListener("intervalRemoved",this),this._metaData.removeEventListener("intervalMoved",this),this._metaData=null),e&&(this._metaData=e,this._metaData.addEventListener("intervalAdded",this,"_onIntervalAdded"),this._metaData.addEventListener("intervalRemoved",this,"_onIntervalRemoved"),this._metaData.addEventListener("intervalMoved",this,"_onIntervalMoved"))},addSpan:function(e,t,a,o){if(1!=a||1!=o){var n=this.get(e,t),i={rowIndex:e,columnIndex:t,rowSpan:a,columnSpan:o};1<i.rowSpan&&(this._axisSpans.y=this._axisSpans.y||[],this._axisSpans.y.push(i)),1<i.columnSpan&&(this._axisSpans.x=this._axisSpans.x||[],this._axisSpans.x.push(i)),this._allSpans.push(i),this._addToGrid(i),this.dispatch("spanChanged",{rowIndex:e,columnIndex:t,oldSpan:n,newSpan:{rowSpan:a,columnSpan:o}})}},removeSpan:function(e,t){var a=this.get(e,t),o=this._getSpanByAxis("y",e,t);o&&!o.extender&&(this._removeSpan(o),this._refreshGrid()),this.dispatch("spanChanged",{rowIndex:e,columnIndex:t,oldSpan:a,newSpan:{rowSpan:1,columnSpan:1}})},get:function(e,t){var a=this._getSpanByAxis("y",e,t);return a?a.extender?null:{rowSpan:a.rowSpan,columnSpan:a.columnSpan}:{rowSpan:1,columnSpan:1}},isExtender:function(e,t){var a=this._getSpanByAxis("y",e,t);return a&&a.extender},getSpanOnAxis:function(e,t,a){var o="x"==e?a:t,n="x"==e?t:a,i=this._spans&&this._spans[o]&&this._spans[o][n];return i?i.extender?0:this._forAxis(e,function(e){return i[e.name+"Span"]}):1},getSpanOrigin:function(e,t,a){var o=this._getSpanByAxis(e,t,a);return o?(o.extender&&(o=o.origin),this._forAxis(e,function(e){return o[e.index]})):t},getRegionWithSpans:function(a,o){var n=set({},a);return this._spans&&this._forEachSpanInRegion(a,null==o||o,function(o){this._forEachAxis(function(i){var r=o[i.index],s=o[i.span],d=r+s-1,l=a[i.name+"From"],_=a[i.name+"To"];(r<=l&&d>=l||r<=_&&d>=_)&&(n[i.name+"From"]=t(n[i.name+"From"],r),n[i.name+"To"]=e(n[i.name+"To"],d))})}),n},getContainingSpan:function(a,o){return this._forAxis(a,function(n){var i=0,r=this._metaData.size(a)-1;this._forEachSpanOnLine(a,o,function(a){var o=a[n.index],s=a[n.span];if(1<s){i=e(i,o),r=t(r,o+s-1)}});var s={};return s[n.index]=i,s[n.span]=r-i+1,s})},isValidMove:function(a,o,n,i){return this._forAxis(a,function(r,s){var d=t(o,n),l=e(o+i-1,n+i-1),_=!0;if(!this._metaData.isValidIndex(a,d)||!this._metaData.isValidIndex(a,l))_=!1;else if(this._spans&&o!=n){var c={},u=o+i-1;c[r.from]=o,c[r.to]=u,c[s.from]=0,c[s.to]=this._metaData.size(s.type)-1,c=this.getRegionWithSpans(c,!1);var g=c[r.from],p=c[r.to],_=!0;if(!(g<o||p>u)){var m=n>o?n+i:n,h=m;this._forEachSpanOnLine(a,m,function(e){h=t(h,e[r.index])}),_=h==m}else if(1!=i)_=!1;else{var x=this.getContainingSpan(a,o);_=n>=x[r.index]&&n<x[r.index]+x[r.span]}}return _})},_onIntervalAdded:function(e){var t=e.axisType,a=e.index,o=e.count,n=!1;this._forEachSpanIn(t,a+1,null,function(e,t){n=!0,e[t.index]+=o}),n&&this._refreshGrid()},_onIntervalRemoved:function(e){var t=e.axisType,a=e.index,o=e.count;if(0<o){var n=[],i=!1;if(this._forEachSpanIn(t,a,null,function(e,t){e[t.index]>=a&&e[t.index]<=a+o-1?n.push(e):(i=!0,e[t.index]-=o)}),0<n.length){i=!0;for(var r=0;r<n.length;r++)this._removeSpan(n[r])}i&&this._refreshGrid()}},_removeSpan:function(e){this._removeSpanFrom(e,this._allSpans),this._removeSpanFrom(e,this._axisSpans.x),this._removeSpanFrom(e,this._axisSpans.y)},_removeSpanFrom:function(e,t){if(t)for(var a=t.length-1;0<=a;a--)if(t[a]===e){t.splice(a,1);break}},_onIntervalMoved:function(a){var o=a.axisType,n=a.fromIndex,i=a.toIndex,r=a.count;if(n!=i){var s=t(n,i),d=e(n+r-1,i+r-1),l=i-n;this._forEachSpanIn(o,s,d,function(e,t){e[t.index]>=n&&e[t.index]<=n+r-1?e[t.index]+=l:e[t.index]-=0<l?r:-r}),this._refreshGrid()}},_refreshGrid:function(){this._spans={};for(var e=0;e<this._allSpans.length;e++)this._addToGrid(this._allSpans[e])},_addToGrid:function(e){for(var t={origin:e,extender:!0},a=e.rowIndex,o=e.columnIndex,n=0;n<e.rowSpan;n++){this._spans[a+n]=this._spans[a+n]||{};for(var i=0;i<e.columnSpan;i++)this._spans[a+n][o+i]=0==n&&0==i?e:t}},_getSpanByAxis:function(e,t,a){var o="x"==e?a:t,n="x"==e?t:a;if(this._spans&&this._spans[o])return this._spans[o][n]},_forEachSpanOnLine:function(e,t,a){this._forEachSpanIn(e,t,t,a)},_forEachSpanIn:function(e,t,a,o){this._forAxis(e,function(n){var i=this._axisSpans[e];if(i)for(var r=0;r<i.length;r++){var s=i[r],d=s[n.index],l=d+s[n.span]-1,_=!1;_=null==a?d>=t||l>=t:t>=d&&t<=l||a>=d&&a<=l||t<=d&&a>=l,_&&o.call(this,s,n)}})},_forEachSpanInRegion:function(e,t,a){for(var o=0;o<this._allSpans.length;o++){var n=this._allSpans[o],i={};this._forEachAxis(function(t){var a=n[t.index],o=a+n[t.span]-1,r=e[t.from],s=e[t.to];(a>=r&&a<=s||o>=r&&o<=s)&&(i[t.type]=!0)});var r=t?i.x||i.y:i.x&&i.y;r&&a.call(this,n)}},_forAxis:function(e,t){var o="x"==e||"y"==e;if(assert(o,"SFGridMetaData: Invalid axisType "+e),o){var n=a[e];return t.call(this,n,a[n.opposite])}},_forEachAxis:function(e){for(var t in a)this._forAxis(t,e)}});var a={x:{type:"x",opposite:"y",name:"column",index:"columnIndex",from:"columnFrom",to:"columnTo",span:"columnSpan"},y:{type:"x",opposite:"y",name:"row",index:"rowIndex",from:"rowFrom",to:"rowTo",span:"rowSpan"}}})();function SFGridAllocation(e){this._init(e)}(function(){var e=Math.max,t=Math.min;function a(e,t){if(!e||!t)return null;var a=o("x",e,t),n=o("y",e,t);return a&&n&&set(a,n)}function o(a,o,n){if(!o||!n)return null;var i=r[a],s=o[i.name+"From"],d=o[i.name+"To"],l=n[i.name+"From"],_=n[i.name+"To"];if(s>=l&&s<=_||d>=l&&d<=_){var c={};return c[i.name+"From"]=e(s,l),c[i.name+"To"]=t(d,_),c}}function n(e,t,o){var n=a(e,t);if(n){for(var r=i("x",e,n),s=i("y",e,n),d=0;d<s.length;d++)o.push(set({columnFrom:e.columnFrom,columnTo:e.columnTo},s[d]));for(var d=0;d<r.length;d++)o.push(set({rowFrom:n.rowFrom,rowTo:n.rowTo},r[d]))}else o.push(set({},e))}function i(e,t,a){var n=o(e,t,a),i=r[e],s=[],d=t[i.name+"From"],l=t[i.name+"To"];if(n){var _=n[i.name+"From"],c=n[i.name+"To"];if(d!=_){var u={};u[i.name+"From"]=d,u[i.name+"To"]=_-1,s.push(u)}if(l!=c){var u={};u[i.name+"From"]=c+1,u[i.name+"To"]=l,s.push(u)}}else{var u={};u[i.name+"From"]=d,u[i.name+"To"]=l,s.push(u)}return s}juic.extend(SFGridAllocation,juic.EventTarget,{_init:function(e){this._spans=e.spans,this._innerScroll=e.innerScroll,this._axisData={},this._forEachAxis(function(t){var a=e[t.name+"Options"];this._axisData[t.type]={spacingOptions:a,adjusterSize:e.adjusterSize.x}})},setMetaData:function(e){this._metaData&&(this._metaData.removeEventListener("intervalAdded",this),this._metaData.removeEventListener("intervalRemoved",this),this._metaData.removeEventListener("intervalMoved",this),this._metaData=null),e&&(this._metaData=e,this._metaData.addEventListener("intervalAdded",this,"_onIntervalAdded"),this._metaData.addEventListener("intervalRemoved",this,"_onIntervalRemoved"),this._metaData.addEventListener("intervalMoved",this,"_onIntervalMoved"),this._initAxisData(),this._initSpacingManagers())},_initAxisData:function(){this._forEachAxis(function(e,t){var a=this._metaData.getIndicesWithValue(e.type,"adjustable",!0),o=this.determineCenterSection(e.type);assert(o,"SFGridAllocation: Invalid frozen sections on "+e.type+"-axis."),set(t,{adjustableCount:a.length}),set(t,o)})},_initSpacingManagers:function(){this._forEachAxis(function(e,t){var a=this._metaData.getMetaData(e.type);a instanceof SFAbstractAxisMetaData||(t.spacingManager=new SFSpacingManager(a,t.spacingOptions))})},allocate:function(){assert(this._dimension,"SFGridAllocation: Dimension was not set"),this._forEachAxis(function(e,t,a,o){t.lastAllocation=t.allocation;var n=t.allocation={centerStart:t.centerStart,centerEnd:t.centerEnd,adjusterSize:t.adjusterSize};if(this._innerScroll){var i=this.getMinimumSize(e.type),r=this.getMinimumSize(a.type);i+=t.adjustableCount*t.adjusterSize,r+=o.adjustableCount*o.adjusterSize;var s=this._dimension[e.dimension],d=this._dimension[a.dimension],l=r>d-(i>s?a.scrollBarSize:0);n.scrollRequired=i>s-(l?e.scrollBarSize:0)}}),this._forEachAxis(function(a,o,n,i){var r=o.allocation,s=this._metaData.getMetaData(a.type),d=this._dimension[a.dimension],l=i.allocation.scrollRequired?n.scrollBarSize:0;if(s instanceof SFAbstractAxisMetaData){r.sectionTotals=[];for(var _,c=0,u=0,g=0;3>g;g++)_=this.getValue(a.type,"sectionTotals",g),r.sectionTotals.push(_),1!=g&&(c+=_),u+=_;r.centerSize=this._innerScroll?t(d-c,u-c+l):r.sectionTotals[1],r.outerDimension=this._innerScroll?t(d,u):u}else{var p=o.adjusterSize*o.adjustableCount,m=e(1,d-l-p);r.sizes=o.spacingManager.allocate(m),r.cellSectionOffsets=[],r.sectionTotals=[0,0,0];for(var g=0;g<r.sizes.length;g++){var h=r.sizes[g],x=this._isAdjustable(a.type,g),S=this.getSectionIndex(a.type,g),f=h+(x?o.adjusterSize:0);r.cellSectionOffsets[g]=r.sectionTotals[S],r.sectionTotals[S]+=f}var y=d-r.sectionTotals[0]-r.sectionTotals[2],v=r.sectionTotals[1]+l;r.innerDimension=o.spacingManager.getActualSize()+p,this._innerScroll?(r.centerSize=t(y,v),r.outerDimension=t(d,r.innerDimension)):(r.centerSize=r.sectionTotals[1],r.outerDimension=r.innerDimension)}this._innerScroll&&(r.sectionOffsets=[0],r.sectionOffsets.push(r.sectionTotals[0]),r.sectionOffsets.push(r.sectionTotals[0]+r.centerSize))}),this._allocated=!0},getMinimumSize:function(e){var t=this._metaData.getMetaData(e);if(t instanceof SFAbstractAxisMetaData)return t.getMinimumSize();var a=this._axisData[e].spacingManager,o=a.getActualSize();return 0==this._axisData[e].adjustableCount&&(o=0),o||a.getMinimumSpace()},getValue:function(e,t,a){var o=this._metaData.getMetaData(e);if(o instanceof SFAbstractAxisMetaData)switch(t){case"outerDimension":case"centerSize":case"sectionOffsets":var n=this._axisData[e].allocation[t];return null==a?n:n[a];default:return o.getAllocationValue(t,a);}else{var i=this._axisData[e].allocation,n=i[t];return null==a?n:n[a]}},getAdjusterSize:function(e){return this._axisData[e].adjusterSize},setDimension:function(e){this._dimension=e},getCellDimension:function(e,t){var a={width:this.getCellAxisDimension("x",t,e),height:this.getCellAxisDimension("y",e,t)};return a},getCellAxisOffset:function(e,t,a){if(this._allocated)return this._forAxis(e,function(o,n){if(null==a){var i=this.getValue(e,"sizes",t);return this._isAdjustable(e,t)&&(i+=n.adjusterSize),i}var r=this._spans.getSpanOnAxis(e,t,a),i=this.getCellAxisDimension(e,t,a);return this._isAdjustable(e,t+r-1)&&(i+=n.adjusterSize),i})},getCellAxisDimension:function(e,t,a){if(this._allocated)return this._forAxis(e,function(o,n){if(null==a)return this.getValue(e,"sizes",t);for(var i=n.allocation,r=this._spans.getSpanOnAxis(e,t,a),s=0,d=0;d<r;d++)if(s+=this.getValue(e,"sizes",t+d),d+1<r){var l=this._isAdjustable(e,t+d);s+=l?n.adjusterSize:0}return s})},setCellDimension:function(e,t,a){var o=a&&0<a.width&&0<a.height;assert(o,"SFGridLayout: Invalid dimension"),o&&this._allocated&&(this._axisData.x.spacingManager.setCustomSize(t,a.width),this._axisData.y.spacingManager.setCustomSize(e,a.height))},setSingleDimension:function(e,t,a){this._allocated&&this._axisData[e].spacingManager.setCustomSize(t,a)},setRowHeight:function(e,t){this.setSingleDimension("y",e,t)},setColumnWidth:function(e,t){this.setSingleDimension("x",e,t)},isPositionChanged:function(e,t){return this._hasIndexChangedPosition("y",e)||this._hasIndexChangedPosition("x",t)},isSizeChanged:function(e,t){for(var a=this._spans.getSpanOnAxis("y",e,t),o=this._spans.getSpanOnAxis("x",t,e),n=0;n<a;n++)if(this._hasIndexChangedSize("y",e+n))return!0;for(var i=0;i<o;i++)if(this._hasIndexChangedSize("x",t+i))return!0;return!1},getSectionIndex:function(e,t){var a=this._axisData[e];return t<a.centerStart?0:t<=a.centerEnd?1:t<this._metaData.size(e)?2:-1},getBodySectionIndices:function(){return{rowStart:this._axisData.y.centerStart,rowEnd:this._axisData.y.centerEnd,columnStart:this._axisData.x.centerStart,columnEnd:this._axisData.x.centerEnd}},setInnerScrollInfo:function(e){this._innerScrollInfo=e},setOuterScrollInfo:function(e){this._outerScrollInfo=e},reset:function(){this._centerRegion=null},getVisibleInfo:function(){if(this._innerScroll?!this._innerScrollInfo:!this._outerScrollInfo)return null;var e=this._centerRegion,t=this._getVisibleCenterRegion();this._centerRegion=t;var a={newRegions:[],staleRegions:[],visibleRegions:{},centerRegion:set({},t)};if(e){var o={x:i("x",t,e),y:i("y",t,e)},r={x:i("x",e,t),y:i("y",e,t)};n(t,e,a.newRegions),n(e,t,a.staleRegions),this._forEachAxis(function(e,t,n){function i(t,a,o){var i="x"==e.type?t:1,r="x"==e.type?1:t;if(a&&!this.isSectionEmpty(i,r))for(var s=this.getSectionAxisRegion(n.type,t),d=0;d<a.length;d++){var l=a[d],_={};_[e.name+"From"]=l[e.name+"From"],_[e.name+"To"]=l[e.name+"To"],_[n.name+"From"]=s.from,_[n.name+"To"]=s.to,o.push(_)}}i.call(this,0,o[e.type],a.newRegions),i.call(this,2,o[e.type],a.newRegions),i.call(this,0,r[e.type],a.staleRegions),i.call(this,2,r[e.type],a.staleRegions)})}else for(var s=0;3>s;s++)for(var d,l=0;3>l;l++)d=this._getVisibleSectionRegion(s,l,t),d&&a.newRegions.push(d);return this._forEachAxis(function(e){for(var o=[],n=0;3>n;n++){for(var i=null,r=0;!i&&3>r;){var s="x"==e.type?n:r,d="x"==e.type?r:n;i=this._getVisibleSectionRegion(d,s,t),r++}if(i){var l=i[e.name+"From"],_=i[e.name+"To"];o.push({from:l,to:_})}}a.visibleRegions[e.type]=o}),a},getSectionAxisRegion:function(e,t){var a=this._axisData[e];switch(t){case 0:return 0<a.centerStart?{from:0,to:a.centerStart-1}:null;case 1:return a.centerStart<=a.centerEnd?{from:a.centerStart,to:a.centerEnd}:null;case 2:var o=this._metaData.size(e);return a.centerEnd<o-1?{from:a.centerEnd+1,to:o-1}:null;}},isSectionEmpty:function(e,t){return"x"==e||"y"==e?this._forAxis(e,function(e,a){return 0===t?0==a.centerStart:2===t?a.centerEnd+1>=this._metaData.size(e.type):1===t?a.centerStart>a.centerEnd:void 0}):this.isSectionEmpty("x",t)||this.isSectionEmpty("y",e)},isScrollRequired:function(e){return this._allocated&&this._axisData[e].allocation.scrollRequired},getAdjusterSize:function(e){return this._axisData[e].adjusterSize},getSpacingBounds:function(e,t){return this._axisData[e].spacingManager.getBounds(t)},isAllocated:function(){return this._allocated},determineCenterSection:function(e){for(var t,a=this._metaData.size(e),o=this._metaData.getIndicesWithValue(e,"frozen",!0),n=-1,i=a,r=0;r<o.length&&(t=o[r],t==n+1);r++)n++;for(var r=o.length-1;0<=r;r--){var t=o[r],s=!1;if(t==i-1&&(n==i-1?2==this._metaData.getMetaData(e,t,"sectionIndex")&&(n--,s=!0):s=!0),s)i--;else break}var d=n+a-i+1,l=d==o.length;return l&&{centerStart:n+1,centerEnd:i-1,sectionHasCells:[0<=n,!0,i<a]}},_getVisibleCenterRegion:function(){var a={};this._forEachAxis(function(t,o){var n,i,r=o.allocation;if(this._innerScroll){var s=this._innerScrollInfo[t.type];n=s.inverse?s.oppositePosition:s.position,i=n+this.getValue(t.type,"centerSize")}else{var d=this._outerScrollInfo.gridPoint[t.type],l=this._outerScrollInfo.viewport[t.start],_=this._outerScrollInfo.viewport[t.end];n=e(0,l-d),i=_-d-this.getValue(t.type,"sectionTotals",2)-this.getValue(t.type,"sectionTotals",0)}var c=this._findCellAt(t.type,n);a[t.name+"From"]=c,a[t.name+"To"]=this._findCellAt(t.type,i,c)});var o=this._spans.getRegionWithSpans(a);return this._forEachAxis(function(n,i){var r=o[n.name+"From"],s=a[n.name+"From"],d=o[n.name+"To"],l=a[n.name+"To"];a[n.name+"From"]=e(i.centerStart,t(r-1,s)),a[n.name+"To"]=t(i.centerEnd,e(d+1,l))}),a},_findCellAt:function(e,t,a){var o=this.getSectionAxisRegion(e,1);if(o){var n=this._metaData.getMetaData(e);if(n instanceof SFAbstractAxisMetaData)return n.getIndexAtOffset(t);var i=o.to;null==a&&(a=o.from);for(var r,s=a+1;s<=i;s++)if(r=this.getValue(e,"cellSectionOffsets",s),r>t)return s-1;return i}var d=this._axisData[e];return null==a?d.centerStart:d.centerEnd},_getVisibleSectionRegion:function(e,t,a){if(!a)return null;var o={},n=!0;return this._forEachAxis(function(i){var r="x"==i.type?t:e,s=this.getSectionAxisRegion(i.type,r);if(n=n&&!!s,n){var d=s.from,l=s.to;1==r&&(d=a[i.name+"From"],l=a[i.name+"To"]),o[i.name+"From"]=d,o[i.name+"To"]=l}}),n&&o},_onIntervalAdded:function(e){var t=e.axisType,a=e.index,o=e.count;if(0<o){for(var n=[],i=0;i<o;i++)n.push(this._metaData.getMetaData(t,a+i));var r=this._axisData[t].spacingManager;r&&r.insertMultipleInto(a,n),this._initAxisData(),this._allocated&&this.allocate()}},_onIntervalRemoved:function(t){if(0<t.count){var a=this._axisData[t.axisType].spacingManager;if(a&&a.remove(t.index,t.count),this._initAxisData(),this._allocated&&this.allocate(),this._centerRegion){var o=t.count,n=t.index;this._forAxis(t.axisType,function(t){var a=this._centerRegion[t.name+"From"],i=this._centerRegion[t.name+"To"];a>n&&(this._centerRegion[t.name+"From"]=e(n,a-o)),i>n&&(this._centerRegion[t.name+"To"]=e(n+o-1,i-o))})}}},_onIntervalMoved:function(e){if(e.fromIndex!=e.toIndex){var t=this._axisData[e.axisType].spacingManager;t&&t.move(e.fromIndex,e.toIndex,e.count),this._allocated&&this.allocate()}},_hasIndexChangedPosition:function(e,t){var a=this._metaData.getMetaData(e);if(a instanceof SFAbstractAxisMetaData)return!0;var o=this._axisData[e].lastAllocation,n=this._axisData[e].allocation;return!o||n.cellSectionOffsets[t]!=o.cellSectionOffsets[t]},_hasIndexChangedSize:function(e,t){var a=this._metaData.getMetaData(e);if(a instanceof SFAbstractAxisMetaData)return!0;var o=this._axisData[e].lastAllocation,n=this._axisData[e].allocation;return!o||n.sizes[t]!=o.sizes[t]},_forAxis:function(e,t){var a="x"==e||"y"==e;if(assert(a,"SFGridMetaData: Invalid axisType "+e),a){var o=r[e],n=r[o.opposite],i=this._axisData&&this._axisData[e],s=this._axisData&&this._axisData[n.type];return t.call(this,o,i,n,s)}},_forEachAxis:function(e){for(var t in r)this._forAxis(t,e)},_isAdjustable:function(e,t){return this._metaData.getMetaData(e,t,"adjustable")}});var r={x:{type:"x",opposite:"y",name:"column",dimension:"width",start:"left",end:"right",scrollBarSize:17},y:{type:"y",opposite:"x",name:"row",dimension:"height",start:"top",end:"bottom",scrollBarSize:17}}})();function SFGridLayout(e){this.register(),this._init(e)}(function(){var e=Math.max,t=Math.min;function a(e){e=e||{};var t=e.provider,a=e.metaData,n=e.columnMetaData,i=e.rowMetaData,r=e.spans,s=e.padding,d=e.innerScroll;if(null==d&&(d=!0),s=d?null:o(s),n&&i&&(a=new SFGridMetaData(n,i)),!a||!(a instanceof SFGridMetaData))return assert(!1,"SFGridLayout: Must provide meta data of type SFGridMetaData"),null;if(r&&!(r instanceof SFGridSpans))return assert(!1,"SFGridLayout: spans has incorrect type."),null;r=r||new SFGridSpans,null==e.adjusterSize?adjusterSize={x:f,y:f}:!isNaN(e.adjusterSize)&&0<e.adjusterSize?adjusterSize={x:e.adjusterSize,y:e.adjusterSize}:(e.adjusterSize.x||e.adjusterSize.y)&&(adjusterSize={x:0<e.adjusterSize.x?e.adjusterSize.x:f,y:0<e.adjusterSize.y?e.adjusterSize.y:f});var l=e.dimension;l&&(0>=l.width||0>=l.height)&&(l=null);var _={};for(var c in C)_[c]="undefined"==typeof e[c]?C[c]:e[c];return set({provider:t,metaData:a,dimension:l,adjusterSize:adjusterSize,spans:r,padding:s},_)}function o(e){return"number"==typeof e?{top:e,right:e,bottom:e,left:e}:{top:isNaN(e&&e.top)?0:e.top,bottom:isNaN(e&&e.bottom)?0:e.bottom,left:isNaN(e&&e.left)?0:e.left,right:isNaN(e&&e.right)?0:e.right}}function n(e,t){return"section"+e+"-"+t}function i(e,t,a){return"x"==e?n(a,t):n(t,a)}function r(e,t){return"cell"+t+"-"+e}function s(e,t,a){return"x"==e?r(a,t):r(t,a)}function d(e,t){return"section"+t+"row"+e}function l(e,t,a){return null!=t&&e<t?t:null!=a&&e>a?a:e}var _="adjuster",c="gridCell",u="gridRow",g="contentWrapper cell",p="hoveringLine",m="rowFocusMarker",h="Dragging",x=Util.browserInfo.ios||Util.browserInfo.android,S=x,f=x?20:5,y=juic.Logger.getLogger("SFGridLayout"),v={},C={dragByResizing:!1,innerScroll:!0,focusable:!0,rowOptions:null,columnOptions:null,focusManager:null};extend(SFGridLayout,juic.Component,{_init:function(e){if(this._initThrottles(),e=a(e),e){if(this._dragByResizing=e.dragByResizing,this._allocation=new SFGridAllocation(e),this._spans=e.spans,this._spans.addEventListener("spanChanged",this,"_onSpanChanged"),this.setMetaData(e.metaData),this.setProvider(e.provider),this._scrollBars={},this._innerScroll=e.innerScroll,this._padding=e.padding,this._focusManager=e.focusManager,S&&this._innerScroll){var t=this.getAutoScroller();this._forEachAxis(function(e){this._scrollBars[e.type]=new SFScrollBar({axisType:e.type,autoScroller:t})})}e.dimension&&this._innerScroll&&this.setDimension(e.dimension)}this._isDraggable=!0},_initThrottles:function(){for(var e in this._throttles=[],v){var t=SFThrottleUtil.register(this,e,v[e]);this._throttles.push(t)}},_onLoad:function(){S&&!x&&this._innerScroll&&SFDOMEvent.addListener(juic.$(this.id).firstChild,E,this._onMouseWheel,this),this._innerScroll?this._dimension?this._handleUpdates():this.adjustToParent():(this.attach(),this.adjustToParent()),this.dispatch("ready")},cleanup:function(){for(var e=0;e<this._throttles.length;e++)SFThrottleUtil.unregister(this._throttles[e]);this.setProvider(null),this.setMetaData(null),S&&this._forEachAxis(function(e){this._scrollBars[e.type].cleanup()}),this.detach(),this._super()},attach:function(){if(!this._innerScroll){"undefined"!=typeof TopNavBar&&TopNavBar.showEvent&&(TopNavBar.hideEvent.subscribe(this._onWindowResize,this,!0),TopNavBar.showEvent.subscribe(this._onWindowResize,this,!0)),SFDOMEvent.addListener(window,"resize",this._onWindowResize,this),SFDOMEvent.addListener(window,"scroll",this._onWindowScroll,this);var e=document.querySelector(".globalPlacemat");e&&SFDOMEvent.addListener(e,"scroll",this._onWindowScroll,this),x&&SFDOMEvent.addListener(document,"touchmove",this._synchScroll,this)}else if(this._restoreScrollPosition){var t=juic.$(this.id+n(1,1));t&&(t.scrollTop=this._restoreScrollPosition.top,t.scrollLeft=this._restoreScrollPosition.left,this._restoreScrollPosition=null,this._synchScroll())}},detach:function(e){if(!this._innerScroll){"undefined"!=typeof TopNavBar&&TopNavBar.showEvent&&(TopNavBar.hideEvent.unsubscribe(this._onWindowResize,this),TopNavBar.showEvent.unsubscribe(this._onWindowResize,this)),SFDOMEvent.removeListener(window,"resize",this._onWindowResize,this),SFDOMEvent.removeListener(window,"scroll",this._onWindowScroll,this);var t=document.querySelector(".globalPlacemat");t&&SFDOMEvent.removeListener(t,"scroll",this._onWindowScroll,this),x&&SFDOMEvent.removeListener(window,"touchmove",this._synchScroll,this)}var a=juic.$(this.id);if(a&&!e)a.parentNode.removeChild(a);else if(this._innerScroll){var o=juic.$(this.id+n(1,1));o&&(this._restoreScrollPosition={left:o.scrollLeft,top:o.scrollTop})}},renderHtml:function(e){e.push("<div role=\"grid\" id=\"",this.id,"\" class=\"","sfGridLayout","\">"),this._renderContent(e),e.push("</div>"),e.addAfterRenderListener(this,"_onLoad")},reset:function(){this._clearGrid(),this._handleUpdates()},adjustToParent:function(){var e=juic.$(this.id);if(e)if(this._innerScroll){var t=SFDom.getSuggestedDimension(e.parentNode);t&&0<t.width&&0<t.height&&this.setDimension(t)}else{var a=SFDom.getSuggestedDimension(e.parentNode).width,o=x?0:17,n=SFDom.getViewportHeight(),i=o&&SFDom.getDocumentHeight()<=n,r=this._allocation.getMinimumSize("y");if(r>n){var s=a-(i?o:0);this._checkWidthAndSetDimension(s)}else{this._checkWidthAndSetDimension(a);var d=o&&SFDom.getDocumentHeight()<=SFDom.getViewportHeight();!!i!=!!d&&(a+=(d?1:-1)*o),this._checkWidthAndSetDimension(a)}}},_checkWidthAndSetDimension:function(e){0<e&&this.setDimension({width:e,height:0})},setDimension:function(e){var t=e&&(0<e.width||"auto"===e.width)&&(!this._innerScroll||0<e.height||"auto"===e.height);assert(t,"SFGridLayout: Invalid dimension"),t&&(this._dimension=set({},e),this._handleUpdates())},scrollTo:function(t,a){if(this._allocated){var o=this._innerScroll?juic.$(this.id+n(1,1)):window,i=SFDom.getScrollRegion(o);if(i){var r=SFDom.getXY(this.id+"content"),s=new SFPoint(r[0],r[1]);this._forEachAxis(function(n){var r="x"==n.type&&Util.isRTL(),d="x"==n.type?a:t,l=this._allocation.getSectionIndex(n.type,d);if(1==l){var _=i[n.nstart],c=this._allocation.getValue(n.type,"cellSectionOffsets",d),u=this._allocation.getValue(n.type,"sizes",d),g=this._allocation.getValue(n.type,"sectionTotals",1);this._isAdjustable(n.type,d)&&(u+=this._allocation.getAdjusterSize(n.type)),r&&(c=g-c-u);var p=i[n.nstart],m=i[n.dimension];if(!this._innerScroll){var h=s[n.type],x=this._allocation.getValue(n.type,"sectionTotals",0),S=this._allocation.getValue(n.type,"sectionTotals",2),f=this._padding[n.nstart],y=this._padding[n.nend];if(r){var v=x;x=S,S=v}p-=h,m-=x+S+f+y}var C=e(p-c,0),I=e(c+u-p-m,0);0<I&&0==C?SFDom.setScrollPosition(o,_+I,n.type):0<C&&0==I&&SFDom.setScrollPosition(o,_-C,n.type)}})}}},setFocus:function(e,t,a){if(!this._isVisible("y",e)||!this._isVisible("x",t)){this.scrollTo(e,t,a),null!=this._focusTimeout&&clearTimeout(this._focusTimeout);var o=this;this._focusTimeout=setTimeout(function(){o._focusTimeout=null,o.setFocus(e,t)},100)}else{var n=juic.$(this.id+r(e,t)),i=SFDom.findNextFocusableElement(n,n,!0);i&&this._focusElement(i)}},_focusElement:function(e){e.focus(),"INPUT"==e.nodeName&&"TEXT"==e.type.toUpperCase()&&setTimeout(function(){Util.browserInfo.ios?e.setSelectionRange(0,9999):e.select()},0)},getAutoScroller:function(){if(!this._autoScroller){var e;e=this._innerScroll?this.id+n(1,1):document.body,this._autoScroller=new SFAutoScroller({scrollEl:e}),this._autoScroller.addEventListener("autoScroll",this,"_synchScroll")}return this._autoScroller},getAllocation:function(){return this._allocation},getMetaData:function(){return this._metaData},setMetaData:function(e){if(this._metaData&&(this._metaData.removeEventListener("metaDataUpdated",this),this._metaData.removeEventListener("intervalAdded",this),this._metaData.removeEventListener("intervalRemoved",this),this._metaData.removeEventListener("intervalMoved",this),this._metaData=null),e){var t=e instanceof SFGridMetaData;assert(t,"SFGridLayout: metaData must be an SFGridMetaData"),t&&(this._spans.setMetaData(e),this._allocation.setMetaData(e),this._metaData=e,this._metaData.addEventListener("metaDataUpdated",this,"_onMetaDataUpdated"),this._metaData.addEventListener("intervalAdded",this,"_onIntervalAdded"),this._metaData.addEventListener("intervalRemoved",this,"_onIntervalRemoved"),this._metaData.addEventListener("intervalMoved",this,"_onIntervalMoved")),this._clearGrid(),this._handleUpdates()}},getProvider:function(){return this._provider},setProvider:function(e){if(this._provider&&(this._clearGrid(),this._provider.removeEventListener("gridAvailable",this),this._provider.removeEventListener("gridError",this),this._provider.removeEventListener("gridLoading",this),this._provider.removeEventListener("refreshRegion",this),this._provider=null),e){var t=e instanceof Array||e instanceof SFAbstractGridProvider;assert(t,"SFGridLayout: Provider must be an SFAbstractGridProvider or a 2D array"),t&&(this._provider=e instanceof Array?new SFArrayGridProvider(e):e,this._provider.addEventListener("gridAvailable",this,"_onGridAvailable"),this._provider.addEventListener("gridError",this,"_onGridError"),this._provider.addEventListener("gridLoading",this,"_onGridLoading"),this._provider.addEventListener("refreshRegion",this,"_onRefreshRegion")),this._handleUpdates()}},setPadding:function(e){if(!this._innerScroll){var t=this._padding;this._padding=o(e),t&&this._padding.top==t.top&&this._padding.right==t.right&&this._padding.bottom==t.bottom&&this._padding.left==t.left||this._synchScroll()}},getPadding:function(){return this._padding},setColumnWidths:function(e){for(var t,a=0;a<e.length;a++)t=e[a],null!=t&&this._allocation.setSingleDimension("x",a,t);this._handleUpdates()},getSingleDimension:function(e,t){return this._allocation.getValue("x","sizes",t)},setSingleDimension:function(e,t,a){this._allocation.setSingleDimension(e,t,a),this._handleUpdates()},getBodySectionIndices:function(){return this._allocation.getBodySectionIndices()},_onWindowResize:function(){var e=this;setTimeout(function(){e.adjustToParent()},1e3)},_onWindowScroll:function(){var e=this;this._scrollTimeout||(this._scrollTimeout=setTimeout(function(){e._scrollTimeout=null,e._synchScroll()},100))},_synchScroll:function(){var a=juic.$(this.id);if(this._allocated&&a){if(this._synching=!0,this._innerScroll){var o=this._getScrollInfo();this._forEachAxis(function(e){for(var t,a=0;3>a;a+=2)t=i(e.type,1,a),SFDom.setScrollPosition(this.id+t,o[e.type].position,e.type)});var r=juic.$(this.id+n(1,1));SFDom.updateStyle(r,this._getCenterScrollStyle()),this._allocation.setInnerScrollInfo(o),this._updateScrollBars()}else{var s=SFDom.getXY(a),d=SFDom.getViewportRegion(),l=SFDom.getDocumentWidth(),_=l-d.width;Util.isRTL()&&(s[0]+=a.offsetWidth);var c;Util.isRTL()?(c=new SFPoint(_-s[0],s[1]),d=new SFRegion(d.top,_-d.left,d.bottom,_-d.right)):c=new SFPoint(s[0],s[1]),this._allocation.setOuterScrollInfo({gridPoint:c,viewport:d}),this._forEachAxis(function(a){var o=this._allocation.getValue(a.type,"outerDimension"),n=this._padding[a.start],r=this._padding[a.end],s=this._allocation.getValue(a.type,"sectionTotals",0),l=this._allocation.getValue(a.type,"sectionTotals",1),_=this._allocation.getValue(a.type,"sectionTotals",2),u=c[a.type],g=d[a.nstart],p=d[a.dimension],m=e(n,u-g),h=m+s,x=e(m,t(p-_-r,u+o-_-g));"top"===a.start&&x<=h&&(m=u-g);var S=e(0,x-h),f=e(0,g+n-u);"x"==a.type&&Util.isRTL()&&(f=l-f-S);for(var y=0;3>y;y++){var v=juic.$(this.id+i(a.type,0,y)),C=juic.$(this.id+i(a.type,1,y)),I=juic.$(this.id+i(a.type,2,y));v.style[a.start]=m+"px",C.style[a.start]=h+"px",I.style[a.start]=x+"px",C.style[a.dimension]=S+"px",SFDom.setScrollPosition(C,f,a.type)}})}this._populateVisibleGrid();var u=this;this._synchTimeout&&clearTimeout(this._synchTimeout),this._synchTimeout=setTimeout(function(){u._synching=!1,u._synchTimeout=null},0)}},_getCenterScrollStyle:function(){var e={};return this._forEachAxis(function(t){var a=t.type,o=this._allocation.isScrollRequired(a);e["overflow-"+t.type]=o?"auto":"hidden"}),e},_onInnerScroll:function(t,a){if(!this._synching){var o=SFDom.getXY(this.id),i=SFDom.getViewportRegion(),r=new SFPoint(o[0],o[1]),s=juic.$(this.id+n(t,a));this._forEachAxis(function(o){var n="x"==o.type?a:t;if(1==n){var d=i[o.start],l=r[o.type],_=this._padding[o.start],c=this._padding[o.end],u=e(0,d-l),g=s[o.scrollPosition],p=g-u;0!=p&&("x"==o.type?window.scrollBy(p,0):window.scrollBy(0,p))}})}},_handleUpdates:function(){var e=juic.$(this.id);if(e&&this._dimension){var t=set({},this._dimension),a=SFDom.getSuggestedDimension(e.parentNode);"auto"==t.width&&(t.width=a.width),"auto"==t.height&&(t.height=a.height),this._allocation.setDimension(t),this._allocation.allocate(),this._allocated=!0,this._updateStyles(),this._synchScroll(),this._updateScrollBars()}},_renderContent:function(e){var t=[];t.push(this._innerScroll?"innerScroll":"outerScroll"),x&&t.push("touchDevice"),S&&this._innerScroll&&t.push("customScroll"),e.push("<div id=\"",this.id,"content\""),t.length&&e.push(" class=\"",t.join(" "),"\""),e.push(" onmousedown=\"",this.fireCode("_onDragStart"),"\" ontouchstart=\"",this.fireCode("_onDragStart"),"\">");for(var a=0;3>a;a++)for(var o=0;3>o;o++)this._renderSection(e,a,o);this._innerScroll&&this._forEachAxis(function(t){e.push("<div id=\"",this.id,t.type,"scrollBG\" class=\"","scrollBG","\"></div>"),S&&(e.push("<div id=\"",this.id,t.type,"customScroll\">"),this._scrollBars[t.type].renderHtml(e),e.push("</div>"))}),e.push("</div>")},_renderSection:function(e,t,a){var o=this.id+n(t,a),i=1==t&&1==a,r=["section"],s=i?"center":"",d=0==t?"top":2==t?"bottom":"",l=0==a?"left":2==a?"right":"";r.push(s+d+l+"Section"),e.push("<div id=\"",o,"\" class=\"",r.join(" "),"\""),this._innerScroll?i&&(S&&!x?e.push(" style=\"overflow:hidden\""):(e.push(" onscroll=\"",this.fireCode("_synchScroll"),"\""),SFDom.renderStyle(e,this._getCenterScrollStyle()))):e.push(" onscroll=\"",this.fireCode("_onInnerScroll",t,a),"\""),e.push("><div id=\"",o,"ext\"></div></div>")},setCellWrapperClass:function(e,t,a){var o=juic.$(this.id+r(e,t)+"content");if(o){var n=[g];a&&n.push(a),o.firstChild.className=n.join(" ")}},_updateCell:function(e,t,a){var o=this._allocation.getCellDimension(t,a),n=null;e.hasChildNodes()&&(n=e.firstChild.lastChild,n.parentNode.removeChild(n)),e.id=this.id+r(t,a);var i=this._metaData.getColumnMetaData(a,"css");e.className=c+" "+c+"-"+a+(i?" "+i:"");var s=juic.createRenderContext(),d=this._getCellStyle(t,a);SFDom.updateStyle(e,d);var l=this._getCellContentStyle(t,a,o),_=this._getCellDescriptor(t,a),u=r(t,a),p=!1,m=this._metaData.getColumnMetaData(a,"headerLabelId");_.display&&"function"==typeof _.display.isFocusable&&(p=_.display.isFocusable()),_.display&&"function"==typeof _.display.setHeaderLabelId&&_.display.setHeaderLabelId(m),s.push("<div role=\"gridcell\" id=\"",this.id,u,"content\" class=\"","cellContent","\""),SFDom.renderStyle(s,l),p||(m&&s.push(" aria-labelledby=\"",m,"\""),s.push(" tabindex=\"0\""),s.push(" onfocus=\"",this.fireCode("_onCellFocus",t,a),"\""),s.push(" onblur=\"",this.fireCode("_onCellBlur",t,a),"\""),s.push(" onkeydown=\"",this.fireCode("_onArrowKeydown",t,a),"\"")),s.push(">");var h=[g];if(_.display&&"function"==typeof _.display.getCellWrapperClass){var x=_.display.getCellWrapperClass();x&&h.push(x)}if(n)n.className=h.join(" ");else{switch(s.push("<div class=\"",h.join(" "),"\">"),_.status){case D:this._renderCellError(s,t,a,_.message,_.error);break;case w:this._renderCellLoading(s,t,a);break;case A:this._renderCellDisplay(s,t,a,_.display);}s.push("</div>")}s.push("</div>"),this._renderCellAdjusters(s,t,a,o),e.innerHTML=s.join(""),n&&e.firstChild.appendChild(n),this._focusIndex&&this._focusIndex.rowIndex==t&&this._focusIndex.columnIndex==a&&(this._focusIndex=null,this.setFocus(t,a))},_renderCellDisplay:function(e,t,a,o){e.push(o)},_renderCellLoading:function(e,t,a){r(t,a);e.push("<div class=\"","cellLoading","\""),e.push("><span class=\"white\" role=\"status\" aria-busy=\"true\">"),e.push(MSGS.COMMON_loading,"</span></div>")},_renderCellError:function(e,t,a,o){e.push("<div role=\"status\" aria-atomic=\"false\" class=\"","cellError","\">",escapeHTML(o),"</div>")},_renderCellAdjusters:function(e,t,a,o){var n=this._isAdjustable("x",a),i=this._isAdjustable("y",t);(n||i)&&(n&&this._renderCellAdjuster(e,"x",a,t,o),i&&this._renderCellAdjuster(e,"y",t,a,o),n&&i&&this._renderIntersection(e,t,a,o))},_renderCellAdjuster:function(e,t,a,o,n){var i=b[t],r=s(t,a,o),d=this._getAdjusterStyle(t,a,o,n);e.push("<div id=\"",this.id,r,t,"adj\" class=\"",_," ",t,_,"\" onselectstart=\"return false\" unselectable=\"on\""),SFDom.renderStyle(e,d),e.push("></div>")},_renderIntersection:function(e,t,a,o){var n=r(t,a),i=this._getIntersectionStyle(t,a,o);e.push("<div id=\"",this.id,n,"int\" class=\"","intersection","\" onselectstart=\"return false\" unselectable=\"on\""),SFDom.renderStyle(e,i),e.push("></div>")},_clearGrid:function(){var e=juic.$(this.id);if(e){this._forEachCell(function(e,t){this._provider&&this._provider.handleStaleCell(e,t)}),e.innerHTML="";var t=juic.createRenderContext();this._renderContent(t),e.innerHTML=t.join("")}this._allocation.reset(),this._visibleRegions=null,this._centerRegion=null},_refreshRegion:function(e){juic.$(this.id)&&this._forEachVisibleIndexIn("y",e.rowFrom,e.rowTo,function(t){this._forEachVisibleIndexIn("x",e.columnFrom,e.columnTo,function(e){this._refreshCell(t,e,!0)})})},_refreshCell:function(e,t,a){this._spans.isExtender(e,t)||!a&&juic.$(this.id+r(e,t))||(this._createCell(e,t),this._provider.handleVisibleCell(e,t))},_createCell:function(e,t){var a=this._allocation.getSectionIndex("y",e),o=this._allocation.getSectionIndex("x",t),n=d(e,o),i=r(e,t),s=juic.$(this.id+n)||this._createRow(e,t),l=document.createElement("div");return this._insertElementInPosition("x",l,t,e),this._updateCell(l,e,t),l},_removeCell:function(e,t,a,o){var n=r(e,t),i=juic.$(this.id+n);if(i){a=null==a?e:a,o=null==o?t:o,this._provider.handleStaleCell(a,o);var s=i.parentNode;return s.removeChild(i),s.childNodes.length==(this._focusManager?2:0)&&s.parentNode.removeChild(s),!0}return!1},_createRow:function(e,t){var a=document.createElement("div");return this._updateRow(a,e,this._allocation.getSectionIndex("x",t)),this._insertElementInPosition("y",a,e,t),a},_updateRow:function(e,t,a){var o=this._metaData.getRowMetaData(t,"css"),n=d(t,a);e.id=this.id+n,e.className=u+" "+u+"-"+t+(o?" "+o:""),e.setAttribute("role","row"),SFDom.updateStyle(e,this._getRowStyle(t,a));var i=juic.createRenderContext();if(this._focusManager&&i.push("<button class=\"",m," ","leftFocusMarker","\" onfocus=\"",this.fireCode("_onFocusRow",t,a,"left"),"\"></button><button class=\"",m," ","rightFocusMarker","\" onfocus=\"",this.fireCode("_onFocusRow",t,a,"right"),"\"></button>"),e.hasChildNodes()){var r=document.createElement("div");r.innerHTML=i.join("");for(var s=0,l=e.childNodes.length;s<l;s++)if(this._focusManager&&(0==s||s==l-1))e.replaceChild(r.childNodes[0],e.childNodes[s]);else{var _=e.childNodes[s],c=this._getContainingCell(_);this._updateCell(_,t,c.x)}}else e.innerHTML=i.join("")},_getManipulation:function(e,t,a){function o(t){return"x"==e?juic.$(this.id+r(a,t)):juic.$(this.id+d(t,s))}var i=this._allocation.getSectionIndex(e,t),s=this._allocation.getSectionIndex("x"==e?"y":"x",a);return{getContainerEl:function(){return"x"==e?juic.$(this.id+d(a,i)):juic.$(this.id+n(i,s)).firstChild},isIndexAvailable:o,getElementAt:o,isSameSection:function(t){return 0<=t&&this._allocation.getSectionIndex(e,t)==i},ignoreFirstLast:this._focusManager&&"x"==e}},_moveElements:function(e,t,a,o,n){if(t!=a){for(var i=this._getManipulation(e,t,n),r=i.getContainerEl.call(this),s=a<t?a:a+o;null!==s;)if(!i.isSameSection.call(this,s))s=null;else if(!i.isIndexAvailable.call(this,s))s++;else break;var d=null===s?i.ignoreFirstLast?r.lastChild:null:i.getElementAt.call(this,s);if(d)for(var l,_=t;_<t+o;_++)l=i.getElementAt.call(this,_),l&&r.insertBefore(l,d);else for(var l,_=t;_<t+o;_++)l=i.getElementAt.call(this,_),l&&r.appendChild(l)}},_insertElementInPosition:function(e,t,a,o){var n=this._getManipulation(e,a,o),i=n.getContainerEl.call(this),r=null,s=!0,d=n.getElementAt.call(this,a);if(d)return void i.replaceChild(t,d);if(i.hasChildNodes()){function e(e){n.isSameSection.call(this,e)?n.isIndexAvailable.call(this,e)&&(s=!0,r=e):(s=!1,r=e)}for(var l=1;null===r;)e.call(this,a-l),null===r&&e.call(this,a+l),l++}var _=!1;if(null!==r){var c=r<a;if(!s)c&&(_=i.firstChild,n.ignoreFirstLast&&(_=_.nextSibling));else{var u=n.getElementAt.call(this,r);_=c?u.nextSibling:u}}_?i.insertBefore(t,_):n.ignoreFirstLast?i.insertBefore(t,i.lastChild):i.appendChild(t)},_cssMetaData:function(e,t){var a="y"==e?u:c,o=this._metaData.getMetaData(e,t,"css"),n=a+" "+a+"-"+t+(o?" "+o:"");this._forEachElementOnLine(e,t,function(e){e.className=n})},_updateStyles:function(){this._updateContentStyle(),this._updateScrollStyle(),this._forEachSection(this._updateSectionStyle),this._forEachCell(this._updateCellStyle),this._forEachRow(this._updateRowStyle)},_updateContentStyle:function(){var e=juic.$(this.id+"content");this._forEachAxis(function(t){var a=this._allocation.getValue(t.type,"outerDimension");e.style[t.dimension]="x"==t.type&&this._dimension&&"auto"==this._dimension.width?"auto":a+"px"})},_updateSectionStyle:function(e,t){var a=n(e,t),o=juic.$(this.id+a);if(!this._allocation.isSectionEmpty(e,t)){var i=juic.$(this.id+a+"ext");this._forEachAxis(function(a,n){var r="x"==a.type?t:e,s="x"==a.type?e:t,d=0;this._innerScroll&&1==r&&(1!=s||S)&&this._allocation.isScrollRequired(n.type)&&(d=a.scrollBarSize);var l=1==r?this._allocation.getValue(a.type,"centerSize"):this._allocation.getValue(a.type,"sectionTotals",r),_=this._allocation.getValue(a.type,"sectionTotals",r)+d;if(i.style[a.dimension]=_+"px",this._innerScroll){var c=this._allocation.getValue(a.type,"sectionOffsets",r);o.style[a.dimension]=l+"px",o.style[a.start]=c+"px"}}),o.style.display=""}else o.style.display="none"},_updateCellStyle:function(e,t){var a=this._allocation.getCellDimension(e,t),o=this._allocation.isSizeChanged(e,t),n=this._allocation.isPositionChanged(e,t);if(o||n){var i=r(e,t),s=this._getCellStyle(e,t);s&&SFDom.updateStyle(this.id+i,s);var d=this._getCellContentStyle(e,t,a);d&&SFDom.updateStyle(this.id+i+"content",d),this._updateAdjusterStyle(e,t,a),o&&this._notifySizeChange(e,t)}},_updateRowStyle:function(e,t){var a=juic.$(this.id+d(e,t));a&&SFDom.updateStyle(a,this._getRowStyle(e,t))},_updateAdjusterStyle:function(e,t,a){var o=!0,n=r(e,t);if(this._forEachAxis(function(i){var r="x"==i.type?t:e,s="x"==i.type?e:t,d=this._isAdjustable(i.type,r);if(d){var l=this.id+n+i.type+"adj",_=this._getAdjusterStyle(i.type,r,s,a);SFDom.updateStyle(l,_)}o=o&&d}),o){var i=this._getIntersectionStyle(e,t,a);SFDom.updateStyle(this.id+n+"int",i)}},_updateScrollStyle:function(){this._innerScroll&&this._forEachAxis(function(e,t){var a=this._allocation.isScrollRequired(e.type),o=this._allocation.isScrollRequired(t.type),n=juic.$(this.id+e.type+"scrollBG");if(a){var i=this._allocation.getValue(t.type,"sectionOffsets",2)-t.scrollBarSize;n.style[t.start]=i+"px",n.style[t.dimension]=t.scrollBarSize+"px",n.style[e.start]="0px",n.style[e.dimension]=this._allocation.getValue(e.type,"outerDimension")+"px",n.style.display=""}else n.style.display="none";if(S){var n=juic.$(this.id+e.type+"customScroll");if(n){var r=o?t.scrollBarSize:0,i=this._allocation.getValue(t.type,"sectionOffsets",2)-t.scrollBarSize,s=this._allocation.getValue(e.type,"centerSize")-r;n.style.position="absolute",n.style[e.start]=this._allocation.getValue(e.type,"sectionOffsets",1)+"px",n.style[e.dimension]=s+"px",n.style[t.start]=i+"px"}}})},_getRowStyle:function(e,t){if(this._allocated)return this._forAxis("y",function(a,o){var n={"margin-top":"",width:this._allocation.getValue(o.type,"sectionTotals",t)+"px",top:this._allocation.getValue(a.type,"cellSectionOffsets",e)+"px"};return n[o.start]=0,n})},_getCellStyle:function(e,t){if(this._allocated){var a={top:0},o=b.x.start;return a["margin-"+o]="",a[o]=this._allocation.getValue("x","cellSectionOffsets",t)+"px",a}},_getCellContentStyle:function(e,t,a){if(this._allocated){var o=set({},a);for(var n in o)o[n]+="px";return o}},_getAdjusterStyle:function(e,t,a,o){if(this._allocated){var n={};return this._forAxis(e,function(e,t){n[e.start]=o[e.dimension]+"px",n[t.start]=0,n[t.dimension]=o[t.dimension]+"px"}),n}},_getIntersectionStyle:function(e,t,a){if(this._allocated){var o={top:a.height+"px"};return o[b.x.start]=a.width+"px",o}},_notifySizeChange:function(){},_onSpanChanged:function(e){juic.$(this.id)&&this._centerRegion&&this._updateCellStyle(e.rowIndex,e.columnIndex)},_onIntervalAdded:function(a){juic.$(this.id)&&this._centerRegion&&this._forAxis(a.axisType,function(o,n){var i=a.index,r=a.count;this._reindexCells(o.type,i,r);for(var s,d=this._visibleRegions[o.type],l=[],_=0;_<d.length;_++)s=d[_],(s.from<=i&&s.to>=i||s.from<=i+r-1&&s.to>=i+r-1)&&l.push({from:e(s.from,i),to:t(s.to,i+r-1)});for(var c,u=this._visibleRegions[n.type],g=[],_=0;_<u.length;_++){c=u[_];for(var s,p=0;p<l.length;p++)s={},s[o.name+"From"]=l[p].from,s[o.name+"To"]=l[p].to,s[n.name+"From"]=c.from,s[n.name+"To"]=c.to,g.push(s)}this._handleRegions(g,null),this._updateStyles(),this._synchScroll()})},_onIntervalRemoved:function(e){if(juic.$(this.id)&&this._centerRegion){for(var t,a=e.index,o=e.count,n=e.axisType,i="x"==n?"y":"x",r=0;r<o;r++)t=a+r,this._forEachVisibleIndex(i,function(e){var a="x"==n?e:t,o="x"==n?t:e;this._removeCell(a,o)&&this._provider.handleRemovedCell(a,o)});this._reindexCells(e.axisType,a+o,-o),this._updateStyles(),this._synchScroll()}},_reindexCells:function(e,t,a){if(this._centerRegion){var o=this._allocation.getVisibleInfo(),n=this._metaData.size(e),i=this._visibleRegions;this._centerRegion=o.centerRegion,this._visibleRegions=o.visibleRegions,this._forEachVisibleIndexIn(e,t,t+n,function(t){var o=t+a;if(!this._isVisible(e,o)){var n="x"==e?"y":"x";this._forEachVisibleIndex(n,function(o){var n="x"==e?o:t,i="x"==e?t:o,r=n+("x"==e?0:a),s=i+("x"==e?a:0);this._removeCell(n,i,r,s)},i[n])}else if("y"==e)for(var s,l=0;3>l;l++)s=juic.$(this.id+d(t,l)),s&&this._updateRow(s,o,l);else this._forEachVisibleIndex("y",function(e){var a=juic.$(this.id+r(e,t));a&&this._updateCell(a,e,o)},i.y)},i[e],0<a),this._handleRegions(o.newRegions,o.staleRegions)}},_onMetaDataUpdated:function(e){var t=e.key,a=this["_"+t+"MetaData"];"function"==typeof a&&a.call(this,e.axisType,e.index,e.value,e.oldValue)},_onIntervalMoved:function(a){if(juic.$(this.id)&&this._centerRegion&&a.fromIndex!=a.toIndex){var o=a.axisType,n=a.fromIndex,i=a.toIndex,r=a.count;if(this._focusIndex){var s=this._focusIndex[o],d=t(n,i),l=e(n+r,i+r);s>=d&&s<l&&(s>=n&&s<n+r?s=i+r-1:s+=(n>i?1:-1)*r,this._focusIndex[o]=s)}var _="x"==o?"_moveColumns":"_moveRows";this[_](n,i,r),this.dispatchEvent(a)}},_moveColumns:function(a,o,n){this._forAxis("x",function(i){function r(e){return e>=s&&e<=d?e>=a&&e<a+n?e+o-a:e+n*(o<a?1:-1):e}var s=t(a,o),d=e(a,o)+n-1;this._forEachVisibleIndex("y",function(e){var t=this._getManipulation(i.type,a,e);this._moveElements(i.type,a,o,n,e);for(var l=[],_=s;_<=d;_++)l[_]=t.getElementAt.call(this,_);for(var c,_=s;_<=d;_++)if(c=l[_],c){var u=r(_),g="x"==i.type?e:u,p="x"==i.type?u:e;this._updateCell(c,g,p)}}),this._forEachPosition(function(e){var t=e[i.name+"index"];e[i.name+"index"]=r(t)})})},_moveRows:function(a,o,n){this._forAxis("y",function(i,r){for(var s,d=this._metaData.size(r.type),l=0;3>l;l++)if(s=this._allocation.getSectionAxisRegion("x",l),s){var _=s.from,c=this._getManipulation(i.type,a,_);this._moveElements(i.type,a,o,n,_);for(var u=t(a,o),g=e(a,o)+n-1,p=[],m=u;m<=g;m++)p[m]=c.getElementAt.call(this,m);for(var m=u;m<=g;m++){var h=p[m],x=m>=a&&m<a+n?m-a+o:m+n*(o<a?1:-1);this._updateRow(h,x,l)}}})},_onGridAvailable:function(e){var t=e.region;this._grid=[];for(var a=t.rowFrom;a<=t.rowTo;a++)for(var o,n=t.columnFrom;n<=t.columnTo;n++)o=e.grid[a-t.rowFrom][n-t.columnFrom],this._setCellDescriptor(a,n,{status:A,display:o});this._refreshRegion(t),delete this._grid},_onGridError:function(e){var t=e.region;this._grid=[];for(var a=t.rowFrom;a<=t.rowTo;a++){this._grid[a]=this._grid[a]||[];for(var o=t.columnFrom;o<=t.columnTo;o++)this._setCellDescriptor(a,o,{status:D,message:e.message,message:e.error})}this._refreshRegion(t),delete this._grid},_onGridLoading:function(e){this._refreshRegion(e.region)},_setCellDescriptor:function(e,t,a){this._grid=this._grid||[],this._grid[e]=this._grid[e]||[],this._grid[e][t]=a},_getCellDescriptor:function(e,t){var a=this._grid&&this._grid[e]&&this._grid[e][t];return a||{status:w}},_onRefreshRegion:function(e){this._onGridAvailable(e)},_onCellFocus:function(e,t){this._focusIndex={rowIndex:e,columnIndex:t},this.setFocus(e,t)},_onCellBlur:function(e,t){var a=this;setTimeout(function(){var o=a._focusIndex;o&&o.rowIndex==e&&o.columnIndex==t&&(a._focusIndex=null)},0)},_onArrowKeydown:function(e,t,a){var o=SFDOMEvent.getKeyName(a||window.event),n=!1,i=e,r=t;"ARROWUP"===o?(i=e-1,n=!0):"ARROWDOWN"===o?(i=e+1,n=!0):"ARROWLEFT"===o?(r=t-1,n=!0):"ARROWRIGHT"===o?(r=t+1,n=!0):void 0;n&&0<=i&&i<this._metaData.getRowSize()&&0<=r&&r<this._metaData.getColumnSize()&&this.setFocus(i,r)},_onFocusRow:function(e,t,a,o){if(this._focusManager){var n=this._getVisibleRange("x",t),i=this._allocation.getSectionAxisRegion("x",t),r="left"==a,s=r?n.from:n.to,d=r?i.from:i.to,l=this._focusManager.getNextFocusableColumn(e,s,r),_=e;if(null==l&&(_=this._focusManager.getNextFocusableRow(e,r),null!=_&&(l=this._focusManager.getNextFocusableColumn(_,null,r))),null==_||null==l){var c=SFDOMEvent.getTarget(o||window.event);c.blur()}else if(s!=d){var c=SFDOMEvent.getTarget(o||window.event);c.blur(),SFDOMEvent.stopEvent(o||window.event);var u=this;setTimeout(function(){u.setFocus(_,l,a)},0)}else this.setFocus(_,l)}},_onDragStart:function(e){"touchstart"==e.type&&1<e.touches.length||(this._onAdjusterDragStart(e),this._onReorderDragStart(e))},_onReorderDragStart:function(e){var t=SFDOMEvent.getTarget(e||window.event);this._forEachAxis(function(a,o){if(SFDom.hasClass(t,a.name+"Handle")){var n=this._getContainingCell(t),i=this._spans.getSpanOnAxis(a.type,n[a.type],n[o.type]);this._reorder={iIndex:n[a.type],jIndex:n[o.type],count:i,iAxisType:a.type},this._dragType="reorder",SFDragDropMgr.handleDragStart(e,this,{useShim:!0,shimCursor:a.cursor})}})},_handleReorderDragEvent:function(e){var t=this._reorder.iAxisType,a=e.point[t]-(e.origin||e.point)[t];if("x"==t&&Util.isRTL()&&(a=-a),this.isDraggable())switch(e.type){case"dragStart":this._handleReorderDragStart();break;case"drag":this._handleReorderDrag(a);break;case"dragEnd":this._handleReorderDrop(a);}},_handleReorderDragStart:function(){for(var e=this._reorder.iAxisType,t=this._reorder.iIndex,a=this._reorder.count,o=0;o<a;o++)this._forEachElementOnLine(e,t+o,function(e,t){SFDom.addClass(e,t.name+h)})},_handleReorderDrag:function(a){var o=this._reorder.iAxisType;this._forAxis(o,function(n){for(var i=this._reorder.iIndex,r=this._reorder.jIndex,s=this._reorder.count,d=0;d<s;d++)this._forEachElementOnLine(o,i+d,function(e,t){SFDom.setStyle(e,"margin-"+t.start,a+"px")});for(var l=null==this._lastDropIndex?i:this._lastDropIndex,_=this._findDropIndex(a),c=t(l,_),u=e(l+s-1,_+s-1),g=this._isAdjustable(o,i),p=this._allocation.getCellAxisOffset(o,i,r),d=c;d<=u;d++)if(d<i||d>i+s-1){var m=p;d<i&&d<_?m=0:d>i+s-1&&(d>_+s-1?m=0:m*=-1),this._forEachElementOnLine(o,d,function(e){SFDom.setStyle(e,"margin-"+n.start,m?m+"px":"")})}this._lastDropIndex=_})},_handleReorderDrop:function(e){var t=this._reorder.iAxisType,a=this._reorder.iIndex,o=this._reorder.jIndex,n=this._reorder.count,i=this._findDropIndex(e);this._forAxis(t,function(r){var s,d=0,l=0;if(i>a){var _=i+n;_==this._metaData.size(t)?(s=this._allocation.getValue(t,"cellSectionOffsets",_-1),s+=this._allocation.getValue(t,"sizes",_-1)):s=this._allocation.getValue(t,"cellSectionOffsets",_),s-=this._allocation.getCellAxisOffset(t,a,o)}else s=this._allocation.getValue(t,"cellSectionOffsets",i);for(var c=[],u=0;u<n;u++)c[u]=this._allocation.getValue(t,"cellSectionOffsets",a);i!=a&&this._metaData.move(t,a,i,n);var g={};g["margin-"+r.start]=0,this._animating=!0;for(var u=0;u<n;u++)this._forEachElementOnLine(t,i+u,function(t){var a=e-s+c[u];SFDom.setStyle(t,"margin-"+r.start,a+"px"),SFDom.addClass(t,r.name+h),d++,SFAnimUtil.animate(t,g,{complete:function(){SFDom.removeClass(t,r.name+h),SFDom.setStyle(t,"margin-"+r.start,""),++l==d&&(this._animating=!1)},context:this})})})},_findDropIndex:function(e){var t=this._reorder.iAxisType;return this._forAxis(t,function(a){for(var o=Math.abs,n=this._reorder.iIndex,i=this._reorder.count,r=0>e?-1:1,s=this._allocation.getSectionIndex(t,n),d=this._allocation.getSectionAxisRegion(t,s),l=0<r?d.to:d.from,_=0,c=o(e),u=0,g=n;g!=l+r;g+=r){if(this._spans.isValidMove(t,n,g,i)){var p=o(_-o(e));if(c<p)break;u=g,c=p}_+=this._allocation.getValue(a.type,"sizes",g)}return u})},_getContainingCell:function(e){var t=null;for(this._cellRegex=this._cellRegex||new RegExp("^"+this.id+"cell(\\d+)-(\\d+)$");e&&e.id!=this.id&&!(t=this._cellRegex.exec(e.id));)e=e.parentNode;return t?{x:parseInt(t[1]),y:parseInt(t[2])}:null},handleDragEvent:function(e){switch(this._dragType){case"adjuster":this._handleAdjusterDragEvent(e);break;case"touchScroll":this._handleTouchScrollEvent(e);break;case"reorder":this._handleReorderDragEvent(e);}switch(e.type){case"dragStart":this._dragging=!0;break;case"dragEnd":this._dragType=null;var t=this;setTimeout(function(){t._dragging=!1},50);}},_onAdjusterDragStart:function(e){var t=SFDOMEvent.getTarget(e||window.event);this._adjusterRegex=this._adjusterRegex||new RegExp("^"+this.id+"cell(\\d+)-(\\d+)(xadj|yadj|int)$");var a=this._adjusterRegex.exec(t.id);if(a){var o=null,n=parseInt(a[1]),i=parseInt(a[2]),r=this._spans.get(i,n);r&&(i+=r.rowSpan-1,n+=r.columnSpan-1);var s=a[3];switch(s){case"xadj":case"yadj":var d="xadj"==s?"x":"y",l="x"==d?n:i;this._adjusterInfo={},this._adjusterInfo[d]={index:l,originalSize:this._allocation.getValue(d,"sizes",l)},o=b[d].cursor;break;case"int":this._adjusterInfo={x:{index:n,originalSize:this._allocation.getValue("x","sizes",n)},y:{index:i,originalSize:this._allocation.getValue("y","sizes",i)}},o="move";}this._dragType="adjuster",SFDragDropMgr.handleDragStart(e,this,{useShim:!0,clickTimeThreshold:0,shimCursor:o})}},_handleAdjusterDragEvent:function(e){switch(e.type){case"dragStart":this._adjusting=!0,this._adjusterOrigin=e.origin,this._handleAdjusterDrag(e);break;case"drag":this._handleAdjusterDrag(e);break;case"dragEnd":this._handleAdjusterDrag(e,!0),this.dispatch("sizeAdjusted",{adjusterInfo:this._adjusterInfo}),this._adjusting=!1,this._adjusterOrigin=null,this._adjusterInfo=null;}},_handleAdjusterDrag:function(e,t){t=null==t?this._dragByResizing:t;var a=SFDom.getXY(this.id);this._forEachAxis(function(o){var n="x"==o.type?a[0]:a[1],i=this._adjusterInfo[o.type];if(null!=i){var r=this._getAdjustedSize(o.type,e.point[o.type]);t?(this._hideHoveringLine(o),this._allocation.setSingleDimension(o.type,i.index,r)):this._showHoveringLine(o.type,e.point[o.type],n)}}),t&&this._handleUpdates()},_getAdjustedSize:function(e,t){var a=this._adjusterInfo[e];if(null!=a){var o=t-this._adjusterOrigin[e];"x"==e&&Util.isRTL()&&(o=-o);var n=a.originalSize+o,i=this._allocation.getSpacingBounds(e,a.index);return l(n,i.minSize,i.maxSize)}},_showHoveringLine:function(e,t,a){this._forAxis(e,function(e,o){var n=juic.$(this.id+e.type+"adjuster"),i=!n;if(i?(n=document.createElement("div"),n.id=this.id+e.type+"adjuster",n.className=p+" "+e.type+p,n.style[o.start]=0):n.style.display="block",n.style[o.dimension]=this._allocation.getValue(o.type,"outerDimension")+"px",n.style[e.start]=t-a+"px",i){var r=juic.$(this.id).firstChild;r.appendChild(n)}})},_hideHoveringLine:function(e){var t=juic.$(this.id+e.type+"adjuster");t&&(t.style.display="none")},_handleTouchScrollEvent:function(e){var t=this.getAutoScroller(),a=t.getScrollInfo();switch(e.type){case"dragStart":this._startPosition=a;break;case"drag":var o={};this._forEachAxis(function(t){var a=e.point[t.type]-e.origin[t.type];o[t.type]=this._startPosition[t.type].position-a}),t.setScrollPosition(o.x,o.y);break;case"dragEnd":this._touchDrag=!1;}},_onMouseWheel:function(e){var t=0;e=e||window.event,e.wheelDelta?(t=e.wheelDelta/120,window.opera&&(t=-t)):e.detail&&(t=-e.detail/3);for(var a=e.axis==e.VERTICAL_AXIS?"y":"x",o=b[a],n=(0>t?1:0<t?-1:0)*50,i=juic.$(this.id),r=SFDOMEvent.getTarget(e);r!=i;){var s=SFDom.getStyle(r,"overflow-"+a)||SFDom.getStyle(r,"overflow");if("auto"==s&&canScrollMove(r,a,n))return;r=r.parentNode}if(t&&this._allocation.isScrollRequired(a)){var d=[n];"x"==a?d.push(0):d.splice(0,0,0);var l=this.getAutoScroller();l.scrollMove.apply(l,d)&&SFDOMEvent.stopEvent(e)}},_updateScrollBars:function(){S&&this._innerScroll&&this._forEachAxis(function(e){this._scrollBars[e.type].adjustDOM()})},_populateVisibleGrid:function(){var e=this._allocation.getVisibleInfo();e&&(this._centerRegion=e.centerRegion,this._visibleRegions=e.visibleRegions,this._handleRegions(e.newRegions,e.staleRegions))},_handleRegions:function(e,t){if(e)for(var a,o=0;o<e.length;o++)a=e[o],this._provider.getCells(a.columnFrom,a.columnTo,a.rowFrom,a.rowTo);if(t)for(var a,o=0;o<t.length;o++){a=t[o];for(var n=a.rowFrom;n<=a.rowTo;n++)for(var i=a.columnFrom;i<=a.columnTo;i++)this._removeCell(n,i)}},_getScrollInfo:function(){return this.getAutoScroller().getScrollInfo()},_isAdjustable:function(e,t){return this._metaData.getMetaData(e,t,"adjustable")},_forAxis:function(e,t){var a="x"==e||"y"==e;if(assert(a,"SFGridMetaData: Invalid axisType "+e),a){var o=b[e],n=b[o.opposite];return t.call(this,o,n)}},_forEachCell:function(e){this._forEachVisibleIndex("x",function(t){this._forEachVisibleIndex("y",function(a){this._spans.isExtender(a,t)||e.call(this,a,t)})})},_forEachPosition:function(e){this._forEachCell(function(t,a){e.call(this,{rowIndex:t,columnIndex:a})})},_forEachVisibleIndex:function(e,t,a){var a=a||this._visibleRegions&&this._visibleRegions[e];if(a)for(var o,n=0;n<a.length;n++){o=a[n];for(var i=o.from;i<=o.to;i++)t.call(this,i)}},_forEachVisibleIndexIn:function(a,o,n,i,r,s){var r=r||this._visibleRegions&&this._visibleRegions[a];if(r)if(s)for(var d=r.length-1;0<=d;d--){var l=r[d],_=e(l.from,o),c=t(l.to,n);if(_<=c)for(var u=c;u>=_;u--)i.call(this,u)}else for(var d=0;d<r.length;d++){var l=r[d],_=e(l.from,o),c=t(l.to,n);if(_<=c)for(var u=_;u<=c;u++)i.call(this,u)}},_forEachRow:function(e){for(var t=0;3>t;t++)this._allocation.isSectionEmpty("y",t)||this._forEachVisibleIndex("y",function(a){e.call(this,a,t)})},_forEachAxis:function(e){for(var t in b)this._forAxis(t,e)},_forEachSection:function(e){for(var t=0;3>t;t++)for(var a=0;3>a;a++)e.call(this,t,a)},_forEachElementOnLine:function(e,t,a){var o=b[e];if("y"==e){for(var n=0;3>n;n++)if(!this._allocation.isSectionEmpty("x",n)){var i=juic.$(this.id+d(t,n));i&&a.call(this,i,o)}}else this._forEachVisibleIndex("y",function(e){var n=juic.$(this.id+r(e,t));n&&a.call(this,n,o)})},_isVisible:function(e,t){if(1==this._allocation.getSectionIndex(e,t)){var a=this._centerRegion;return this._forAxis(e,function(e){var o=a[e.name+"From"],n=a[e.name+"To"];return o<=t&&n>=t})}return!0},_getVisibleRange:function(e,t){if(1==t){var a=this._centerRegion;return this._forAxis(e,function(e){return{from:a[e.name+"From"],to:a[e.name+"To"]}})}return this._allocation.getSectionAxisRegion(e,t)},setDraggable:function(e){this._isDraggable=e},isDraggable:function(){return this._isDraggable}});var I=document.createElement("div"),w="unavailable",D="error",A="available",E=Util.browserInfo.ff?"DOMMouseScroll":"mousewheel",b={x:{type:"x",opposite:"y",cursor:"col-resize",name:"column",dimension:"width",start:Util.isRTL()?"right":"left",end:Util.isRTL()?"left":"right",nstart:"left",nend:"right",scrollPosition:"scrollLeft",scrollBarSize:17,getPageDimension:"getDocumentWidth",offsetDimension:"offsetWidth"},y:{type:"y",opposite:"x",cursor:"row-resize",name:"row",dimension:"height",start:"top",end:"bottom",nstart:"top",nend:"bottom",scrollPosition:"scrollTop",scrollBarSize:17,getPageDimension:"getDocumentWidth",offsetDimension:"offsetHeight"}}})();function SFAbstractGridRow(){assert(!1,"SFAbstractGridRow: Do not directly construct")}juic.extend(SFAbstractGridRow,juic.EventTarget,{cleanup:function(){},getColumnContent:function(){assert(!1,"SFAbstractGridRow: Must implement getColumnContent")},getChanges:function(){},setChanges:function(){},getRowId:function(){},handleVisibleColumn:function(){},handleStaleColumn:function(){}});function SFCachedItemProvider(e,t){this._init(e,t)}(function(){var e=Math.floor,t=Math.max;function a(e){e=e||{};var t={};for(var a in n)t[a]="undefined"==typeof e[a]?n[a]:e[a];return t}function o(t,a,o){if(t&&null!=t.startIndex&&(o=a,a=t.endIndex,t=t.startIndex),0<=a&&t<=a){for(var n=[],i=e(t/o);i*o<=a;)n.push(i),i++;return n}return juic.assert(!1,"SFCachedItemProvider: Invalid pagination"),null}var n={pageSize:10,queueSize:100};juic.extend(SFCachedItemProvider,SFAbstractItemProvider,{_init:function(e,t){t=a(t),this.setItemProvider(e),this._pageSize=t.pageSize,this._queueSize=t.queueSize,this._cacheId=0},cleanup:function(){this.clear(),this._itemProvider&&(this._itemProvider.removeEventListener("itemsAvailable",this),this._itemProvider.removeEventListener("itemsError",this))},getItems:function(e){if(this.refresh(e.startIndex,e.endIndex),!this._handleRequest(e)){this._requests.push(e);for(var t=o(e,this._pageSize),a=0;a<t.length;a++){var n=t[a],i=this._cachedPages[n];if(!i){this._cachedPages[n]={status:"unavailable"};var r=set({},e);r.cacheId=this._cacheId,r.startIndex=n*this._pageSize,r.endIndex=r.startIndex+this._pageSize-1,r.pageSize=this._pageSize,r.pageIndex=n,r.pageNumber=n+1,this._itemProvider.getItems(r)}}}},setItemProvider:function(e){this._itemProvider&&(this._itemProvider.removeEventListener("itemsAvailable",this),this._itemProvider.removeEventListener("itemsError",this)),this._itemProvider=e,this._itemProvider&&(this._itemProvider.addEventListener("itemsAvailable",this,"_onItemsAvailable"),this._itemProvider.addEventListener("itemsError",this,"_onItemsError")),this.clear()},clear:function(){if(this._cacheQueue)for(;!this._cacheQueue.empty();){var e=this._cacheQueue.dequeue(),t=this._cachedPages[e];this._handleStalePage(e,t)}this._cacheId++,this._cachedPages=[],this._cacheQueue=new Queue,this._requests=[],this._itemCount=null},refresh:function(e,t){for(var a=o(e,t,this._pageSize),n=0;n<a.length;n++){var i=a[n],r=this._cachedPages[i];r&&"unavailable"!=r.status&&this._cacheQueue.requeue(i)}},getCachedItem:function(e){var t=o(e,e,this._pageSize)[0],a=this._cachedPages[t],n=e%this._pageSize;return a&&"available"==a.status&&a.items&&a.items.length<n?a.items[n]:null},forEachCachedItem:function(e,t){for(var a in this._cachedPages){var o=this._cachedPages[a];if("available"==o.status)for(var n=o.items,i=0;n&&i<n.length;i++){var r=o.startIndex+i,s=n[i];e.call(t,s,r)}}},getPagedItems:function(e,t,a){return a.length>this._pageSize?a.slice(e,t+1):a},_onItemsAvailable:function(e){if(juic.assert(e.pagination,"SFCachedItemProvider: itemsAvailable event missing pagination object."),e.pagination&&e.pagination.cacheId==this._cacheId){var t=o(e.pagination,this._pageSize)[0],a=e.pagination.startIndex,n=e.pagination.endIndex,i=e.items||[];this._cachedPages[t]={status:"available",items:this.getPagedItems(a,n,i),startIndex:a,endIndex:n,itemCount:e.itemCount},this._updateQueue(t),this._itemCount=this._itemCount||e.itemCount,this._checkRequests()}},_onItemsError:function(e){if(juic.assert(e.pagination,"SFCachedItemProvider: itemsError event missing pagination object."),e.pagination&&e.pagination.cacheId==this._cacheId){var t=o(e.pagination,this._pageSize)[0];this._cachedPages[t]={status:"error",startIndex:e.pagination.startIndex,endIndex:e.pagination.endIndex,message:e.message,error:e.error},this._updateQueue(t),this._checkRequests()}},_updateQueue:function(e){for(this._cacheQueue.enqueue(e);this._cacheQueue.size()>this._queueSize;){var t=this._cacheQueue.dequeue(),a=this._cachedPages[t];a&&this._handleStalePage(t,a),delete this._cachedPages[t]}},_handleStalePage:function(e,t){switch(t.status){case"available":this.dispatch("stalePage",{index:e,startIndex:t.startIndex,endIndex:t.endIndex,items:t.items});break;case"error":this.dispatch("staleError",{index:e,index:e,startIndex:t.startIndex,endIndex:t.endIndex,message:t.message,error:t.error});}},_checkRequests:function(){for(var e=0;e<this._requests.length;){var t=this._requests[e];this._handleRequest(t,!0)||e++}},_handleRequest:function(e,a){for(var n,i=o(e,this._pageSize),r="available",s=null,d=0;d<i.length;d++)if(n=this._cachedPages[i[d]],!n||"unavailable"==n.status){r=!1;break}else if("error"==n.status){r=n.status,s=n;break}if(r)if(a&&this._requests.shift(),"error"==r)this.dispatch("itemsError",{message:s.message,error:s.error,pagination:e});else{for(var l,_=[],c=0,d=0;d<i.length;d++){var n=this._cachedPages[i[d]],u=n.items;_=_.concat(u),isNaN(n.itemCount)||(c=t(c,n.itemCount)),l=u.length}var g=e.startIndex,p=e.endIndex,m=p%this._pageSize,h=l-m-1;0<g&&_.splice(0,g%this._pageSize),0<h&&_.splice(_.length-h,h),this.dispatch("itemsAvailable",{items:_,itemCount:c,pagination:e})}return!!r}})})();function SFGridRowProvider(e,t,a){this._init(e,t,a)}juic.extend(SFGridRowProvider,SFAbstractGridProvider,{_init:function(e,t,a){this._metaData=t,this._cachedProvider=new SFCachedItemProvider(e,a),this._cachedProvider.addEventListener("stalePage",this,"_onStalePage"),this._cachedProvider.addEventListener("itemsAvailable",this,"_onItemsAvailable"),this._cachedProvider.addEventListener("itemsError",this,"_onItemsError")},reset:function(){delete this._changes,this._cachedProvider.clear()},cleanup:function(){this._cachedProvider.cleanup(),this._cachedProvider.removeEventListener("stalePage",this),this._cachedProvider.removeEventListener("itemsAvailable",this),this._cachedProvider.removeEventListener("itemsError",this),delete this._cachedProvider},getRowCount:function(){this._cachedProvider.getItems({rowCount:!0,startIndex:0,endIndex:0})},getCells:function(e,t,a,o){this._loaded=!1,this._cachedProvider.getItems({startIndex:a,endIndex:o,columnFrom:e,columnTo:t}),this._loaded||this.dispatch("gridLoading",{region:{columnFrom:e,columnTo:t,rowFrom:a,rowTo:o}})},getCellContent:function(e,t,a){return t instanceof SFAbstractGridRow?t.getColumnContent(e,a):t instanceof Array?t[a.index]:null},handleVisibleCell:function(e,t){var a=this.getCachedRow(e);a instanceof SFAbstractGridRow&&a.handleVisibleColumn(this._metaData.getColumnMetaData(t))},handleStaleCell:function(e,t){var a=this.getCachedRow(e);a instanceof SFAbstractGridRow&&a.handleStaleColumn(this._metaData.getColumnMetaData(t))},cleanupRow:function(e,t){if(t instanceof SFAbstractGridRow){var a=t.getChanges();if(a){var o=t.getRowId();null==o&&(o=e),this._changes=this._changes||{},this._changes[o]=a}t.cleanup()}else if(t instanceof Array)for(var n,i=0;i<t.length;i++)n=t[i],n instanceof Component&&n.cleanup(),delete t[i]},setChanges:function(e){this._changes=e,this._cachedProvider.forEachCachedItem(function(e,t){if(e instanceof SFAbstractGridRow){var a=e.getRowId();null==a&&(a=t);var o=this._changes&&this._changes[a];e.setChanges(o)}},this)},getChanges:function(){return this.forEachCachedItem(function(e,t){if(e instanceof SFAbstractGridRow){var a=e.getChanges();if(null!=a){var o=e.getRowId();null==o&&(o=t),this._changes=this._changes||{},this._changes[o]=a}}},this),this._changes},forEachCachedItem:function(e,t){this._cachedProvider.forEachCachedItem(e,t)},getCachedRow:function(e){return this._cachedProvider.getCachedItem(e)},setItemProvider:function(e){this._cachedProvider.setItemProvider(e)},_onStalePage:function(e){for(var t=e.items,a=e.startIndex,o=0;o<t.length;o++)this.cleanupRow(a+o,t[o])},_onItemsAvailable:function(e){var t=e.pagination;if(t.rowCount)this.dispatch("rowCountAvailable",{rowCount:e.itemCount});else{this._loaded=!0;for(var a=[],o=t.startIndex;o<=t.endIndex;o++){var n=o-t.startIndex,i=e.items[n];if(i instanceof SFAbstractGridRow){var r=i.getRowId();null==r&&(r=o);var s=this._changes&&this._changes[r];s&&(i.setChanges(s),delete this._changes[o])}a[n]=[];for(var d=t.columnFrom;d<=t.columnTo;d++){var l=d-t.columnFrom,_=this._metaData.getColumnMetaData(d);a[n][l]=this.getCellContent(o,i,_)}}this.dispatch("gridAvailable",{grid:a,rowCount:e.itemCount,region:{rowFrom:t.startIndex,rowTo:t.endIndex,columnFrom:t.columnFrom,columnTo:t.columnTo}})}},_onItemsError:function(e){e.pagination.rowCount?this.dispatch("rowCountError",{message:e.message,error:e.error}):this.dispatch("gridError",{region:{message:e.message,error:e.error,rowFrom:e.startIndex,rowTo:e.endIndex,columnFrom:e.columnFrom,columnTo:e.columnTo}})}});function SFRevolutionGrid(e,t,a){this.register(),this._init(e,t,a)}(function(){var e=Math.max,t=Math.min;function a(e,t,a){this._metaData=e,this._rowProvider=new SFGridRowProvider(t,e,{pageSize:a.pageSize,queueSize:a.queueSize}),this._rowProvider.addEventListener("gridAvailable",this,"_handleGridEvent"),this._rowProvider.addEventListener("gridError",this,"_handleGridEvent"),this._rowProvider.addEventListener("gridLoading",this,"_handleGridEvent"),this._rowProvider.addEventListener("rowCountAvailable",this,"_onRowCountAvailable"),this._rowProvider.addEventListener("rowCountError",this,"dispatchEvent"),this._groupLookup=a.groupLookup,this._hasGroups=a.hasGroups,this._headerSize=a.hasGroups?2:1,this._hasFooter=a.hasFooter,this._footerSize=a.hasFooter?1:0,this._rowCount=0}function o(e){this._group=e,this.register()}function n(e){this._definition=e,this._sortable=e.sortable,this._label=e.label,this._label instanceof Component&&this._label.addEventListener("action",this,"_handleLabelAction"),this.register()}function i(e){this._hasGroups=e.hasGroups,this._headerSize=e.hasGroups?2:1,this._groupHeight=e.groupHeight,this._headerHeight=e.headerHeight,this._totalHeader=e.headerHeight+(this._hasGroups?e.groupHeight:0),this._hasFooter=e.hasFooter,this._footerSize=e.hasFooter?1:0,this._footerHeight=this._hasFooter?e.footerHeight:0,this._rowHeight=e.rowHeight,this._rowCount=1}function r(e,t){this._hasSortable=e.hasSortable,this._hasGroups=e.hasGroups,this._headerSize=e.hasGroups?2:1,this._hasFooter=e.hasFooter,this._footerSize=e.hasFooter?1:0,this._focusManager=e.focusManager,this._metaData=t,this._rowCount=0}function s(){}function d(e,t){e=e||{};var a={};for(var o in I)a[o]="undefined"==typeof e[o]?I[o]:e[o];var n=e.groups;if(n&&n instanceof Array){for(var i={},r=0;r<n.length;r++){a.hasGroups=!0;var s=n[r];s={id:s.id||r,css:s.css||s.id||r,label:s.label||s.title,title:s.title,collapsible:s.collapsible,collapsed:s.collapsed},i[s.id]=s}a.groupLookup=i}else{var i=e.groupLookup;if(i&&"object"==typeof i){var d={};for(var l in i){a.hasGroups=!0;var s=i[l];d[l]={id:l,css:s.css||s.id,label:s.label||s.title}}a.groupLookup=d}else a.groupLookup={}}if(t instanceof Array&&0<t.length){for(var _=!1,c=!1,r=0;r<t.length&&!_;r++)_=!!(t[r]&&t[r].footer),c=!!(t[r]&&t[r].sortable);a.hasFooter=_,a.hasSortable=c}return a}function l(e){var t;switch(typeof e){case"string":t=set({label:e},w);break;case"number":t=set({fixedSize:e},w);break;case"object":for(var a in t={},w){var o=w[a],i=e[a];"label"!=a||i||(i=e.title),("undefined"!=typeof i||null!=o)&&(t[a]="undefined"==typeof i?o:i)}break;default:t=set({},w);}return t.header=new n(t),t.headerLabelId=t.header.getHeaderLabelId(),t}var _="groupRow",c="headerRow",u="footerRow row",g="sortedColumn sort",p="sortUp",m="sortDown",h="groupCollapsed",x=juic.Logger.getLogger("SFRevolutionGrid"),S=SFRevolutionGrid.UP="up",f=SFRevolutionGrid.DOWN="down",y=new RegExp("(?:^|\\s)"+g+"(?= |$)","g"),v=new RegExp("(?:^|\\s)"+p+"(?= |$)","g"),C=new RegExp("(?:^|\\s)"+m+"(?= |$)","g"),I={dragByResizing:!0,innerScroll:!1,dimension:null,rowHeight:31,groupHeight:31,headerHeight:31,footerHeight:31,padding:0,pageSize:10,queueSize:100,focusManager:null,header:null,footer:null,columnAdjustmentType:null,columnBounded:!1,errorMessage:MSGS.COMMON_AJAX_DEFAULT_ERROR,noResultsMessage:MSGS.COMMON_No_Results},w={id:void 0,size:null,minSize:150,maxSize:null,fixedSize:void 0,groupId:void 0,label:void 0,footer:void 0,frozen:!1,adjustable:!1,sortable:!1,css:void 0,weight:void 0};juic.extend(SFRevolutionGrid,juic.Component,{_init:function(e,t,o){if(this._validate.apply(this,arguments)){o=d(o,e),this._ready=!1,this._innerScroll=o.innerScroll,this._hasGroups=o.hasGroups,this._headerSize=this._hasGroups?2:1,this._hasFooter=o.hasFooter,this._footerSize=this._hasFooter?1:0,this._innerScroll=o.innerScroll,this._groupLookup=o.groupLookup,this._options=o,this._rowMeta=new i(o);var n=this._createColumnMetaData(e);this._metaData=new SFGridMetaData(n,this._rowMeta),o.focusManager&&(this._focusManager=new r(o,this._metaData)),this._header=o.header,this._footer=o.footer,this._gridProvider=new a(this._metaData,t,o),this._gridProvider.addEventListener("rowCountAvailable",this,"_onRowCountAvailable"),this._gridProvider.addEventListener("rowCountError",this,"_onError"),this._gridProvider.addEventListener("gridError",this,"_onError"),this._layout=new SFGridLayout({metaData:this._metaData,provider:this._gridProvider,spans:this._spans,padding:o.padding,dragByResizing:o.dragByResizing,innerScroll:o.innerScroll,dimension:o.dimension,focusManager:this._focusManager,columnOptions:{adjustmentType:o.columnAdjustmentType,bounded:o.columnBounded}}),this._layout.addEventListener("ready",this,"_onReady"),this._layout.addEventListener("intervalMoved",this,"_onIntervalMoved"),this._layout.addEventListener("sizeAdjusted",this,"_onSizeAdjusted"),this._gridProvider.setAllocation(this._layout.getAllocation()),this._wrappers=!this._innerScroll&&(this._header||this._footer),this._showLoading()}},renderHtml:function(e){e.push("<div id=\"",this.id,"\" class=\"","sfRevolutionGrid globalTable","\">"),this._header&&e.push("<div id=\"",this.id,"header\" class=\"","gridHeader","\">",this._header,"</div>"),e.push("<div id=\"",this.id,"content\">",this._layout,"</div>"),this._footer&&e.push("<div id=\"",this.id,"footer\" class=\"","gridFooter","\">",this._footer,"</div>"),e.push("</div>"),e.addAfterRenderListener(this,"_onLoad")},attach:function(){this._layout.attach(),this._wrappers&&(SFDOMEvent.addListener(Util.isFiori3HeaderEnabled()?Util.getGlobalPlacemat():window,"scroll",this._adjustWrapper,this),SFDOMEvent.addListener(window,"resize",this._adjustWrapper,this))},detach:function(e){if(this._layout.detach(e),this._wrappers&&(SFDOMEvent.removeListener(Util.isFiori3HeaderEnabled()?Util.getGlobalPlacemat():window,"scroll",this._adjustWrapper,this),SFDOMEvent.removeListener(window,"resize",this._adjustWrapper,this)),!e){var t=juic.$(this.id);t&&t.parentNode.removeChild(t)}},cleanup:function(){this.detach();for(var e=0,t=this._metaData.getColumnSize();e<t;e++)this._metaData.getColumnMetaData(e).header.removeEventListener("action",this);this._header instanceof Component&&this._header.cleanup(),this._footer instanceof Component&&this._footer.cleanup(),this._layout&&this._layout.cleanup(),this._gridProvider.removeEventListener("rowCountAvailable",this),this._gridProvider.removeEventListener("rowCountError",this),this._gridProvider&&this._gridProvider.cleanup(),this._error&&this._error.cleanup(),this._super()},getColumnWidth:function(e){return this._layout.getSingleDimension("x",e)},setPadding:function(e){this._layout.setPadding(e)},setColumnWidth:function(e,t){this._layout.setSingleDimension("x",e,t)},setColumnWidths:function(e){this._layout.setColumnWidths(e)},_onLoad:function(){this._gridProvider.getRowCount(),this.attach()},sortBy:function(e,t){for(var a=this._metaData.getIndicesWithValue("x",function(e){var t=e.css;return t&&0<=t.indexOf(g)}),o=0;o<a.length;o++){var n=a[o],i=this._metaData.getColumnMetaData(n,"css");i=i.replace(y,""),i=i.replace(v,""),i=i.replace(C,""),this._metaData.setColumnMetaData(n,"css",i),this._metaData.getColumnMetaData(n,"header").setDirection(null)}var i=this._metaData.getColumnMetaData(e,"css");i&&(i=i.replace(y,""),i=i.replace(v,""),i=i.replace(C,"")),i=(i?i+" ":"")+g+" "+(t==f?m:p),this._metaData.setColumnMetaData(e,"css",i),this._metaData.getColumnMetaData(e,"header").setDirection(t),this._ready&&(this._gridProvider.reset(),this._layout.reset())},reset:function(){this._rowCount=null,this._ready=!1,this._gridProvider.reset(),this._showLoading(),this._gridProvider.getRowCount(),this._layout.reset()},setItemProvider:function(e){e instanceof SFAbstractItemProvider?(this._gridProvider.setItemProvider(e),juic.$(this.id)&&this.reset()):assert(!1,"SFRevolutionGrid: Invalid itemProvider")},getColumnMetaData:function(e,t){return this._metaData.getColumnMetaData(e,t)},removeColumn:function(e,t){this._metaData.removeColumn(e,t)},insertColumn:function(e,t){if(Array.isArray(e)){var a=[];e.forEach(function(e,o){var n=l(e);n.header.addEventListener("action",this,"_onHeaderAction"),a.push(juic.set(n,{index:t+o}))},this),this._metaData.insertColumn(a,t);for(var o=0,n=this._metaData.getColumnSize();o<n;o++)this._metaData.setColumnMetaData(o,"index",o)}else this.insertColumn([e],t)},adjustToParent:function(){if(this._innerScroll){var e=SFDom.getSuggestedDimension(juic.$(this.id).parentNode);e&&0<e.width&&0<e.height&&this._layout.setDimension(e)}else this._layout.adjustToParent()},setDimension:function(e){this._layout.setDimension(e)},getChanges:function(){return this._gridProvider.getChanges()},forEachCachedItem:function(e,t){this._gridProvider.forEachCachedItem(e,t)},setChanges:function(e){this._gridProvider.setChanges(e)},getRowCount:function(){return this._rowCount},setCellWrapperClass:function(e,t,a){this._layout.setCellWrapperClass(e+this._headerSize,t,a)},_onRowCountAvailable:function(e){if(this._rowCount=e.rowCount,this.dispatch("init"),this._focusManager&&this._focusManager.setRowCount(this._rowCount),0<this._rowCount){this._gridProvider.setBodyContent(null),this._layout.setDraggable(!0);var t=this._layout.getBodySectionIndices();this._spans.removeSpan(this._headerSize,t.columnStart),this._hasFooter&&this._metaData.removeRow(this._headerSize+1,1),this._metaData.removeRow(this._headerSize,1),this._metaData.insertRow(this._rowCount,this._headerSize),this._hasFooter&&this._metaData.insertRow(this._rowCount,this._headerSize+this._rowCount)}else this._layout.setDraggable(!1),this._showMessageInBody(this._options.noResultsMessage);this._ready=!0},_onReady:function(){this._wrappers&&this._adjustWrapper()},_adjustWrapper:function(){juic.$(this.id)&&(this._header&&this._adjustWrapperElement("header"),this._footer&&this._adjustWrapperElement("footer"))},_adjustWrapperElement:function(e){var t,a,o=juic.$(this.id),n=juic.$(this.id+e),i=juic.$(this.id+e+"proxy"),r=juic.$(this.id+e+"spacer"),s=i&&r?"fixed":"static",d="static"==s?n:r,l=SFDom.getY(o),_=l+o.offsetHeight,c=SFDom.getY(d),u=d.offsetHeight+SFDom.getMargin(d),g=SFDom.getDocumentScrollTop(),p=SFDom.getViewportHeight(),m=g+p;"header"===e?(a=_-g>u,t=c>=g):"footer"===e?(a=m-l>u,t=c+u<=m):void 0;var h=this._layout.getPadding()||{};h["header"==e?"top":"bottom"]=u,this._layout.setPadding(h);var x=!t&&a?"fixed":"static";s!=x&&("static"===x?(o.removeChild(r),o.insertBefore(n,i),o.removeChild(i)):"fixed"===x?(r=document.createElement("div"),i=document.createElement("div"),set(r,{id:this.id+e+"spacer",style:{height:u+"px"}}),set(i,{id:this.id+e+"proxy",className:e+"Proxy"}),o.insertBefore(r,n),o.insertBefore(i,n),i.appendChild(n)):void 0)},_onError:function(e){e.error&&x.error(e.error),this._showMessageInBody(this._options.errorMessage)},_clearContentRows:function(){var e=this._metaData.getRowSize();e>this._headerSize+this._footerSize&&(this._metaData.removeRow(this._headerSize,e-this._headerSize-this._footerSize),this._rowMeta.setRowCount(0),this._focusManager&&this._focusManager.setRowCount(0))},_createRowMetaData:function(e){var t=[];return this._hasGroups&&t.push({css:_,fixedSize:e.groupHeight||e.rowHeight,frozen:!0}),t.push({css:c,fixedSize:e.rowHeight,frozen:!0}),this._hasFooter&&t.push({css:u,fixedSize:e.footerHeight||e.rowHeight,frozen:!0,sectionIndex:2}),t},_createColumnMetaData:function(e){var t,a,n=[];this._spans=new SFGridSpans;for(var i,r=0;r<e.length;r++){i=set(l(e[r]),{index:r}),i.header.addEventListener("action",this,"_onHeaderAction");var s=i.groupId,d=s&&this._groupLookup[s],_=!1;d?(s==t?(d.addColumns.push(i),i.group=a,d.count++,d.collapsed&&!d.collapsible&&assert(!1,"SFRevolutionGrid: Cannot have a collapsed group that is not collapsible"),d.collapsible&&d.collapsed&&(_=!0)):d.count?(i.groupId=null,assert(!1,"SFRevolutionGrid: All grouped columns must be together: "+s)):(d.firstColumn=i,d.addColumns=[],a=new o(d),a.addEventListener("action",this,"_onGroupAction"),i.group=a,d.count=1,d.startIndex=r),t=s):s&&(assert(!1,"SFRevolutionGrid: Group id does not exist: "+s),i.groupId=null),i.groupId&&(i.css="groupedColumn"+(d.css?" "+d.css:"")),_||n.push(i)}for(var d,r=0;r<n.length;r++)d=this._groupLookup[n[r].groupId],d&&1<d.count&&!d.collapsed&&(this._spans.addSpan(0,r,1,d.count),r+=d.count-1);for(var s in this._groupLookup){var d=this._groupLookup[s];d.count||(assert(!1,"SFRevolutionGrid: A group was provided but it did not have any columns "+s),delete this._groupLookup[s])}return n},_showLoading:function(){this._showMessageInBody(new s)},_showMessageInBody:function(e){var t=this._layout.getBodySectionIndices();this._gridProvider.reset(),this._gridProvider.setBodyContent(e||new s),this._spans.removeSpan(this._headerSize,t.columnStart),this._hasFooter&&this._metaData.removeRow(this._headerSize+1,1),this._clearContentRows(),this._spans.addSpan(this._headerSize,t.columnStart,1,t.columnEnd-t.columnStart+1),this._metaData.insertRow(1,this._headerSize),this._hasFooter&&this._metaData.insertRow(1,this._headerSize+1)},_onHeaderAction:function(e){var t=e.columnDefinition;e.columnIndex=this._metaData.getIndicesWithValue("x","index",t.index)[0],this.dispatchEvent(e)},_onGroupAction:function(e){var t=e.group,a=e.collapsed,o=t.firstColumn,n=this._metaData.getIndicesWithValue("x","index",o.index);null!=n&&0<n.length?(n=n[0],1<t.count&&(a?(this._spans.removeSpan(0,n),this._metaData.removeColumn(n+1,t.count-1)):(this._spans.addSpan(0,n,1,t.count),this._metaData.insertColumn(t.addColumns,n+1)))):assert(!1,"SFRevolutionGrid: Invalid group, first column not found")},_validate:function(e,t){var a=e instanceof Array&&0<e.length,o=t instanceof SFAbstractItemProvider;return assert(a,"SFRevolutionGrid: Columns must be a non-empty array"),assert(o,"SFRevolutionGrid: The itemProvider is not the correct type"),a&&o},_onIntervalMoved:function(e){"x"==e.axisType&&this.dispatch("columnMoved",{fromIndex:e.fromIndex,toIndex:e.toIndex,count:e.count})},_onSizeAdjusted:function(e){if(e.adjusterInfo.x){var t=e.adjusterInfo.x.index;this.dispatch("columnAdjusted",{columnIndex:t,width:this.getColumnWidth(t)})}}}),juic.extend(a,SFAbstractGridProvider,{cleanup:function(){for(var e=this._metaData.getColumnMetaData(),t=0;t<e.length;t++)this._cleanupColumn(e[t]);for(var a in this._groupLookup)this._cleanupGroup(this._groupLookup[a]);this._rowProvider.removeEventListener("gridAvailable",this),this._rowProvider.removeEventListener("gridError",this),this._rowProvider.removeEventListener("gridLoading",this),this._rowProvider.removeEventListener("rowCountAvailable",this),this._rowProvider.removeEventListener("rowCountError",this),this._rowProvider.cleanup()},reset:function(){this._bodyContent=this._loading,this._rowProvider.reset()},getChanges:function(){return this._rowProvider.getChanges()},setChanges:function(e){this._rowProvider.setChanges(e)},forEachCachedItem:function(e,t){this._rowProvider.forEachCachedItem(e,t)},setBodyContent:function(e){this._bodyContent=e},setAllocation:function(e){this._allocation=e},_cleanupColumn:function(e){e.header.cleanup(),e.footer instanceof Component&&e.footer.cleanup()},_cleanupGroup:function(e){e.label instanceof Component&&e.label.cleanup()},getCells:function(e,t,a,o){this._handleHeaders(e,t,a,o),this._handleContent(e,t,a,o),this._hasFooter&&this._handleFooter(e,t,a,o)},setItemProvider:function(e){this._rowProvider.setItemProvider(e)},getRowCount:function(){this._rowCount=0,this._rowProvider.getRowCount()},_onRowCountAvailable:function(e){this._rowCount=e.rowCount,this.dispatchEvent(e)},handleStaleCell:function(e,t){e>=this._headerSize&&e<this._headerSize+this._rowCount&&this._rowProvider.handleStaleCell(e-this._headerSize,t)},handleVisibleCell:function(e,t){e>=this._headerSize&&e<this._headerSize+this._rowCount&&this._rowProvider.handleVisibleCell(e-this._headerSize,t)},handleRemovedCell:function(e,t){e>=this._headerSize&&e<this._headerSize+this._rowCount&&this._rowProvider.handleRemovedCell(e-this._headerSize,t)},_handleGridEvent:function(e){var t=set({},e.region);t.rowFrom+=this._headerSize,t.rowTo+=this._headerSize;var a={region:t};switch(e.type){case"gridAvailable":var o=e.rowCount;if(this._rowCount!=o)return this._rowCount=o,void this.dispatch("rowCountAvailable",{rowCount:o});a.grid=e.grid;break;case"gridError":a.message=e.message,a.error=e.error;}this.dispatch(e.type,a)},_handleHeaders:function(t,a,o,n){if(o<this._headerSize){for(var i=[],r=o;r<this._headerSize&&r<=n;r++)i[r-o]=this._getHeaderRow(r,t,a);this.dispatch("gridAvailable",{region:{rowFrom:o,rowTo:e(this._headerSize-1,n),columnFrom:t,columnTo:a},grid:i})}},_getHeaderRow:function(e,t,a){for(var o=[],n=t;n<=a;n++){var i=this._metaData.getColumnMetaData(n),r=i.header;0==e&&this._hasGroups&&(r=i.group),o[n-t]=r}return o},_handleFooter:function(e,t,a,o){var n=this._metaData.size("y");if(o==n-1){var i=[this._getFooterRow(e,t)];this.dispatch("gridAvailable",{region:{rowFrom:n-1,rowTo:n-1,columnFrom:e,columnTo:t},grid:i})}},_getFooterRow:function(e,t){for(var a=[],o=e;o<=t;o++)a[o-e]=this._metaData.getColumnMetaData(o,"footer");return a},_handleContent:function(a,o,n,i){if(i>=this._headerSize){var r=this._metaData.size("y")-this._footerSize-this._headerSize,s=e(0,n-this._headerSize),d=t(e(0,i-this._headerSize),r-1);if(s<=d)if(1==r&&this._bodyContent){var l=[[]],_=this._allocation.getBodySectionIndices(),c=_.columnStart;c>=a&&c<=o&&(l[0][c-a]=this._bodyContent),this.dispatch("gridAvailable",{region:{rowFrom:s+this._headerSize,rowTo:d+this._headerSize,columnFrom:a,columnTo:o},grid:l})}else this._rowProvider.getCells(a,o,s,d)}}}),juic.extend(o,Component,{renderHtml:function(e){e.push(juic.maybeEscapeHTML(this._group.label)),this._group.collapsible&&e.push("<button id=\"",this.id,"\" onclick=\"",this.fireCode("_clickToggle"),"\" class=\"","groupToggle",this._group.collapsed?" "+h:"","\" title=\"",juic.maybeEscapeHTML(this._getCollapseTitle()),"\"></button>")},_getCollapseTitle:function(){return sfMessageFormat.format(this._group.collapsed?MSGS.COMMON_Expand_Group:MSGS.COMMON_Collapse_Group,this._group.title)},_clickToggle:function(){this._group.collapsed=!this._group.collapsed;var e=juic.$(this.id);SFDom[this._group.collapsed?"addClass":"removeClass"](e,h),e.title=this._getCollapseTitle(),this.dispatch("action",{actionCommand:"toggle",collapsed:this._group.collapsed,group:this._group})}}),juic.extend(n,Component,{cleanup:function(){this._label instanceof Component&&this._label.cleanup(),delete this._definition},renderHtml:function(e){e.push("<span id=\"",this.getHeaderLabelId(),"\" role=\"columnheader\"",this._sortable?" aria-sort=\"true\"":""),"string"==typeof this._label&&e.push(" title=\"",juic.escapeHTML(this._label),"\""),e.push(">"),this._sortable&&e.push("<a href=\"javascript:void(0)\" rel=\"noopener\" class=\"sortable link\" onclick=\"",this.fireCode("_onClickSort"),"return false;\" ondragstart=\"return false\"><span class=\"direction\"></span>"),this._label?"string"==typeof this._label?e.push(juic.escapeHTML(this._label)):e.push(this._label):e.push("&nbsp;"),this._sortable&&(e.push("<span class=\"hiddenAriaContent\">",MSGS.get("COMMON_GRID_CLICK_CHANGE_SORT_ORDER",this.getDirection()===S?MSGS.COMMON_SORT_BY_ASC:MSGS.COMMON_SORT_BY_DES),"</span>"),e.push("</a>")),e.push("</span>")},getHeaderLabelId:function(){return this._label?this.id+"_label":null},setDirection:function(e){this._direction=e},getDirection:function(){return this._direction},_handleLabelAction:function(e){this.dispatch("action",{actionCommand:e.actionCommand,headerEvent:e,columnDefinition:this._definition})},_onClickSort:function(){this.dispatch("action",{actionCommand:"sort",direction:this._direction==S?f:S,columnDefinition:this._definition})}}),juic.extend(i,SFAbstractAxisMetaData,{getMetaData:function(e,t){if(t){var a=e<this._headerSize,o=e==this._headerSize+this._rowCount;switch(t){case"css":return a?0==e&&this._hasGroups?_:c:o?u:e%2?"oddRow alterRow":"evenRow row";case"frozen":return a||o;case"sectionIndex":return a?0:o?2:1;case"adjustable":return!1;}}else{for(var n,i=["css","frozen","sectionIndex","adjustable"],r={},s=0;s<i.length;s++)n=i[s],r[n]=this.getMetaData(e,n);return r}},setRowCount:function(e){this._rowCount=e},getAllocationValue:function(e,t){switch(e){case"sectionTotals":switch(t){case 0:return this._totalHeader;case 1:return this._rowCount*this._rowHeight;case 2:return this._footerHeight;}case"cellSectionOffsets":return t<this._headerSize?1==t?this._groupHeight:0:t==this._headerSize+this._rowCount?0:(t-this._headerSize)*this._rowHeight;case"sizes":return t<this._headerSize?0==t&&this._hasGroups?this._groupHeight:this._headerHeight:t==this._headerSize+this._rowCount?this._footerHeight:this._rowHeight;}},getIndexAtOffset:function(e){return Math.floor(e/this._rowHeight)+this._headerSize},getMinimumSize:function(){return this._rowCount*this._rowHeight+this._totalHeader+this._footerHeight},getIndicesWithValue:function(e){var t=[];return"frozen"===e?(t.push(0),this._hasGroups&&t.push(1),this._hasFooter&&t.push(this._headerSize+this._rowCount)):void 0,t},size:function(){return this._headerSize+this._footerSize+this._rowCount},insert:function(e){this._rowCount=e}}),juic.extend(r,SFAbstractFocusManager,{setRowCount:function(e){this._rowCount=e},getNextFocusableColumn:function(e,t,a){if(e==this._headerSize-1&&this._hasSortable){for(var o=this._metaData.getColumnSize(),n=a?-1:1,i=null==t?a?o-1:0:t+n,r=i;0<=r&&r<o;r+=n)if(this._metaData.getColumnMetaData(r,"sortable"))return r;}else if(this._focusManager&&e>=this._headerSize&&e<this._headerSize+this._rowCount){if(this._focusManager instanceof SFAbstractFocusManager)return this._focusManager.getNextFocusableColumn(e-this._headerSize,t,a);var o=this._metaData.getColumnSize();null==t&&(t=a?o:-1);var s=t+(a?-1:1);return 0>s?null:s>=o?null:s}return null},getNextFocusableRow:function(a,o){var n=null,i=null;if(i=null==a?o?this._headerSize+this._rowCount-2:this._headerSize-(this._hasSortable?1:0):a+(o?-1:1),i<this._headerSize)n=this._hasSortable?i:null;else if(this._focusManager instanceof SFAbstractFocusManager){if(null==a)n=this._focusManager.getNextFocusableRow(null,o);else{var r=t(e(0,a-this._headerSize),this._rowCount-1);n=this._focusManager.getNextFocusableRow(r,o)}n=null==n?null:n+this._headerSize}else{var s=this._metaData.getRowSize();null==a&&(a=o?s:-1);var n=a+(o?-1:1);return 0>n||n>=s?null:n}return n}}),juic.extend(s,juic.Component,{renderHtml:function(e){e.push("<div class=\"sfLoadingContainerSm\"><span class=\"white\">",MSGS.COMMON_loading,"</span></div>")},cleanup:function(){}})})();