function SFAdvancedTextArea(a,b){this.register(),this._init(b||{}),this.setValue(a),this._oldValue=a}SFAdvancedTextArea.FIELD_TYPE="TextArea",SFAdvancedTextArea.DEFAULT_HEIGHT=48,SFAdvancedTextArea.MAXIMUM_HEIGHT=150,SFAdvancedTextArea.DEFAULT_AUTOGROW_BOTTOMSPACE=3,function(){var a=Math.min,b=Math.max;function c(c,d,e){return null!=d&&(c=b(c,d)),null!=e&&(c=a(c,e)),c}function d(a,b,d){return{width:c(a.width,b&&b.width,d&&d.width),height:c(a.height,b&&b.height,d&&d.height)}}var e={width:0,height:0},f=20;juic.extend(SFAdvancedTextArea,SFAbstractInputField,{WARNING_HIDE_DELAY_SECONDS:5,POST_MAX_LENGTH_ALLOWED_KEYS:{8:"BACKSPACE",9:"TAB",33:"PAGE_UP",34:"PAGE_DOWN",35:"END",36:"HOME",37:"LEFT_ARROW",38:"UP_ARROW",39:"RIGHT_ARROW",40:"DOWN_ARROW",45:"INSERT",46:"DELETE"},_writeHTMLElement:null,_hideOnBlur:!0,_init:function(a){this._config=a,this._rows=a.rows&&0<a.rows?a.rows:3,this._cols=a.cols&&0<a.cols?a.cols:40,this._height=a.height||SFAdvancedTextArea.DEFAULT_HEIGHT,this._width=a.width,this._autoGrow_maxHeight=a.maxHeight?a.maxHeight:SFAdvancedTextArea.MAXIMUM_HEIGHT,this._autoGrow_bottomspace=a.autoGrow_bottomspace?a.autoGrow_bottomspace:SFAdvancedTextArea.DEFAULT_AUTOGROW_BOTTOMSPACE,this._writable=!("undefined"!=typeof a.writable)||a.writable,this._maxLength=this._config.maxLength,this._isAriaRequired=this._config.isAriaRequired,this._writable&&this._maxLength&&(this.textLimiter=new SFTextLimiter(this._maxLength,this._config.countByByte),this.textLimiter.addEventListener("limiterAction",this,"_handleLimiterEvent"),this._charLimitDialog=new SFDialog(MSGS.COMMON_Err,new SFSysMsg("alert",MSGS.get("COMMON_RTE_MAXIMUM_PASTE_LIMIT_MESSAGE",this._maxLength)),[{label:MSGS.COMMON_Ok,enabled:!0,active:!0,eventName:"hide"}],400,100)),this.writeEleId=a.name?a.name:this.id+"_write",this._vwaActive=!("boolean"!=typeof a.vwaActive)&&a.vwaActive,this._vwaCustomData=a.vwaCustomData,this._initForDragResizer(a)},_handleLimiterEvent:function(a){var b=juic.$(this.id+"_limiterText");"aboveThreshold"==a.actionCommand||"atThreshold"==a.actionCommand?(b.style.display="",this._hideOnBlur=!0):"maxLength"==a.actionCommand||"aboveMaxLength"==a.actionCommand?(b.style.display="",this._hideOnBlur=!1):b.style.display="none"},getWriteElement:function(){var a=this._writeHTMLElement;if(!a&&(a=juic.$(this.writeEleId),a)){this._writeHTMLElement=a;var b=juic.$(this.id+"_limiterText");b&&(b.style.width="100%")}return a},setValue:function(a){this._value=a||"";var b=this._writable?this.getWriteElement():juic.$(this.id+"_read");b&&(this._writable?b.value=this._value:b.innerHTML=escapeHTML(this._value),this._updateWrapperClassName())},getValue:function(){var a=this._writable&&this.getWriteElement()?this.getWriteElement().value:this._value;return a&&(a=a.trim(),this._value=a),a},getWrapperSpanId:function(){var a=this._wrapperSpanId;return a||(a=this.id+"_efeWrapperSpan"),a},_resizeForAutoGrow:function(){this._storeOldValue();var a=juic.$(this.getWrapperSpanId()),b=this.getWriteElement();a.style.height=b.style.height,SFDom.replaceClass(b,"showScrollbar","hideScrollbar"),b.style.height=this._autoGrow_minHeight+"px",b.scrollHeight>=this._autoGrow_minHeight&&b.scrollHeight<=this._autoGrow_maxHeight&&b.offsetHeight<=b.scrollHeight?b.style.height=b.scrollHeight+this._autoGrow_bottomspace+"px":b.scrollHeight>this._autoGrow_maxHeight&&(b.style.height=this._autoGrow_maxHeight+"px",SFDom.replaceClass(b,"hideScrollbar","showScrollbar")),a.style.height="auto",this._checkandRestValue()},_storeOldValue:function(a){var b=this.getWriteElement();b.value.length<=this._maxLength?this._oldValuetemp=b.value:(this._oldValuetemp=b.value.slice(0,this._maxLength),a&&this._charLimitDialog.showDialog())},_keyUp:function(){this.dispatch("keyup"),this._resizeForAutoGrow()},_keyDown:function(){this.dispatch("keydown")},_focus:function(){this._storeOldValue(!0),this._focusFlag=!0,this._updateWrapperClassName(),this._resizeForAutoGrow()},_checkandRestValue:function(a){if(!this._maxLength)return!0;var b=this,c=this.getWriteElement();setTimeout(function(){var d=c.value.length;d>b._config.maxLength&&(c.value=b._oldValuetemp,a&&b._charLimitDialog.showDialog()),b.textLimiter.checkLimiter(c.value)},0)},_getWrapperClassName:function(){var a="";return a=this._focusFlag?"field-focus":this._getFontColor(),"writeComp formElement sfTextAreaWrapper "+a},_renderWriteHtml:function(a){delete this._writeHTMLElement,a.push("<div id =\"",this.getWrapperSpanId(),"\" class=\"writeComp sfTextAreaWrapper\">","<textarea class='formElement sfTextArea hideScrollbar ",this.generateFDClasses("textarea"),"' style='color:",this._fontColor),this._allowResize||a.push("; resize:none;"),a.push("; max-height:",this._autoGrow_maxHeight,isNaN(this._autoGrow_maxHeight)?"":"px",";"),this._height&&a.push("height:",this._height,isNaN(this._height)?"":"px",";"),this._width&&a.push("width:",this._width,isNaN(this._width)?"":"px",";"),a.push("' "),this._height||a.push("rows='",this._rows,"' "),this._isAriaRequired&&a.push("aria-required='",this._isAriaRequired,"' "),this._width||a.push("cols='",this._cols,"' ");var b=this._vwaActive?"data-vwa-active=\"true\" "+(this._maxLength?"data-vwa-text-size=\""+this._maxLength+"\" ":"")+function(a){var b="";if(a)for(var c in a)b+="data-vwa-custom-"+c+"=\""+a[c]+"\" ";return b}(this._vwaCustomData):"";a.push(b),a.push(" id='",this.writeEleId,"' "," name='",this.writeEleId,"' "," onfocus='",this.fireCode("_focus"),"' "," onpaste='",this.fireCode("_checkandRestValue",!0),"' "," onchange='",this.fireCode("_change"),"' "," onblur='",this.fireCode("_blur"),"' "," onkeyup='",this.fireCode("_keyUp"),"' "," onkeydown='",this.fireCode("_keyDown"),"' ",">",Util.escapeHTML(this._value)+"</textarea>"),a.addAfterRenderListener&&a.addAfterRenderListener(this,"handleAfterWriteElemRendered"),a.push("<div id=\"",this.id,"_limiterText\" style=\"display:none\" class=\"limiterWrapper\" ","role=\"presentation\"","><span class=\"globalFloatRight\">"),this.textLimiter&&this.textLimiter.renderHtml(a),a.push("</span></div></div>")},handleAfterWriteElemRendered:function(){this._autoGrow_minHeight=this._height?this._height:this._rows*parseInt(SFDom.getComputedStyle(juic.$(this.writeEleId),"line-height"))},renderHtml:function(a){!this._missingResizeFeature&&this._allowResize?this._renderForDragResizer(a):this._renderContent(a)},_renderContent:function(a){this._writable&&(this._renderWriteHtml(a),this._maxLength&&a.push("<div id='",this.id,"_warning' class='warningText' role='presentation'></div>")),a.push("<div id=\""+this.id+"_read\" class=\""+(this._writable?"readComp":"read_only")+"\">"+Util.escapeHTML(this._value,"<br/>").replace(/\s/ig,"&nbsp;")+"</div>"),this._sfError.renderHtml(a)},isModified:function(){return"undefined"==typeof this._oldValue&&this._value||this._oldValue!=this._value},reset:function(){this._value!==this._oldValue&&(this.setValue(this._oldValue),this.checkForErrors(),this.dispatch(SFAbstractInputField.EVENT_CHANGE,{actionCommand:SFAbstractInputField.EVENT_FIELD_UNCHANGE,hasError:this._hasError}))},_blur:function(){if(this._focusFlag=!1,this._hideOnBlur){var a=juic.$(this.id+"_limiterText");a.style.display="none"}this.getWriteElement();this.checkForErrors()},_change:function(){var a=this.getWriteElement();if(a){this._updateWrapperClassName(),this._value=a.value.trim(),this.checkForErrors();var b=this.isModified()?SFAbstractInputField.EVENT_FIELD_CHANGE:SFAbstractInputField.EVENT_FIELD_UNCHANGE;this.dispatch(SFAbstractInputField.EVENT_CHANGE,{actionCommand:b,hasError:this._hasError})}},_initForDragResizer:function(a){var b=document.createElement("textarea");this.setOptions(a),this._missingResizeFeature="undefined"!=typeof SFDom.getComputedStyle(b,"resize"),this._allowResize=!!a.allowResize,this._dimension=a.dimension},positionFixed:function(a){var b=Math.abs,c=b(a.newComponentHeight),d=b(a.newComponentWidth);this._fixPoint=a.positionInfo.fixPoint,this._flipY="top"==this._fixPoint.origin.vertical,this._flipX="right"==this._fixPoint.origin.horizontal;var e=juic.$(this.getReferenceId());if(this._flipY&&(e.style.top="0px"),SFDom[this._flipY?"addClass":"removeClass"](e,"sf-drag-flipy"),SFDom[this._flipX?"addClass":"removeClass"](e,"sf-drag-flipx"),c||d){var g={};this._offsetsX||(this._offsetsX=SFDom.getOffsets(e,"x"),this._offsetsY=SFDom.getOffsets(e,"y")),c&&(g.height=c-this._offsetsY-f),d&&(g.width=d-this._offsetsX-f),this.setDimension(g)}else this.resize()},getReferenceId:function(){return this.id+"_dragResizer"},_renderForDragResizer:function(a){a.push("<div id=\"",this.getReferenceId(),"\" class=\"","sf-drag-resizer",this._containerCss?" "+this._containerCss:"","\">"),this._renderOuterContent(a),a.push("</div>"),a.addAfterRenderListener&&a.addAfterRenderListener(this,"handleAfterRenderListener")},_renderOuterContent:function(a){a.push("<div id=\"",this.id,"thumb\" class=\"thumb\" onmousedown=\"",this.fireCode("_onDragStart"),"\" ontouchstart=\"",this.fireCode("_onDragStart"),"\" unselectable=\"on\" onselectstart=\"return false\"></div>"),this._dragByResizing||a.push("<div id=\"",this.id,"drag-box\" class=\"","drag-box","\"></div>"),a.push("<div class=\"resizer-wrapper\">"),this._renderContent(a),a.push("</div>")},handleDragEvent:function(c){switch(c.type){case"dragStart":this._startDragging();break;case"drag":case"dragEnd":var f=SFDom.getViewportRegion();x=b(a(f.right-17,c.point.x),f.left+17),y=b(a(f.bottom-17,c.point.y),f.top+17);var g=x-c.origin.x,h=y-c.origin.y;this._flipY&&(h=-h),this._flipX&&(g=-g);var i={width:this._startDimension.width+g,height:this._startDimension.height+h};i=d(i,this.getMinDimension()||e,this.getMaxDimension()),"dragEnd"==c.type&&this._endDragging(),this._dragByResizing||"dragEnd"==c.type?this._resize(i):this._showResize(i);}},setOptions:function(a){this._dragByResizing=a&&a.allowResize,this._setFullWidth(a)},cleanup:function(){this.unregister()},_setFullWidth:function(a){var b=a&&a.fullWidth;b&&(this._fullWidth=b-4*1)},_startDragging:function(){var a=juic.$(this.getReferenceId());SFDom.addClass(a,"resizing"),this._startDimension={width:a.offsetWidth-SFDom.getOffsets(a,"x"),height:a.offsetHeight-SFDom.getOffsets(a,"y")},this._startPosition={top:parseInt(a.style.top)||0,left:parseInt(a.style.left)||0},this._dragByResizing||this._showResize(this._startDimension)},_endDragging:function(){SFDom.removeClass(juic.$(this.getReferenceId()),"resizing")},_resize:function(a){this.setDimension(a),this.dispatch("changeDimensions"),this.dispatch("dragResize",{dimension:a})},_showResize:function(a){var c=juic.$(this.id+"drag-box"),d=SFDom.getOffsets(c,"x"),e=SFDom.getOffsets(c,"y");if(c.style.width=b(0,a.width-d)+"px",c.style.height=b(0,a.height-e)+"px",this._flipY){var f=juic.$(this.getReferenceId()),g=this._startDimension.height-a.height;g+=parseInt(SFDom.getStyle(f,"padding-top"))||0,g+=parseInt(SFDom.getStyle(f,"border-top"))||0,c.style.top=g+"px"}},_onDragStart:function(a){a=a||window.event,-1<a.type.indexOf("touch")&&SFDOMEvent.stopEvent(a),SFDragDropMgr.handleDragStart(a,this,{useShim:!0,shimCursor:"move",clickTimeThreshold:0})},_getDimensions:function(){var a=SFDom.getRegion(this._getWriteEleId());this._dimension={width:a.width-2*this._getBorderWidth(),height:a.height-2*this._getBorderWidth()}},_getBorderWidth:function(){return 1},_setStyles:function(a){SFDom.setStyle(this._getWriteEleId(),"width",a.width-2*this._getBorderWidth()+"px"),SFDom.setStyle(this._getWriteEleId(),"height",a.height-2*this._getBorderWidth()+"px")},_getWriteEleId:function(){return this.writeEleId},handleAfterRenderListener:function(){},setResizable:function(){},getResizable:function(){return this},setDimension:function(a){this._dimension=a,this._setStyles(a)},getDimension:function(){return this._getDimensions(),this._dimension},resize:function(){},getMinDimension:function(){if(!this._config.minDimensions){var a=SFDom.getDefaultFontSize();this._config.minDimensions={width:"25",height:a[1]+4}}return this._config.minDimensions},getMaxDimension:function(){return this._config.maxDimensions}})}();