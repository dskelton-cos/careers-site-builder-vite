function WidgetUtil(){}(function(){function a(b){var g=window;m=g["widget-loader"];var h=g.sap&&sap.ui&&sap.ui.require;if(m)b&&b(m);else if(h&&!o)h(["xweb/widget-loader/widget-loader"],b,function(){o=!0,a(b)});else if(l)b&&l.push(b);else{var j=f();if(j)l=[],e(j,b);else if(jQuery&&jQuery.ajax)l=[],i(d()?"":c()).then(function(a){e(a,b)},function(){l=void 0,console.error("Failed to get the resourcRoot from Jsonp")});else throw new Error("Failed to load the widget-loader because the resourceRoot could not be found")}}function b(){return n?n:(n=new Promise(function(a,b){var d=c();p.get(d).then(function(b){a({providerBaseUrl:d,ajaxSecKey:b})},function(a){b("Failed to get the CSRF Token. "+a)})}),n)}function c(){var a=g(["pageHeaderJsonData"],"baseUrl");if(!a){var b=document.getElementById("sfBaseUrl");a=b&&b.content}if(a||(a=g(["APP_PARAMS"],"sfBaseURL")),!a){a=g(["BIZX_PING_PARAMS"],"ServerPingURL");var c=a&&new URL(a);a=c&&c.origin}return a}function d(){return!!window.ajaxSecKey}function e(a,c){var e=a+"widget-loader.min.js",f=function(){m=window["widget-loader"],m&&(c&&c(m),l.forEach(function(a){a(m)})),l=void 0},g=function(){m=window["widget-loader"],m&&(d()?f():b().then(function(a){m.updateSettings(a),f()}))},h=k();if(h)h.dangerouslyIncludeScript(e,c).then(g);else{var i=document.createElement("script"),j=(document.querySelector("meta[name=snonce]")||{}).content;j&&(i.nonce=j),i.type="text/javascript",i.src=e,i.onload=g,i.onerror=g,document.body.appendChild(i)}}function f(){var a=g(["sap-ui-config.resourceRoots","sap-ui-config.resourceroots","pageHeaderJsonData.resourceRoots"],"xweb.widget-loader");return a||h()}function g(a,b){var c,d=window;return[d,d.parent,d.opener].some(function(d){return d&&a.some(function(a){return c=(j(a,d)||{})[b],c}),c}),c}function h(){var a,b=document.getElementById("resourceRoots"),c=b&&b.content;if(c&&"string"==typeof c)try{a=JSON.parse(c)["xweb.widget-loader"]}catch(a){console.error("Invalid JSON string",a)}return a}function i(a){return jQuery.ajax({url:a+"/public/theme-api/init/?jsonp=?",dataType:"jsonp"}).then(function(a){var b=a&&a.resourceRoots;return b&&b["xweb/widget-loader"]})}function j(a,b){return a.split(".").reduce(function(a,b){return a&&a[b]},b)}function k(){return j("sap.sf.surj.shell.util.Util",window)}var l,m,n,o=!1,p={parse:function(a){return a.text().then(function(a){var b=/ajaxSecKey\s*=\s*['"]([^'"]*)['"]/.exec(a);if(b)return b[1];throw new Error("invalidResponse")})},get:function(a){return window.ajaxSecKey?Promise.resolve(window.ajaxSecKey):a?fetch(a+"/sf/protected/cors",{credentials:"include"}).then(function(a){if(!a.ok)throw new Error("csrf token error");return p.parse(a)}):Promise.reject("baseUrl required")}};WidgetUtil.getWidget=function(b,c){var d;return window.Promise&&(d=new Promise(function(a,b){var d=c;c=function(c,e){(e?b:a)(c),d&&d(c,e)}})),a(function(a){a.get(b).then(c)}),d},WidgetUtil.openDialog=function(a,b,c){return Promise.all(["xweb/mini-app-dialog",a].map(WidgetUtil.getWidget)).then(function(d){return d[0]({widgetName:a,initialSettings:c,context:b})})},WidgetUtil.test={getBaseUrl:c,CSRFToken:p,getLoader:a,getWidgetSettings:b,getPathFromMeta:h,clearTestPromise:function(){n=void 0}}})();