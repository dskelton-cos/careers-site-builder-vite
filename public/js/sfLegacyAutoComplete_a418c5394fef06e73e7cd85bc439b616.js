juic.SFLegacyAutoComplete=function(e,t,o,n){if(e&&t&&o){if(o&&"function"==typeof o.sendRequest)this.dataSource=o;else return;this.key=0;var a=o.responseSchema;if(o._aDeprecatedSchema){var l=o._aDeprecatedSchema;Array.isArray(l)&&(o.responseType===juic.legacyUtil.DataSourceBase.TYPE_JSON||o.responseType===juic.legacyUtil.DataSourceBase.TYPE_UNKNOWN?(a.resultsList=l[0],this.key=l[1],a.fields=3>l.length?null:l.slice(1)):o.responseType===juic.legacyUtil.DataSourceBase.TYPE_XML?(a.resultNode=l[0],this.key=l[1],a.fields=l.slice(1)):o.responseType===juic.legacyUtil.DataSourceBase.TYPE_TEXT&&(a.recordDelim=l[0],a.fieldDelim=l[1]),o.responseSchema=a)}if(SFDom.inDoc(e))"string"==typeof e?(this._sName="instance"+juic.SFLegacyAutoComplete._nIndex+" "+e,this._elTextbox=document.getElementById(e)):(this._sName=e.id?"instance"+juic.SFLegacyAutoComplete._nIndex+" "+e.id:"instance"+juic.SFLegacyAutoComplete._nIndex,this._elTextbox=e),SFDom.addClass(this._elTextbox,"yui-ac-input"),this._elTextbox.setAttribute("role","combobox"),this._elTextbox.setAttribute("aria-expanded","false");else return;if(SFDom.inDoc(t)){this._elContainer="string"==typeof t?document.getElementById(t):t;var r=this._elContainer.parentNode,p=r.tagName.toLowerCase();"div"==p&&SFDom.addClass(r,"yui-ac")}else return;if(this.dataSource.dataType===juic.legacyUtil.DataSourceBase.TYPE_LOCAL&&(this.applyLocalFilter=!0),n&&n.constructor==Object)for(var i in n)i&&(this[i]=n[i]);this.a11yAnnounce&&this._initA11yAnnouncement(),this._initContainerEl(),this._initProps(),this._initListEl(),this._initContainerHelperEls();var s=this,u=this._elTextbox;SFLegacyEvent.addListener(u,"keyup",s._onTextboxKeyUp,s),SFLegacyEvent.addListener(u,"keydown",s._onTextboxKeyDown,s),SFLegacyEvent.addListener(u,"focus",s._onTextboxFocus,s),SFLegacyEvent.addListener(u,"blur",s._onTextboxBlur,s),SFLegacyEvent.addListener(t,"mouseover",s._onContainerMouseover,s),SFLegacyEvent.addListener(t,"mouseout",s._onContainerMouseout,s),SFLegacyEvent.addListener(t,"click",s._onContainerClick,s),SFLegacyEvent.addListener(t,"scroll",s._onContainerScroll,s),SFLegacyEvent.addListener(t,"resize",s._onContainerResize,s),SFLegacyEvent.addListener(u,"keypress",s._onTextboxKeyPress,s),SFLegacyEvent.addListener(window,"pagehide",s._onWindowUnload,s),this.textboxFocusEvent=new SFCustomEvent("textboxFocus",this),this.textboxKeyEvent=new SFCustomEvent("textboxKey",this),this.dataRequestEvent=new SFCustomEvent("dataRequest",this),this.dataRequestCancelEvent=new SFCustomEvent("dataRequestCancel",this),this.dataReturnEvent=new SFCustomEvent("dataReturn",this),this.dataErrorEvent=new SFCustomEvent("dataError",this),this.containerPopulateEvent=new SFCustomEvent("containerPopulate",this),this.containerExpandEvent=new SFCustomEvent("containerExpand",this),this.typeAheadEvent=new SFCustomEvent("typeAhead",this),this.itemMouseOverEvent=new SFCustomEvent("itemMouseOver",this),this.itemMouseOutEvent=new SFCustomEvent("itemMouseOut",this),this.itemArrowToEvent=new SFCustomEvent("itemArrowTo",this),this.itemArrowFromEvent=new SFCustomEvent("itemArrowFrom",this),this.itemSelectEvent=new SFCustomEvent("itemSelect",this),this.unmatchedItemSelectEvent=new SFCustomEvent("unmatchedItemSelect",this),this.selectionEnforceEvent=new SFCustomEvent("selectionEnforce",this),this.containerCollapseEvent=new SFCustomEvent("containerCollapse",this),this.textboxBlurEvent=new SFCustomEvent("textboxBlur",this),this.textboxChangeEvent=new SFCustomEvent("textboxChange",this),u.setAttribute("autocomplete","off"),juic.SFLegacyAutoComplete._nIndex++}},juic.SFLegacyAutoComplete.prototype.dataSource=null,juic.SFLegacyAutoComplete.prototype.applyLocalFilter=null,juic.SFLegacyAutoComplete.prototype.queryMatchCase=!1,juic.SFLegacyAutoComplete.prototype.queryMatchContains=!1,juic.SFLegacyAutoComplete.prototype.queryMatchSubset=!1,juic.SFLegacyAutoComplete.prototype.minQueryLength=1,juic.SFLegacyAutoComplete.prototype.maxResultsDisplayed=10,juic.SFLegacyAutoComplete.prototype.queryDelay=.2,juic.SFLegacyAutoComplete.prototype.typeAheadDelay=.5,juic.SFLegacyAutoComplete.prototype.queryInterval=500,juic.SFLegacyAutoComplete.prototype.highlightClassName="yui-ac-highlight",juic.SFLegacyAutoComplete.prototype.prehighlightClassName=null,juic.SFLegacyAutoComplete.prototype.delimChar=null,juic.SFLegacyAutoComplete.prototype.autoHighlight=!0,juic.SFLegacyAutoComplete.prototype.typeAhead=!1,juic.SFLegacyAutoComplete.prototype.animHoriz=!1,juic.SFLegacyAutoComplete.prototype.animVert=!0,juic.SFLegacyAutoComplete.prototype.animSpeed=.3,juic.SFLegacyAutoComplete.prototype.forceSelection=!1,juic.SFLegacyAutoComplete.prototype.allowBrowserAutocomplete=!0,juic.SFLegacyAutoComplete.prototype.alwaysShowContainer=!1,juic.SFLegacyAutoComplete.prototype.useIFrame=!1,juic.SFLegacyAutoComplete.prototype.a11yAnnounce=!1,juic.SFLegacyAutoComplete.prototype.a11yHiddenTextId="autocompleteA11yAnnounceHiddenText",juic.SFLegacyAutoComplete.prototype.useShadow=!1,juic.SFLegacyAutoComplete.prototype.suppressInputUpdate=!1,juic.SFLegacyAutoComplete.prototype.resultTypeList=!0,juic.SFLegacyAutoComplete.prototype.queryQuestionMark=!0,juic.SFLegacyAutoComplete.prototype.autoSnapContainer=!0,juic.SFLegacyAutoComplete.prototype.toString=function(){return"AutoComplete "+this._sName},juic.SFLegacyAutoComplete.prototype.getInputEl=function(){return this._elTextbox},juic.SFLegacyAutoComplete.prototype.getContainerEl=function(){return this._elContainer},juic.SFLegacyAutoComplete.prototype.isFocused=function(){return this._bFocused},juic.SFLegacyAutoComplete.prototype.isContainerOpen=function(){return this._bContainerOpen},juic.SFLegacyAutoComplete.prototype.getListEl=function(){return this._elList},juic.SFLegacyAutoComplete.prototype.getListItemMatch=function(e){return e._sResultMatch?e._sResultMatch:null},juic.SFLegacyAutoComplete.prototype.getListItemData=function(e){return e._oResultData?e._oResultData:null},juic.SFLegacyAutoComplete.prototype.getListItemIndex=function(e){return"number"==typeof e._nItemIndex&&isFinite(e._nItemIndex)?e._nItemIndex:null},juic.SFLegacyAutoComplete.prototype.setHeader=function(e){if(this._elHeader){var t=this._elHeader;e?(t.innerHTML=e,t.style.display=""):(t.innerHTML="",t.style.display="none")}},juic.SFLegacyAutoComplete.prototype.setFooter=function(e){if(this._elFooter){var t=this._elFooter;e?(t.innerHTML=e,t.style.display=""):(t.innerHTML="",t.style.display="none")}},juic.SFLegacyAutoComplete.prototype.setBody=function(e){if(this._elBody){var t=this._elBody;SFLegacyEvent.purgeElement(t,!0),e?(t.innerHTML=e,t.style.display=""):(t.innerHTML="",t.style.display="none"),this._elList=null}},juic.SFLegacyAutoComplete.prototype.generateRequest=function(e){var t=this.dataSource.dataType;return t===juic.legacyUtil.DataSourceBase.TYPE_XHR?this.dataSource.connMethodPost?e=(this.dataSource.scriptQueryParam||"query")+"="+e+(this.dataSource.scriptQueryAppend?"&"+this.dataSource.scriptQueryAppend:""):e=(this.queryQuestionMark?"?":"")+(this.dataSource.scriptQueryParam||"query")+"="+e+(this.dataSource.scriptQueryAppend?"&"+this.dataSource.scriptQueryAppend:""):t===juic.legacyUtil.DataSourceBase.TYPE_SCRIPTNODE&&(e="&"+(this.dataSource.scriptQueryParam||"query")+"="+e+(this.dataSource.scriptQueryAppend?"&"+this.dataSource.scriptQueryAppend:"")),e},juic.SFLegacyAutoComplete.prototype.sendQuery=function(e){this._bFocused=!0;var t=this.delimChar?this._elTextbox.value+e:e;this._sendQuery(t)},juic.SFLegacyAutoComplete.prototype.snapContainer=function(){var e=this._elTextbox,t=SFDom.getXY(e);t[1]+=SFDom.get(e).offsetHeight+2,SFDom.setXY(this._elContainer,t)},juic.SFLegacyAutoComplete.prototype.expandContainer=function(){this._toggleContainer(!0)},juic.SFLegacyAutoComplete.prototype.collapseContainer=function(){this._toggleContainer(!1)},juic.SFLegacyAutoComplete.prototype.clearList=function(){for(var e=this._elList.childNodes,t=e.length-1;-1<t;t--)e[t].style.display="none"},juic.SFLegacyAutoComplete.prototype.getSubsetMatches=function(e){for(var t,o,n,a=e.length;a>=this.minQueryLength;a--)if(n=this.generateRequest(e.substr(0,a)),this.dataRequestEvent.fire(this,t,n),o=this.dataSource.getCachedResponse(n),o)return this.filterResults.apply(this.dataSource,[e,o,o,{scope:this}]);return null},juic.SFLegacyAutoComplete.prototype.preparseRawResponse=function(e,t){var o=""!==this.responseStripAfter&&t.indexOf?t.indexOf(this.responseStripAfter):-1;return-1!=o&&(t=t.substring(0,o)),t},juic.SFLegacyAutoComplete.prototype.filterResults=function(e,t,o,n){if(n&&n.argument&&Util.isValue(n.argument.query)&&(e=n.argument.query),e&&""!==e){o=juic.SFLegacyAutoComplete._cloneObject(o);for(var a=n.scope,l=this,r=o.results,p=[],s=a.maxResultsDisplayed,u=l.queryMatchCase||a.queryMatchCase,y=l.queryMatchContains||a.queryMatchContains,d=0,c=r.length;d<c;d++){var g=r[d],m=null;if("string"==typeof g)m=g;else if(Array.isArray(g))m=g[0];else if(this.responseSchema.fields){var C=this.responseSchema.fields[0].key||this.responseSchema.fields[0];m=g[C]}else this.key&&(m=g[this.key]);if("string"==typeof m){var _=u?m.indexOf(decodeURIComponent(e)):m.toLowerCase().indexOf(decodeURIComponent(e).toLowerCase());(!y&&0===_||y&&-1<_)&&p.push(g)}if(c>s&&p.length===s)break}o.results=p}return o},juic.SFLegacyAutoComplete.prototype.handleResponse=function(e,t,o){this instanceof juic.SFLegacyAutoComplete&&this._sName&&this._populateList(e,t,o)},juic.SFLegacyAutoComplete.prototype.doBeforeLoadData=function(){return!0},juic.SFLegacyAutoComplete.prototype.formatResult=function(e,t,o){var n=o?o:"";return n},juic.SFLegacyAutoComplete.prototype.formatEscapedResult=function(e,t,o){var n=o?o:"";return Util.escapeHTML(n)},juic.SFLegacyAutoComplete.prototype.doBeforeExpandContainer=function(){return!0},juic.SFLegacyAutoComplete.prototype.destroy=function(){var e=this.toString(),t=this._elTextbox,o=this._elContainer;for(var n in this.textboxFocusEvent.unsubscribeAll(),this.textboxKeyEvent.unsubscribeAll(),this.dataRequestEvent.unsubscribeAll(),this.dataReturnEvent.unsubscribeAll(),this.dataErrorEvent.unsubscribeAll(),this.containerPopulateEvent.unsubscribeAll(),this.containerExpandEvent.unsubscribeAll(),this.typeAheadEvent.unsubscribeAll(),this.itemMouseOverEvent.unsubscribeAll(),this.itemMouseOutEvent.unsubscribeAll(),this.itemArrowToEvent.unsubscribeAll(),this.itemArrowFromEvent.unsubscribeAll(),this.itemSelectEvent.unsubscribeAll(),this.unmatchedItemSelectEvent.unsubscribeAll(),this.selectionEnforceEvent.unsubscribeAll(),this.containerCollapseEvent.unsubscribeAll(),this.textboxBlurEvent.unsubscribeAll(),this.textboxChangeEvent.unsubscribeAll(),SFLegacyEvent.purgeElement(t,!0),SFLegacyEvent.purgeElement(o,!0),o.innerHTML="",this)this.hasOwnProperty&&this.hasOwnProperty(n)&&(this[n]=null)},juic.SFLegacyAutoComplete.prototype.textboxFocusEvent=null,juic.SFLegacyAutoComplete.prototype.textboxKeyEvent=null,juic.SFLegacyAutoComplete.prototype.dataRequestEvent=null,juic.SFLegacyAutoComplete.prototype.dataRequestCancelEvent=null,juic.SFLegacyAutoComplete.prototype.dataReturnEvent=null,juic.SFLegacyAutoComplete.prototype.dataErrorEvent=null,juic.SFLegacyAutoComplete.prototype.containerPopulateEvent=null,juic.SFLegacyAutoComplete.prototype.containerExpandEvent=null,juic.SFLegacyAutoComplete.prototype.typeAheadEvent=null,juic.SFLegacyAutoComplete.prototype.itemMouseOverEvent=null,juic.SFLegacyAutoComplete.prototype.itemMouseOutEvent=null,juic.SFLegacyAutoComplete.prototype.itemArrowToEvent=null,juic.SFLegacyAutoComplete.prototype.itemArrowFromEvent=null,juic.SFLegacyAutoComplete.prototype.itemSelectEvent=null,juic.SFLegacyAutoComplete.prototype.unmatchedItemSelectEvent=null,juic.SFLegacyAutoComplete.prototype.selectionEnforceEvent=null,juic.SFLegacyAutoComplete.prototype.containerCollapseEvent=null,juic.SFLegacyAutoComplete.prototype.textboxBlurEvent=null,juic.SFLegacyAutoComplete.prototype.textboxChangeEvent=null,juic.SFLegacyAutoComplete._nIndex=0,juic.SFLegacyAutoComplete.prototype._sName=null,juic.SFLegacyAutoComplete.prototype._elTextbox=null,juic.SFLegacyAutoComplete.prototype._elContainer=null,juic.SFLegacyAutoComplete.prototype._elContent=null,juic.SFLegacyAutoComplete.prototype._elHeader=null,juic.SFLegacyAutoComplete.prototype._elBody=null,juic.SFLegacyAutoComplete.prototype._elFooter=null,juic.SFLegacyAutoComplete.prototype._elShadow=null,juic.SFLegacyAutoComplete.prototype._elIFrame=null,juic.SFLegacyAutoComplete.prototype._bFocused=!1,juic.SFLegacyAutoComplete.prototype._oAnim=null,juic.SFLegacyAutoComplete.prototype._bContainerOpen=!1,juic.SFLegacyAutoComplete.prototype._bOverContainer=!1,juic.SFLegacyAutoComplete.prototype._elList=null,juic.SFLegacyAutoComplete.prototype._nDisplayedItems=0,juic.SFLegacyAutoComplete.prototype._sCurQuery=null,juic.SFLegacyAutoComplete.prototype._sPastSelections="",juic.SFLegacyAutoComplete.prototype._sInitInputValue=null,juic.SFLegacyAutoComplete.prototype._elCurListItem=null,juic.SFLegacyAutoComplete.prototype._elCurPrehighlightItem=null,juic.SFLegacyAutoComplete.prototype._bItemSelected=!1,juic.SFLegacyAutoComplete.prototype._nKeyCode=null,juic.SFLegacyAutoComplete.prototype._nDelayID=-1,juic.SFLegacyAutoComplete.prototype._nTypeAheadDelayID=-1,juic.SFLegacyAutoComplete.prototype._iFrameSrc="javascript:false;",juic.SFLegacyAutoComplete.prototype._queryInterval=null,juic.SFLegacyAutoComplete.prototype._sLastTextboxValue=null,juic.SFLegacyAutoComplete.prototype._initProps=function(){var e=this.minQueryLength;"number"==typeof e&&isFinite(e)||(this.minQueryLength=1);var t=this.maxResultsDisplayed;("number"!=typeof t||!isFinite(t)||1>t)&&(this.maxResultsDisplayed=10);var o=this.queryDelay;("number"!=typeof o||!isFinite(o)||0>o)&&(this.queryDelay=.2);var n=this.typeAheadDelay;("number"!=typeof n||!isFinite(n)||0>n)&&(this.typeAheadDelay=.2);var a=this.delimChar;"string"==typeof a&&0<a.length?this.delimChar=[a]:!Array.isArray(a)&&(this.delimChar=null);var l=this.animSpeed;(this.animHoriz||this.animVert)&&("number"!=typeof l||!isFinite(l)||0>l)&&(this.animSpeed=.3)},juic.SFLegacyAutoComplete.prototype._initA11yAnnouncement=function(){if(!document.getElementById(this.a11yHiddenTextId)){var e=document.createElement("div");e.setAttribute("id",this.a11yHiddenTextId),e.setAttribute("style","position: absolute; height: 1px; width: 1px; overflow: hidden; clip: rect(1px, 1px, 1px, 1px);"),e.setAttribute("aria-live","polite"),document.body.appendChild(e)}},juic.SFLegacyAutoComplete.prototype._resetA11yAnnoucement=function(){var e=document.getElementById(this.a11yHiddenTextId);e&&(e.innerText="")},juic.SFLegacyAutoComplete.prototype._initContainerHelperEls=function(){if(this.useShadow&&!this._elShadow){var e=document.createElement("div");e.className="yui-ac-shadow",e.style.width=0,e.style.height=0,this._elShadow=this._elContainer.appendChild(e)}if(this.useIFrame&&!this._elIFrame){var t=document.createElement("iframe");t.src=this._iFrameSrc,t.frameBorder=0,t.scrolling="no",t.style.position="absolute",t.style.width=0,t.style.height=0,t.style.padding=0,t.tabIndex=-1,t.role="presentation",t.title="Presentational iframe shim",this._elIFrame=this._elContainer.appendChild(t)}},juic.SFLegacyAutoComplete.prototype._initContainerEl=function(){if(SFDom.addClass(this._elContainer,"yui-ac-container"),!this._elContent){var e=document.createElement("div");e.className="yui-ac-content",e.style.display="none",this._elContent=this._elContainer.appendChild(e);var t=document.createElement("div");t.className="yui-ac-hd",t.style.display="none",this._elHeader=this._elContent.appendChild(t);var o=document.createElement("div");o.className="yui-ac-bd",this._elBody=this._elContent.appendChild(o);var n=document.createElement("div");n.className="yui-ac-ft",n.style.display="none",this._elFooter=this._elContent.appendChild(n)}},juic.SFLegacyAutoComplete.prototype._initListEl=function(){var e,t=this.maxResultsDisplayed,o=this._elList||document.createElement("ul");for(o.setAttribute("role","listbox");o.childNodes.length<t;)e=document.createElement("li"),e.style.display="none",e.setAttribute("tabIndex",-1),e.setAttribute("role","option"),e.setAttribute("id","YUIListItem"+o.childNodes.length),e.setAttribute("aria-selected",!1),e._nItemIndex=o.childNodes.length,o.appendChild(e);if(!this._elList){var n=this._elBody;SFLegacyEvent.purgeElement(n,!0),n.innerHTML="",this._elList=n.appendChild(o)}this._elBody.style.display=""},juic.SFLegacyAutoComplete.prototype._focus=function(){var e=this;setTimeout(function(){try{e._elTextbox.focus()}catch(t){}},0)},juic.SFLegacyAutoComplete.prototype._enableIntervalDetection=function(){var e=this;!e._queryInterval&&e.queryInterval&&(e._queryInterval=setInterval(function(){e._onInterval()},e.queryInterval))},juic.SFLegacyAutoComplete.prototype.enableIntervalDetection=juic.SFLegacyAutoComplete.prototype._enableIntervalDetection,juic.SFLegacyAutoComplete.prototype._onInterval=function(){var e=this._elTextbox.value,t=this._sLastTextboxValue;e!=t&&(this._sLastTextboxValue=e,this._sendQuery(e))},juic.SFLegacyAutoComplete.prototype._clearInterval=function(){this._queryInterval&&(clearInterval(this._queryInterval),this._queryInterval=null)},juic.SFLegacyAutoComplete.prototype._isIgnoreKey=function(e){return!!(9==e||13==e||16==e||17==e||18<=e&&20>=e||27==e||33<=e&&35>=e||36<=e&&40>=e||44<=e&&45>=e||229==e)},juic.SFLegacyAutoComplete.prototype._sendQuery=function(e){if(0>this.minQueryLength)return void this._toggleContainer(!1);if(this.delimChar){var t=this._extractQuery(e);e=t.query,this._sPastSelections=t.previous}if(e&&e.length<this.minQueryLength||!e&&0<this.minQueryLength)return-1!=this._nDelayID&&clearTimeout(this._nDelayID),void this._toggleContainer(!1);if(e=encodeURIComponent(e),this._nDelayID=-1,this.dataSource.queryMatchSubset||this.queryMatchSubset){var o=this.getSubsetMatches(e);if(o)return void this.handleResponse(e,o,{query:e})}this.dataSource.responseStripAfter&&(this.dataSource.doBeforeParseData=this.preparseRawResponse),this.applyLocalFilter&&(this.dataSource.doBeforeCallback=this.filterResults);var n=this.generateRequest(e);void 0===n?this.dataRequestCancelEvent.fire(this,e):(this.dataRequestEvent.fire(this,e,n),this.dataSource.sendRequest(n,{success:this.handleResponse,failure:this.handleResponse,scope:this,argument:{query:e}}))},juic.SFLegacyAutoComplete.prototype._populateListItem=function(e,t,o){e.innerHTML=this.formatResult(t,o,e._sResultMatch)},juic.SFLegacyAutoComplete.prototype._populateList=function(e,t,o){var n=Math.min;-1!=this._nTypeAheadDelayID&&clearTimeout(this._nTypeAheadDelayID),e=o&&o.query?o.query:e;var a=this.doBeforeLoadData(e,t,o);if(!a||t.error)this.dataErrorEvent.fire(this,e,t);else if(this.dataReturnEvent.fire(this,e,t.results),this._bFocused){var l=decodeURIComponent(e);this._sCurQuery=l,this._bItemSelected=!1;var r=t.results,p=n(r.length,this.maxResultsDisplayed),s=this.dataSource.responseSchema.fields?this.dataSource.responseSchema.fields[0].key||this.dataSource.responseSchema.fields[0]:0;if(0<p){var u=document.getElementById(this.a11yHiddenTextId);u&&setTimeout(function(){var e=r.length;u.innerText=1===e?MSGS.get("COMMON_Results_Singular"):MSGS.get("COMMON_Results",e)},300),(!this._elList||this._elList.childNodes.length<p)&&this._initListEl(),this._initContainerHelperEls();for(var y=this._elList.childNodes,d=p-1;0<=d;d--){var c=y[d],g=r[d];if(this.resultTypeList){var m=[];m[0]="string"==typeof g?g:g[s]||g[this.key];var C=this.dataSource.responseSchema.fields;if(Array.isArray(C)&&1<C.length)for(var _=1,h=C.length;_<h;_++)m[m.length]=g[C[_].key||C[_]];else Array.isArray(g)?m=g:"string"==typeof g?m=[g]:m[1]=g;g=m}c._sResultMatch="string"==typeof g?g:Array.isArray(g)?g[0]:g[s]||"",c._oResultData=g,this._populateListItem(c,g,l),c.style.display=""}if(p<y.length)for(var S,L=y.length-1;L>=p;L--)S=y[L],S.style.display="none";if(this._nDisplayedItems=p,this.containerPopulateEvent.fire(this,e,r),this.autoHighlight){var A=this._elList.firstChild;this._toggleHighlight(A,"to"),this.itemArrowToEvent.fire(this,A),this._typeAhead(A,e)}else this._toggleHighlight(this._elCurListItem,"from");a=this._doBeforeExpandContainer(this._elTextbox,this._elContainer,e,r),this._toggleContainer(a)}else this._toggleContainer(!1)}},juic.SFLegacyAutoComplete.prototype._doBeforeExpandContainer=function(e,t,o,n){return this.autoSnapContainer&&this.snapContainer(),this.doBeforeExpandContainer(e,t,o,n)},juic.SFLegacyAutoComplete.prototype._clearSelection=function(){var e=this.delimChar?this._extractQuery(this._elTextbox.value):{previous:"",query:this._elTextbox.value};this._elTextbox.value=e.previous,this.selectionEnforceEvent.fire(this,e.query)},juic.SFLegacyAutoComplete.prototype._textMatchesOption=function(){for(var e=null,t=0;t<this._nDisplayedItems;t++){var o=this._elList.childNodes[t],n=(""+o._sResultMatch).toLowerCase();if(n==this._sCurQuery.toLowerCase()){e=o;break}}return e},juic.SFLegacyAutoComplete.prototype._typeAhead=function(e,t){if(this.typeAhead&&8!=this._nKeyCode){var o=this,n=this._elTextbox;(n.setSelectionRange||n.createTextRange)&&(this._nTypeAheadDelayID=setTimeout(function(){var a=n.value.length;o._updateValue(e);var l=n.value.length;o._selectText(n,a,l);var r=n.value.substr(a,l);o._sCurQuery=e._sResultMatch,o.typeAheadEvent.fire(o,t,r)},1e3*this.typeAheadDelay))}},juic.SFLegacyAutoComplete.prototype._selectText=function(e,t,o){if(e.setSelectionRange)e.setSelectionRange(t,o);else if(e.createTextRange){var n=e.createTextRange();n.moveStart("character",t),n.moveEnd("character",o-e.value.length),n.select()}else e.select()},juic.SFLegacyAutoComplete.prototype._extractQuery=function(e){for(var t,o,n,a=this.delimChar,l=-1,r=a.length-1;0<=r;r--)t=e.lastIndexOf(a[r]),t>l&&(l=t);if(" "==a[r])for(var p=a.length-1;0<=p;p--)if(e[l-1]==a[p]){l--;break}if(-1<l){for(o=l+1;" "==e.charAt(o);)o+=1;n=e.substring(0,o),e=e.substr(o)}else n="";return{previous:n,query:e}},juic.SFLegacyAutoComplete.prototype._toggleContainerHelpers=function(e){var t=this._elContent.offsetWidth+"px",o=this._elContent.offsetHeight+"px";if(this.useIFrame&&this._elIFrame){var n=this._elIFrame;e?(n.style.width=t,n.style.height=o,n.style.padding=""):(n.style.width=0,n.style.height=0,n.style.padding=0)}if(this.useShadow&&this._elShadow){var a=this._elShadow;e?(a.style.width=t,a.style.height=o):(a.style.width=0,a.style.height=0)}},juic.SFLegacyAutoComplete.prototype._toggleContainer=function(e){var t=this._elContainer;if(!(this.alwaysShowContainer&&this._bContainerOpen)&&(e||(this._toggleHighlight(this._elCurListItem,"from"),this._nDisplayedItems=0,this._sCurQuery=null,"none"!=this._elContent.style.display))){if(this._elContent&&(this.animHoriz||this.animVert)){var o=this._elContent.cloneNode(!0);t.appendChild(o),o.style.top="-9000px",o.style.width="",o.style.height="",o.style.display="";var n=o.offsetWidth,a=o.offsetHeight,l=this.animHoriz?0:n,r=this.animVert?0:a,p=e?{width:{to:n},height:{to:a}}:{width:{to:l},height:{to:r}};e&&!this._bContainerOpen?(this._elContent.style.width=l+"px",this._elContent.style.height=r+"px"):(this._elContent.style.width=n+"px",this._elContent.style.height=a+"px"),t.removeChild(o),o=null;var i=this,s=function(){e?(i._toggleContainerHelpers(!0),i._bContainerOpen=e,i.containerExpandEvent.fire(i)):(this._resetA11yAnnoucement(),i._elContent.style.display="none",i._bContainerOpen=e,i.containerCollapseEvent.fire(i))};this._toggleContainerHelpers(!1),this._elContent.style.display="",SFAnimUtil.animate(this._elContent,p,{duration:this.animSpeed,complete:s})}else e?(this._elContent.style.display="",this._toggleContainerHelpers(!0),this._bContainerOpen=e,this.containerExpandEvent.fire(this)):(this._toggleContainerHelpers(!1),this._elContent.style.display="none",this._bContainerOpen=e,this.containerCollapseEvent.fire(this));this._elTextbox.setAttribute("aria-expanded",this._bContainerOpen)}},juic.SFLegacyAutoComplete.prototype._toggleHighlight=function(e,t){if(e){var o=this.highlightClassName,n="is-selected";this._elCurListItem&&(SFDom.removeClass(this._elCurListItem,o),SFDom.removeClass(this._elCurListItem,n),this._elCurListItem=null,this._elTextbox.removeAttribute("aria-activedescendant")),"to"==t&&o&&(SFDom.addClass(e,o),SFDom.addClass(e,n),this._elCurListItem=e,this._elTextbox.setAttribute("aria-activedescendant",e.id))}},juic.SFLegacyAutoComplete.prototype._togglePrehighlight=function(e,t){var o=this.prehighlightClassName;this._elCurPrehighlightItem&&SFDom.removeClass(this._elCurPrehighlightItem,o);e==this._elCurListItem||("mouseover"==t&&o?(SFDom.addClass(e,o),this._elCurPrehighlightItem=e):SFDom.removeClass(e,o))},juic.SFLegacyAutoComplete.prototype._updateValue=function(e){if(!this.suppressInputUpdate){var t=this._elTextbox,o=this.delimChar?this.delimChar[0]||this.delimChar:null,n=e._sResultMatch,a="";o?(a=this._sPastSelections,a+=n+o," "!=o&&(a+=" ")):a=n,t.value=a,"textarea"==t.type&&(t.scrollTop=t.scrollHeight);var l=t.value.length;this._selectText(t,l,l),this._elCurListItem=e}},juic.SFLegacyAutoComplete.prototype._selectItem=function(e){this._bItemSelected=!0,this._updateValue(e),this._sPastSelections=this._elTextbox.value,this._clearInterval(),this.itemSelectEvent.fire(this,e,e._oResultData),this._toggleContainer(!1)},juic.SFLegacyAutoComplete.prototype._jumpSelection=function(){this._elCurListItem?this._selectItem(this._elCurListItem):this._toggleContainer(!1)},juic.SFLegacyAutoComplete.prototype._moveSelection=function(e){if(this._bContainerOpen){var t=this._elCurListItem,o=-1;t&&(o=t._nItemIndex);var n=40==e?o+1:o-1;if(-2>n||n>=this._nDisplayedItems)return;if(t&&(this._toggleHighlight(t,"from"),this.itemArrowFromEvent.fire(this,t)),-1==n)return void(this._elTextbox.value=this.delimChar?this._sPastSelections+this._sCurQuery:this._sCurQuery);if(-2==n)return void this._toggleContainer(!1);var a=this._elList.childNodes[n],l=this._elContent,r=SFDom.getStyle(l,"overflow"),p=SFDom.getStyle(l,"overflowY");("auto"==r||"scroll"==r||"auto"==p||"scroll"==p)&&-1<n&&n<this._nDisplayedItems&&(40==e?a.offsetTop+a.offsetHeight>l.scrollTop+l.offsetHeight?l.scrollTop=a.offsetTop+a.offsetHeight-l.offsetHeight:a.offsetTop+a.offsetHeight<l.scrollTop&&(l.scrollTop=a.offsetTop):a.offsetTop<l.scrollTop?this._elContent.scrollTop=a.offsetTop:a.offsetTop>l.scrollTop+l.offsetHeight&&(this._elContent.scrollTop=a.offsetTop+a.offsetHeight-l.offsetHeight)),this._toggleHighlight(a,"to"),this.itemArrowToEvent.fire(this,a),this.typeAhead&&(this._updateValue(a),this._sCurQuery=a._sResultMatch)}},juic.SFLegacyAutoComplete.prototype._onContainerMouseover=function(e,t){for(var o=SFDOMEvent.getTarget(e),n=o.nodeName.toLowerCase();o&&"table"!=n;){switch(n){case"body":return;case"li":t.prehighlightClassName?t._togglePrehighlight(o,"mouseover"):t._toggleHighlight(o,"to"),t.itemMouseOverEvent.fire(t,o);break;case"div":if(SFDom.hasClass(o,"yui-ac-container"))return void(t._bOverContainer=!0);break;default:}o=o.parentNode,o&&(n=o.nodeName.toLowerCase())}},juic.SFLegacyAutoComplete.prototype._onContainerMouseout=function(e,t){for(var o=SFDOMEvent.getTarget(e),n=o.nodeName.toLowerCase();o&&"table"!=n;){switch(n){case"body":return;case"li":t.prehighlightClassName?t._togglePrehighlight(o,"mouseout"):t._toggleHighlight(o,"from"),t.itemMouseOutEvent.fire(t,o);break;case"ul":t._toggleHighlight(t._elCurListItem,"to");break;case"div":if(SFDom.hasClass(o,"yui-ac-container"))return void(t._bOverContainer=!1);break;default:}o=o.parentNode,o&&(n=o.nodeName.toLowerCase())}},juic.SFLegacyAutoComplete.prototype._onContainerClick=function(e,t){for(var o=SFDOMEvent.getTarget(e),n=o.nodeName.toLowerCase();o&&"table"!=n;){switch(n){case"body":return;case"li":return t._toggleHighlight(o,"to"),void t._selectItem(o);default:}o=o.parentNode,o&&(n=o.nodeName.toLowerCase())}},juic.SFLegacyAutoComplete.prototype._onContainerScroll=function(e,t){t._focus()},juic.SFLegacyAutoComplete.prototype._onContainerResize=function(e,t){t._toggleContainerHelpers(t._bContainerOpen)},juic.SFLegacyAutoComplete.prototype._onTextboxKeyDown=function(e,t){var o=e.keyCode;switch(-1!=t._nTypeAheadDelayID&&clearTimeout(t._nTypeAheadDelayID),o){case 9:(juic.legacyUtil.isOpera||juic.legacyUtil.isMac)&&!(420<juic.legacyUtil.webkit)||(t._elCurListItem?(t.delimChar&&t._nKeyCode!=o&&t._bContainerOpen&&SFDOMEvent.stopEvent(e),t._selectItem(t._elCurListItem)):t._toggleContainer(!1));break;case 13:(juic.legacyUtil.isOpera||juic.legacyUtil.isMac)&&!(420<juic.legacyUtil.webkit)||(t._elCurListItem?(t._nKeyCode!=o&&t._bContainerOpen&&SFDOMEvent.stopEvent(e),t._selectItem(t._elCurListItem)):t._toggleContainer(!1));break;case 27:return void t._toggleContainer(!1);case 39:t._jumpSelection();break;case 38:t._bContainerOpen&&(SFDOMEvent.stopEvent(e),t._moveSelection(o));break;case 40:t._bContainerOpen&&(SFDOMEvent.stopEvent(e),t._moveSelection(o));break;default:t._bItemSelected=!1,t._toggleHighlight(t._elCurListItem,"from"),t.textboxKeyEvent.fire(t,o);}18===o&&t._enableIntervalDetection(),t._nKeyCode=o},juic.SFLegacyAutoComplete.prototype._onTextboxKeyPress=function(e,t){var o=e.keyCode;if(juic.legacyUtil.isOpera||juic.legacyUtil.isMac&&420>juic.legacyUtil.webkit)switch(o){case 9:t._bContainerOpen&&(t.delimChar&&SFDOMEvent.stopEvent(e),t._elCurListItem?t._selectItem(t._elCurListItem):t._toggleContainer(!1));break;case 13:t._bContainerOpen&&(SFDOMEvent.stopEvent(e),t._elCurListItem?t._selectItem(t._elCurListItem):t._toggleContainer(!1));break;default:}else 229==o&&t._enableIntervalDetection()},juic.SFLegacyAutoComplete.prototype._onTextboxKeyUp=function(e,t){var o=this.value;t._initProps();var n=e.keyCode;t._isIgnoreKey(n)||(-1!=t._nDelayID&&clearTimeout(t._nDelayID),t._nDelayID=setTimeout(function(){t._sendQuery(o)},1e3*t.queryDelay))},juic.SFLegacyAutoComplete.prototype._onTextboxFocus=function(e,t){t._bFocused||(t._elTextbox.setAttribute("autocomplete","off"),t._bFocused=!0,t._sInitInputValue=t._elTextbox.value,t.textboxFocusEvent.fire(t))},juic.SFLegacyAutoComplete.prototype._onTextboxBlur=function(e,t){if(!t._bOverContainer||9==t._nKeyCode){if(!t._bItemSelected){var o=t._textMatchesOption();!t._bContainerOpen||t._bContainerOpen&&null===o?t.forceSelection?t._clearSelection():t.unmatchedItemSelectEvent.fire(t,t._sCurQuery):t.forceSelection&&t._selectItem(o)}t._clearInterval(),t._bFocused=!1,t._sInitInputValue!==t._elTextbox.value&&t.textboxChangeEvent.fire(t),t.textboxBlurEvent.fire(t),t._toggleContainer(!1)}else t._focus()},juic.SFLegacyAutoComplete.prototype._onWindowUnload=function(e,t){t&&t._elTextbox&&t.allowBrowserAutocomplete&&t._elTextbox.setAttribute("autocomplete","on")},juic.SFLegacyAutoComplete.prototype.doBeforeSendQuery=function(e){return this.generateRequest(e)},juic.SFLegacyAutoComplete.prototype.getListItems=function(){for(var e=[],t=this._elList.childNodes,o=t.length-1;0<=o;o--)e[o]=t[o];return e},juic.SFLegacyAutoComplete._cloneObject=function(e){if(!Util.isValue(e))return e;var t={};if("function"==typeof e)t=e;else if(Array.isArray(e)){for(var o=[],n=0,a=e.length;n<a;n++)o[n]=juic.SFLegacyAutoComplete._cloneObject(e[n]);t=o}else if(e&&("object"==typeof e||"function"==typeof e)){for(var l in e)if(e&&e.hasOwnProperty&&e.hasOwnProperty(l)){var r=e[l];t[l]=r&&("object"==typeof r||"function"==typeof r)||Array.isArray(r)?juic.SFLegacyAutoComplete._cloneObject(r):r}}else t=e;return t},juic.SFLegacyAutoComplete.prototype.__onTextboxKeyDown=juic.SFLegacyAutoComplete.prototype._onTextboxKeyDown,juic.SFLegacyAutoComplete.prototype._onTextboxKeyDown=function(e){16!=e.keyCode&&17!=e.keyCode&&18!=e.keyCode&&juic.SFLegacyAutoComplete.prototype.__onTextboxKeyDown.apply(this,arguments)};