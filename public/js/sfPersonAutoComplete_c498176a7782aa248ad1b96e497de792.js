function SFPersonAutoComplete(a){this._init(new juic.Config(a,this.DEFAULTS,this.VALIDATION)),this.register()}(function(){function a(a,b,c){this._config=c,this._photos={},this._super(a,b)}function b(a){this._config=a}var c="EMPLOYMENT",d={profile:Util.isFioriFDEnabled()?"CIRCLE_S":"SQUARE_50"},e=juic.Logger.getLogger("SFPersonAutocomplete");SFPersonAutoComplete.EXTERNAL_REGISTRY={},juic.extend(SFPersonAutoComplete,SFComboBox,{DEFAULTS:{autoCompleteConfig:{},additionalCriteria:{},searchControllerName:"quickcardController",searchControllerMethod:"searchPersonAutocomplete",dependency:[],isV12Plus:!0,forceSelection:!1,clearValueWhenDelete:!0,maxInputLength:100,searchKeys:[]},VALIDATION:{source:["string",null]},setAdditionalCriteria:function(a){this._config.additionalCriteria=a},appendAdditionalCriteria:function(a){var b=this._config.additionalCriteria;return this._config.additionalCriteria=juic.set(b||{},a||{}),b},_init:function(a){this._config=a,this._super(null,new b(a),juic.set({minimumFilterSize:a.minimumFilterSize||this.getDefaultMinimumFilterSize(),isV12Plus:a.isV12Plus,fetchPagesInOrder:!0},this._config))},_createListSelect:function(b,c){return c.mutatorClass="personACList",c.itemFocusClass="globalMenuItemFocus",new a(b,c,this._config)},_getAriaOwns:function(){return this._listSelect.id},_isToggleRendered:function(){return!1},attachExternal:function(a){return SFPersonAutoComplete.EXTERNAL_REGISTRY[a.displayFieldId]=this,this._super(a)},getPersonList:function(b,c,d){return new a(b,c,d)},getItemProvider:function(a){return new b(a)}});juic.extend(a,SFComboListSelect,{cleanup:function(){for(var a in this._photos)this._photos[a].cleanup();this._super()},_renderPageContent:function(a,b,c){if(0==b&&0==c.length)this.isFioriFDEnabled()&&a.push("<div class=\"",this.generateFDClasses("list",["byline"]),"\">"),a.push("<div role=\"alert\" class=\"no-results globalMenuItem ",this.generateFDClasses("list__item",["interractive"]),"\" unselectable=\"on\" onselectstart=\"return false\">"),a.push(this._config.noResultsMessage||MSGS.COMMON_No_Results),a.push("</div>"),this.isFioriFDEnabled()&&a.push("</div>");else{a.push("<div role=\"menu\" class=\"",this.generateFDClasses("list",["byline"]),"\">");for(var d=0,e=c.length;d<e;d++){var f=c[d],g=0<b?this._lastItemIndex+1:d;this._renderItem(a,f,g,b),this._lastItemIndex=g}a.push("</div>")}},_renderItem:function(a,b,c,d){var e=b.employments&&b.employments[0],f=b.hasEmploymentDifferentiatorText;if((!b.subItem||b.firstSubItem)&&a.push("<div class=\"personACWrapper\">"),b.subItem||this._renderItemStart(a,b,c,"personACEmployment personACItem noSubItems "+this.generateFDClasses("list__item",["interractive"]),e,f,d),b.firstSubItem&&a.push("<div class=\"personACItem hasSubItems\">"),b.firstSubItem||!b.subItem){var g=this._getUserPhoto(b);g&&a.push(g);var h=juic.escapeHTML(b.name).replace(new RegExp("("+RegExp.escape(juic.escapeHTML(this._filterValue))+")","i"),"<em>$1</em>"),i=this.isHideUserName()?null:b.userName;if(i){var j=juic.escapeHTML(i).replace(new RegExp("("+RegExp.escape(juic.escapeHTML(this._filterValue))+")","i"),"<em>$1</em>");h=MSGS.get("COMMON_User_Display_Name_With_Username_Format",h,j)}a.push("<div class=\"employmentDetails ",this.generateFDClasses("list__start-container")," ",g?" hasPhoto":"","\">"),a.push("<div class=\"empName ",this.generateFDClasses("list__title"),"\">",h,"</div>")}if(b.subItem&&this._renderItemStart(a,b,c,"personACEmployment "+this.generateFDClasses("list__item",["interractive"]),e,f,d),a.push("<div class=\"empTitleWrapper ",this.generateFDClasses("list__byline"),"\">"),e){var k=e.title,l=e.locationName;this.isEmpty(k)||this.isEmpty(l)?this.isEmpty(k)&&(this.isEmpty(l)?k=this.displayEmptyWhenOneEmployment(b,MSGS.get("COMMON_Person_AutoComplete_Alternate_Employment")):k=l):k=MSGS.get("COMMON_Person_AutoComplete_Title_And_Location",k,l),k=this.filterInvalidText(k);var m=this._setDisplayTitleCss(k),n="";if(this._isActive(e)||(n=" <span class=\""+m+"\">"+MSGS.get("COMMON_PARENTHETICAL_PHRASE",MSGS.COMMON_InActive)+"</span>"),f){var o=e.employmentDifferentiatorText;a.push("<span class=\"empDiffAutoCompleteSearch\">",juic.escapeHTML(o),n,"</span>"),a.push("<span>"),b.showIcon&&this._renderIcon(a,e),a.push("</span>")}else a.push("<span class=\"empTitle\">",juic.escapeHTML(k),n,"</span>"),b.showIcon&&this._renderIcon(a,e)}var p="",q="",r="",s=this.getResultScope();s=="PERSON"?"Y"==b.isContingentWorkerString?r="Y":"?"==b.isContingentWorkerString&&(r="?"):"EMPLOYMENT"==s&&("Y"==e.isContigentWorker?r="Y":"?"==e.isContigentWorker&&(r="?")),"?"==r&&(q=MSGS.COMMON_Contingent_Worker_No_Permission_Info,p=" <span title=\""+q+"\" class=\"contingentNoAuthIcon contingentNoAuth\"",a.push(p),a.push("></span>")),"Y"==r&&(p="<span class=\"contingent-worker-display\">"+MSGS.COMMON_Contingent_Worker+"</span>",a.push("</div>"),a.push("<div>"),a.push(p)),a.push("</div>"),b.subItem||a.push("</div>"),a.push("</a>"),b.lastSubItem&&a.push("</div></div>"),(!b.subItem||b.lastSubItem)&&a.push("</div>")},isEmpty:function(a){return null==a||""===a},filterInvalidText:function(a){return"N/A"===a||"No Data"===a?MSGS.get("COMMON_Person_AutoComplete_Alternate_Employment"):a},displayEmptyWhenOneEmployment:function(a,b){return a.firstSubItem||a.subItem?b:""},_renderIcon:function(a,b){var c=b.employmentTypeStr;if(Util.isRTL()&&a.push("&#8207;"),"ST"===c||"CE"===c){var d=b.isPrimaryEmployment;(!0===d||"true"===d)&&a.push("<span aria-label=\"",MSGS.ECT_PRIMARY_ASSIGNMENT_TOOLTIP,"\" class=\"empTypeIcon primaryEmploymentIcon\"></span>")}var e=b.isHomeAssignment;!0===e||"true"===e?a.push("<span aria-label=\"",MSGS.EMPLOYMENT_GO_TemporaryAssignmentInfo_homeAssignment,"\" class=\"empTypeIcon homeAssignmentIcon\"></span>"):"GA"===c&&(!1===e||"false"===e)&&a.push("<span aria-label=\"",MSGS.ECT_ASSIGNMENT_TYPE_GLOBAL_ASSIGNMENT,"\" class=\"empTypeIcon globalAssignmentIcon\"></span>"),Util.isRTL()&&a.push("&#8207;")},_renderItemStart:function(a,b,c,d,e,f,g){var h=e?MSGS.get("COMMON_Person_AutoComplete_Title_And_Location",b.name,e.title):b.name;if(f&&(h=e.employmentDifferentiatorText),e){var i=e.employmentTypeStr;if("ST"===i||"CE"===i){var j=e.isPrimaryEmployment;(!0===j||"true"===j)&&(h+=" "+MSGS.ECT_PRIMARY_ASSIGNMENT_TOOLTIP)}if("GA"===i){var k=e.isHomeAssignment;(!0===k||"true"===k)&&(h+=" "+MSGS.EMPLOYMENT_GO_TemporaryAssignmentInfo_homeAssignment),(!1===k||"false"===k)&&(h+=" "+MSGS.ECT_ASSIGNMENT_TYPE_GLOBAL_ASSIGNMENT)}}a.push("<a id=\"",this._getItemDomId(c),"\" class=\"globalMenuItem ",d),this._focusIndex==c&&a.push(" ",this._getFocusClass());var l=this._pageStatus[g];l&&(a.push("\" aria-setsize=\"",l.itemCount),a.push("\" aria-posinset=\"",c+1)),a.push("\" onmouseover=\"",this.fireCode("_mouseover",c)),a.push("\" onmouseout=\"",this.fireCode("_mouseout",c)),a.push("\" ontouchstart=\"",this.fireCode("_touchstart",c)),a.push("\" ontouchend=\"",this.fireCode("_touchend",c)),a.push("\" onclick=\"",this.fireCode("_selectItem",c)),a.push("\" role=\"menuitem\">")},_isActive:function(a){return!(a&&"undefined"!=typeof a.isActive)||JSON.parse(a.isActive)},_setDisplayTitleCss:function(a){var b="empTitle";return a||(b+=" empInactive"),b},_getUserPhoto:function(a){if(!this._hasPhoto())return null;var b=a.photoViewable?a.photoSrc:IMAGES["/ui/uicore/img/photoNotAvailable.gif"],c=window.pageHeaderJsonData,e=c&&c.settings,f=e&&"true"==e.encryptUserIdInURLEnabled,g=f?a.userIdEncoded:a.photoUserId;if(!b&&g){var h={urlType:SFPhoto.URL_TYPE_EDU,photoAction:"show",photoType:"quickCard"};f?h.userIdEncoded=a.userIdEncoded:h.userId=a.photoUserId,a.photoMod?h.mod=a.photoMod:a.photoId&&a.photoLastModified&&(h.mod=SFPhoto.getPhotoMod(a.photoId,a.photoLastModified)),b=SFPhoto.url(h)}if(b){var i=g+","+b,j=this._photos[i];return j||(j=this._photos[i]=new SFPhoto({userid:g,photoSrc:b,fullName:a.name},d)),j}return null},isHideUserName:function(){if("undefined"==typeof this._hideUserName){var a=juic.$("autocomplete.hideUserName");this._hideUserName=a&&"true"===a.getAttribute("content")}return this._hideUserName},isPhotoEnabled:function(){if("undefined"==typeof this._photoEnabled){var a=juic.$("autocomplete.enablePhoto");this._photoEnabled=!a||"true"===a.getAttribute("content")}return this._photoEnabled},_hasPhoto:function(){return this.isPhotoEnabled()},scrollToItem:function(a){var b=juic.$(this.id),c=juic.$(this._getItemDomId(a));if(b&&c){var d=SFDom.getY(b),e=d-SFDom.getY(c),f=SFDom.getY(c)+c.offsetHeight-d-b.offsetHeight;0<e?b.scrollTop-=e:0<f&&(b.scrollTop+=f)}},moveFocusUp:function(){var a=this._focusIndex,b=a;for(this._super();this._focusIndex!=b&&!this.isValidFocusableIndex(this._focusIndex);)b=this._focusIndex,this._super();this.isValidFocusableIndex(this._focusIndex)||this.changeItemFocus(a)},moveFocusDown:function(){var a=this._focusIndex,b=a;for(this._super();this._focusIndex!=b&&!this.isValidFocusableIndex(this._focusIndex);)b=this._focusIndex,this._super();this.isValidFocusableIndex(this._focusIndex)||this.changeItemFocus(a)},isValidFocusableIndex:function(a){var b=this._cachedItems&&this._cachedItems[a];return"EMPLOYMENT"==this.getResultScope()?b&&b.employments&&0<b.employments.length:b},getResultScope:function(){var a=this._config.additionalCriteria||{};return(a.resultScope||c).toUpperCase()}}),juic.extend(b,SFAbstractItemProvider,{hasMore:function(a){var b=a.event;if(b&&"boolean"==typeof b.hasMore)return b.hasMore;var c=a.items;if(c&&0<c.length){for(var d,e,f=0;f<c.length;f++)e=c[f].personId,d!==e&&(this._iTotalPersons++,d=e);return this._iTotalPersons<a.itemCount}return!1},getLabel:function(a){if(a){var b=a.name||"",c=a.employments&&a.employments[0]&&a.employments[0].title;return a.hasEmploymentDifferentiatorText&&(c=a.employments[0].employmentDifferentiatorText),c?MSGS.get("COMMON_Person_AutoComplete_Title_And_Location",b,c):b}return""},viewedItemsMap:{},getItems:function(a){1==a.pageNumber&&(this._iTotalPersons=0);var b=this,c=this._config.searchControllerName,d=this._config.searchControllerMethod,f=this._searchController=this._searchController||AjaxService2.getMBeanInstance(c);(function(){if(f&&(f[d]||f.request)){var g=b._createCriteria(a),h=4,i=g.searchValue.trim().split(" ");i.length>h&&(g.searchValue=i.slice(0,h).join(" "),e.info("sfPersonAutoComplete search limited to 4 separate terms"));var j={errorHandler:function(c,d){e.error("Error calling controller: ",c,d),b.dispatch("itemsError",{pagination:a,message:c})},callback:function(c){b.dispatch("itemsAvailable",{items:function(){return 1==a.pageNumber&&(b.viewedItemsMap={}),b._flattenEmployments(c)}(),itemCount:c.totalCount,hasMore:c.hasMore,pagination:a})}};f[d]?f[d](g,j):f.request(d,g,j)}else b.dispatch("itemsError",{pagination:a,message:"Invalid controller: "+c+"."+d})})()},_flattenEmployments:function(a){for(var b,c=Array.prototype.slice.apply(a.items),d=c.length-1;0<=d;d--){if(b=c[d],this.viewedItemsMap[b.userId]){c.splice(d,1);continue}if(this.viewedItemsMap[b.userId]=1,b.photoUserId=b.photoUserId||b.userId,b.showIcon=this._showIcon(b.employments),b.employments&&1<b.employments.length){var e=b.employments.splice(1,b.employments.length-1);b.firstSubItem=!0,b.subItem=!0,b.primaryEmploymentUserId=b.userId,b.userId=b.employments[0].userId;for(var f=0;f<e.length;f++){var g=e[f],h=juic.set({},b);h.employments=[g],h.userId=g.userId,c.splice(d+f+1,0,juic.set(h,{firstSubItem:!1,lastSubItem:f==e.length-1}))}}else b.employments&&0!=b.employments.length?"EMPLOYMENT"==this.getResultScope()&&(b.userId=b.employments[0].userId):"EMPLOYMENT"==this.getResultScope()&&(b.subItem=!0,b.firstSubItem=!0,b.lastSubItem=!0)}return c},_showIcon:function(a){return a&&1<a.length},getResultScope:function(){var a=this._config.additionalCriteria||{};return(a.resultScope||c).toUpperCase()},_getSearchController:function(){var a=this._searchController;return a||(a=AjaxService.getMBeanInstance(controllerName),this._searchController=a),a},_createCriteria:function(a){return juic.set({searchValue:a.filterValue||"",keys:this._config.searchKeys,page:a.pageNumber,maxresults:a.pageSize,source:this._config.source},this._config.additionalCriteria)},getValue:function(a){if(a){var b=juic.set({},a),c=a.employments;return c=c&&c[0],c&&juic.set(b,c),delete b.employments,b}return a}})})();