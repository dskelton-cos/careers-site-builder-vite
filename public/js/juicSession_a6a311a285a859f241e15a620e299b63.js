function SFSessionTimer(){this.init()}SFSessionTimer.NOTIFY_BEFORE_SESSION_EXPIRE=1,SFSessionTimer.prototype=function(){function getKeyForSessionExpirationTime(){var a=SESSION_EXPIRATION_TIME_KEY;if(!a){var b=window.ajaxSecKey;b&&(a="sfTimeBeforeSessionExpire_"+(b||0),SESSION_EXPIRATION_TIME_KEY=a)}return a}function _minuteToMS(a){return 1e3*(60*a)}function _secondToMS(a){return 1e3*a}var SESSION_EXPIRATION_TIME_KEY;return juic.set(new juic.EventTarget,{init:function(){this.sessionTimeoutController=AjaxService.getMBeanInstance("sessionTimeoutController");var me=this,handleSessionTimeoutConfigs=function(a){var b=_secondToMS(a.timeUntilExpires),c=10,d=a.timeUntilWarning;0<d&&30>d&&(c=d),me.timeAfterReminder=_minuteToMS(c),me.timeBeforeSessionExpire=_minuteToMS(SFSessionTimer.NOTIFY_BEFORE_SESSION_EXPIRE),me.timeToCallReminder=b-me.timeAfterReminder,me._configuredSessionInterval=b,me.reset(),me._configuredSessionTimeoutWarning=d,me.enableSessionTimeoutAutomaticRedirect=a.enableSessionTimeoutAutomaticRedirect,me.sessionTimeoutAutomaticRedirectUrl=a.sessionTimeoutAutomaticRedirectUrl},sessionTimeoutConfigs=juic.$("sessionTimeoutConfigs");if(sessionTimeoutConfigs&&(sessionTimeoutConfigs=sessionTimeoutConfigs.content,sessionTimeoutConfigs||(sessionTimeoutConfigs=sessionTimeoutConfigs["data-content"]),sessionTimeoutConfigs))try{sessionTimeoutConfigs=eval("("+sessionTimeoutConfigs+")")}catch(a){sessionTimeoutConfigs=null}null==sessionTimeoutConfigs?this.sessionTimeoutController.getSessionTimeoutConfigs({callback:handleSessionTimeoutConfigs}):"object"==typeof sessionTimeoutConfigs&&handleSessionTimeoutConfigs(sessionTimeoutConfigs)},getSessionInterval:function(){return this._configuredSessionInterval},getSessionTimeoutWarningTime:function(){return this._configuredSessionTimeoutWarning},warning:function(){var a=this;this.beforeSessionExpireId=window.setTimeout(function(){a.beforeSessionExpire()},this.timeAfterReminder-this.timeBeforeSessionExpire),this.dispatch("sessionWarning")},timedOut:function(){this.dispatch("sessionTimedOut")},beforeSessionExpire:function(){var a=this;this.timeoutId=window.setTimeout(function(){a.timedOut()},this.timeBeforeSessionExpire),this.dispatch("sessionAboutToExpire")},extendSession:function(){this.keepAlive()},keepAlive:function(){this.sessionTimeoutController.keepAlive(),this.reset(),this.beforeSessionExpireId&&(window.clearTimeout(this.beforeSessionExpireId),this.beforeSessionExpireId=null),this.timeoutId&&(window.clearTimeout(this.timeoutId),this.timeoutId=null),this.dispatch("sessionExtended")},createSessionExpirationTime:function(){return new Date().getTime()+this._configuredSessionInterval},getSessionExpirationTime:function(){var a,b=getKeyForSessionExpirationTime(),c=this.createSessionExpirationTime();if(!b)a=c;else if(a=this._fallbackSessionExpirationTime,!a)try{a=window.localStorage.getItem(b),a||(a=c,window.localStorage.setItem(b,a))}catch(b){a=c,this._fallbackSessionExpirationTime=a}return a},setSessionExpirationTimeByDelta:function(a,b){var c=getKeyForSessionExpirationTime(),d=new Date().getTime()+a;if(!c){if(!b)throw"Could not set session expiration time to "+d+" because key could not be generated!";else{var e=this;window.setTimeout(function(){e.setSessionExpirationTimeByDelta(a)},500)}return!1}var f=this._fallbackSessionExpirationTime;if(!f)try{window.localStorage.setItem(c,d)}catch(a){this._fallbackSessionExpirationTime=d}else this._fallbackSessionExpirationTime=d;return!0},endSession:function(){this.sessionEnded=!0,this.setSessionExpirationTimeByDelta(0)},getWarningCountdown:function(){var a=this.timeAfterReminder,b=parseInt(this.getSessionExpirationTime()||0),c=new Date().getTime(),d=b-c;return d<a?d:a},isExpired:function(){var a=new Date().getTime();return a>this.getSessionExpirationTime()},reset:function(){this.clear();var a=this;window.PostMessageAPI&&PostMessageAPI.sendMessage("sessionExtended");var b="warning",c="expired",d="ended",e="prewarning";this.setSessionExpirationTimeByDelta(this._configuredSessionInterval),window.pollForSessionTimeout&&window.clearInterval(window.pollForSessionTimeout),window.pollForSessionTimeout=window.setInterval(function(){var f,g=parseInt(a.getSessionExpirationTime()||0);if(g&&"0"!=g){var h=new Date().getTime(),i=g-a.timeAfterReminder;(f=!0==a.sessionEnded?d:h>=g?c:h>=i?b:"prewarning",f!==e||f==b)&&(e=f,f===d?a.dispatch("sessionEnded"):f===c?a.dispatch("sessionTimedOut"):f===b?a.dispatch("sessionWarning"):"prewarning"===f?a.dispatch("sessionPrewarning"):void 0)}},1e3)},clear:function(){this.warningId&&(window.clearTimeout(this.warningId),this.warningId=null),this.beforeSessionExpireId&&(window.clearTimeout(this.beforeSessionExpireId),this.beforeSessionExpireId=null),this.timeoutId&&(window.clearTimeout(this.timeoutId),this.timeoutId=null)},cleanup:function(){this.clear()}})}();function SFCountdown(a,b,c){this.register(),this._init(a,b,c)}SFCountdown.prototype=function(){return juic.set(new juic.Component,{_init:function(a,b,c){this._secondsToGo=a,this._startShowingSecondsAt="undefined"==typeof b?60:b,this._cssClass=c},setSecondsToGo:function(a){this._secondsToGo=a},renderHtml:function(a){a.push("<span id=\"",this.id,"\" aria-hidden=\"true\"></span>"),a.push("<span id=\"",this.id,"_hidden\" class=\"hiddenAriaContent\" aria-live=\"assertive\" aria-atomic=\"true\"></span>")},_showCurrentCountdownTime:function(){var a,b,c=this._secondsToGo,d=Math.round(c/60),e=!0;0<c&&c<this._startShowingSecondsAt?(a=sfMessageFormat.format(MSGS.COMMON_SESSION_WARNING,this._displayCountdownTime(c),MSGS.COMMON_SESSION_SECONDS),0!=c%10&&(e=!1)):0<c?a=sfMessageFormat.format(MSGS.COMMON_SESSION_WARNING,this._displayCountdownTime(d),59<c&&90>c?MSGS.COMMON_SESSION_MINUTE:MSGS.COMMON_SESSION_MINUTES):(this.clearTimer(),this.dispatch("timerExpired")),a&&this._oldVal!=a&&(b=juic.$(this.id),b&&(b.innerHTML=a,this._oldVal=a)),e&&a&&this._oldHiddenVal!=a&&(b=juic.$(this.id+"_hidden"),b&&(b.innerHTML=a,this._oldHiddenVal=a))},_displayCountdownTime:function(a){return this._cssClass?"<span class=\""+this._cssClass+"\">"+a+"</span>":a},startCountdown:function(){var a=this;this._timerId=window.setInterval(function(){a._secondsToGo--,a._showCurrentCountdownTime()},1e3)},cancelCountdown:function(){delete this._oldVal,this.clearTimer(),this.dispatch("timerCancelled")},clearTimer:function(){"undefined"!=typeof this._timerId&&(window.clearInterval(this._timerId),delete this._timerId)},cleanup:function(){this.clearTimer(),this.unregister()}})}();function SFUserActivityListener(){var a=["keypress","click"],b=SFDom.getDocumentRoot();return juic.set(new juic.EventTarget,{startListening:function(){if(!0!==this._listenersAttached){this._listenersAttached=!0;for(var c=a.length,d=0;d<c;d++)SFDOMEvent.addListener(b,a[d],this._handleUserActivity,this)}},stopListening:function(){for(var c=a.length,d=0;d<c;d++)SFDOMEvent.removeListener(b,a[d],this._handleUserActivity);this._listenersAttached=!1},_handleUserActivity:function(){this.dispatchEvent(new juic.EventTarget.Event("userActivity",{}))}})}